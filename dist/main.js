!function(t){var e={};function i(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(n,r,function(e){return t[e]}.bind(null,r));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/dist/",i(i.s=10)}([function(t,e,i){"use strict";i.r(e),i.d(e,"__extends",(function(){return r})),i.d(e,"__assign",(function(){return o})),i.d(e,"__rest",(function(){return s})),i.d(e,"__decorate",(function(){return a})),i.d(e,"__param",(function(){return h})),i.d(e,"__metadata",(function(){return l})),i.d(e,"__awaiter",(function(){return u})),i.d(e,"__generator",(function(){return c})),i.d(e,"__exportStar",(function(){return d})),i.d(e,"__values",(function(){return p})),i.d(e,"__read",(function(){return f})),i.d(e,"__spread",(function(){return y})),i.d(e,"__spreadArrays",(function(){return m})),i.d(e,"__await",(function(){return v})),i.d(e,"__asyncGenerator",(function(){return g})),i.d(e,"__asyncDelegator",(function(){return _})),i.d(e,"__asyncValues",(function(){return w})),i.d(e,"__makeTemplateObject",(function(){return b})),i.d(e,"__importStar",(function(){return S})),i.d(e,"__importDefault",(function(){return C}));
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};function r(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var o=function(){return(o=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var r in e=arguments[i])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};function s(t,e){var i={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(i[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(t);r<n.length;r++)e.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(t,n[r])&&(i[n[r]]=t[n[r]])}return i}function a(t,e,i,n){var r,o=arguments.length,s=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(s=(o<3?r(s):o>3?r(e,i,s):r(e,i))||s);return o>3&&s&&Object.defineProperty(e,i,s),s}function h(t,e){return function(i,n){e(i,n,t)}}function l(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}function u(t,e,i,n){return new(i||(i=Promise))((function(r,o){function s(t){try{h(n.next(t))}catch(t){o(t)}}function a(t){try{h(n.throw(t))}catch(t){o(t)}}function h(t){t.done?r(t.value):new i((function(e){e(t.value)})).then(s,a)}h((n=n.apply(t,e||[])).next())}))}function c(t,e){var i,n,r,o,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,n&&(r=2&o[0]?n.return:o[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,o[1])).done)return r;switch(n=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){s.label=o[1];break}if(6===o[0]&&s.label<r[1]){s.label=r[1],r=o;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(o);break}r[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],n=0}finally{i=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}function d(t,e){for(var i in t)e.hasOwnProperty(i)||(e[i]=t[i])}function p(t){var e="function"==typeof Symbol&&t[Symbol.iterator],i=0;return e?e.call(t):{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}}}function f(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,r,o=i.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(n=o.next()).done;)s.push(n.value)}catch(t){r={error:t}}finally{try{n&&!n.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}return s}function y(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(f(arguments[e]));return t}function m(){for(var t=0,e=0,i=arguments.length;e<i;e++)t+=arguments[e].length;var n=Array(t),r=0;for(e=0;e<i;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,r++)n[r]=o[s];return n}function v(t){return this instanceof v?(this.v=t,this):new v(t)}function g(t,e,i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,r=i.apply(t,e||[]),o=[];return n={},s("next"),s("throw"),s("return"),n[Symbol.asyncIterator]=function(){return this},n;function s(t){r[t]&&(n[t]=function(e){return new Promise((function(i,n){o.push([t,e,i,n])>1||a(t,e)}))})}function a(t,e){try{(i=r[t](e)).value instanceof v?Promise.resolve(i.value.v).then(h,l):u(o[0][2],i)}catch(t){u(o[0][3],t)}var i}function h(t){a("next",t)}function l(t){a("throw",t)}function u(t,e){t(e),o.shift(),o.length&&a(o[0][0],o[0][1])}}function _(t){var e,i;return e={},n("next"),n("throw",(function(t){throw t})),n("return"),e[Symbol.iterator]=function(){return this},e;function n(n,r){e[n]=t[n]?function(e){return(i=!i)?{value:v(t[n](e)),done:"return"===n}:r?r(e):e}:r}}function w(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,i=t[Symbol.asyncIterator];return i?i.call(t):(t=p(t),e={},n("next"),n("throw"),n("return"),e[Symbol.asyncIterator]=function(){return this},e);function n(i){e[i]=t[i]&&function(e){return new Promise((function(n,r){(function(t,e,i,n){Promise.resolve(n).then((function(e){t({value:e,done:i})}),e)})(n,r,(e=t[i](e)).done,e.value)}))}}}function b(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function S(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function C(t){return t&&t.__esModule?t:{default:t}}},function(t,e,i){"use strict";var n,r=(n=i(3))&&"object"==typeof n&&"default"in n?n.default:n;
/**
 * @license
 * Copyright 2018 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
r.registerVersion("firebase","7.7.0","app"),t.exports=r},function(t,e,i){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0});var n=i(0),r={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"},o=function(t,e){if(!t)throw s(e)},s=function(t){return new Error("Firebase Database ("+r.SDK_VERSION+") INTERNAL ASSERT FAILED: "+t)},a=function(t){for(var e=[],i=0,n=0;n<t.length;n++){var r=t.charCodeAt(n);r<128?e[i++]=r:r<2048?(e[i++]=r>>6|192,e[i++]=63&r|128):55296==(64512&r)&&n+1<t.length&&56320==(64512&t.charCodeAt(n+1))?(r=65536+((1023&r)<<10)+(1023&t.charCodeAt(++n)),e[i++]=r>>18|240,e[i++]=r>>12&63|128,e[i++]=r>>6&63|128,e[i++]=63&r|128):(e[i++]=r>>12|224,e[i++]=r>>6&63|128,e[i++]=63&r|128)}return e},h={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray:function(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var i=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[],r=0;r<t.length;r+=3){var o=t[r],s=r+1<t.length,a=s?t[r+1]:0,h=r+2<t.length,l=h?t[r+2]:0,u=o>>2,c=(3&o)<<4|a>>4,d=(15&a)<<2|l>>6,p=63&l;h||(p=64,s||(d=64)),n.push(i[u],i[c],i[d],i[p])}return n.join("")},encodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(a(t),e)},decodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){for(var e=[],i=0,n=0;i<t.length;){var r=t[i++];if(r<128)e[n++]=String.fromCharCode(r);else if(r>191&&r<224){var o=t[i++];e[n++]=String.fromCharCode((31&r)<<6|63&o)}else if(r>239&&r<365){var s=((7&r)<<18|(63&(o=t[i++]))<<12|(63&(a=t[i++]))<<6|63&t[i++])-65536;e[n++]=String.fromCharCode(55296+(s>>10)),e[n++]=String.fromCharCode(56320+(1023&s))}else{o=t[i++];var a=t[i++];e[n++]=String.fromCharCode((15&r)<<12|(63&o)<<6|63&a)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray:function(t,e){this.init_();for(var i=e?this.charToByteMapWebSafe_:this.charToByteMap_,n=[],r=0;r<t.length;){var o=i[t.charAt(r++)],s=r<t.length?i[t.charAt(r)]:0,a=++r<t.length?i[t.charAt(r)]:64,h=++r<t.length?i[t.charAt(r)]:64;if(++r,null==o||null==s||null==a||null==h)throw Error();var l=o<<2|s>>4;if(n.push(l),64!==a){var u=s<<4&240|a>>2;if(n.push(u),64!==h){var c=a<<6&192|h;n.push(c)}}}return n},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}},l=function(t){try{return h.decodeString(t,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function u(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:return new Date(e.getTime());case Object:void 0===t&&(t={});break;case Array:t=[];break;default:return e}for(var i in e)e.hasOwnProperty(i)&&(t[i]=u(t[i],e[i]));return t}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var c=function(){function t(){var t=this;this.reject=function(){},this.resolve=function(){},this.promise=new Promise((function(e,i){t.resolve=e,t.reject=i}))}return t.prototype.wrapCallback=function(t){var e=this;return function(i,n){i?e.reject(i):e.resolve(n),"function"==typeof t&&(e.promise.catch((function(){})),1===t.length?t(i):t(i,n))}},t}();
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function d(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var p=function(t){function e(i,n){var r=t.call(this,n)||this;return r.code=i,r.name="FirebaseError",Object.setPrototypeOf(r,e.prototype),Error.captureStackTrace&&Error.captureStackTrace(r,f.prototype.create),r}return n.__extends(e,t),e}(Error),f=function(){function t(t,e,i){this.service=t,this.serviceName=e,this.errors=i}return t.prototype.create=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];for(var n=e[0]||{},r=this.service+"/"+t,o=this.errors[t],s=o?y(o,n):"Error",a=this.serviceName+": "+s+" ("+r+").",h=new p(r,a),l=0,u=Object.keys(n);l<u.length;l++){var c=u[l];"_"!==c.slice(-1)&&(c in h&&console.warn('Overwriting FirebaseError base field "'+c+'" can cause unexpected behavior.'),h[c]=n[c])}return h},t}();function y(t,e){return t.replace(m,(function(t,i){var n=e[i];return null!=n?n.toString():"<"+i+"?>"}))}var m=/\{\$([^}]+)}/g;
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function v(t){return JSON.parse(t)}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var g=function(t){var e={},i={},n={},r="";try{var o=t.split(".");e=v(l(o[0])||""),i=v(l(o[1])||""),r=o[2],n=i.d||{},delete i.d}catch(t){}return{header:e,claims:i,data:n,signature:r}};
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var _=function(){function t(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(var t=1;t<this.blockSize;++t)this.pad_[t]=0;this.reset()}return t.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0},t.prototype.compress_=function(t,e){e||(e=0);var i=this.W_;if("string"==typeof t)for(var n=0;n<16;n++)i[n]=t.charCodeAt(e)<<24|t.charCodeAt(e+1)<<16|t.charCodeAt(e+2)<<8|t.charCodeAt(e+3),e+=4;else for(n=0;n<16;n++)i[n]=t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3],e+=4;for(n=16;n<80;n++){var r=i[n-3]^i[n-8]^i[n-14]^i[n-16];i[n]=4294967295&(r<<1|r>>>31)}var o,s,a=this.chain_[0],h=this.chain_[1],l=this.chain_[2],u=this.chain_[3],c=this.chain_[4];for(n=0;n<80;n++){n<40?n<20?(o=u^h&(l^u),s=1518500249):(o=h^l^u,s=1859775393):n<60?(o=h&l|u&(h|l),s=2400959708):(o=h^l^u,s=3395469782);r=(a<<5|a>>>27)+o+c+s+i[n]&4294967295;c=u,u=l,l=4294967295&(h<<30|h>>>2),h=a,a=r}this.chain_[0]=this.chain_[0]+a&4294967295,this.chain_[1]=this.chain_[1]+h&4294967295,this.chain_[2]=this.chain_[2]+l&4294967295,this.chain_[3]=this.chain_[3]+u&4294967295,this.chain_[4]=this.chain_[4]+c&4294967295},t.prototype.update=function(t,e){if(null!=t){void 0===e&&(e=t.length);for(var i=e-this.blockSize,n=0,r=this.buf_,o=this.inbuf_;n<e;){if(0===o)for(;n<=i;)this.compress_(t,n),n+=this.blockSize;if("string"==typeof t){for(;n<e;)if(r[o]=t.charCodeAt(n),++n,++o===this.blockSize){this.compress_(r),o=0;break}}else for(;n<e;)if(r[o]=t[n],++n,++o===this.blockSize){this.compress_(r),o=0;break}}this.inbuf_=o,this.total_+=e}},t.prototype.digest=function(){var t=[],e=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(var i=this.blockSize-1;i>=56;i--)this.buf_[i]=255&e,e/=256;this.compress_(this.buf_);var n=0;for(i=0;i<5;i++)for(var r=24;r>=0;r-=8)t[n]=this.chain_[i]>>r&255,++n;return t},t}();var w=function(){function t(t,e){var i=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=e,this.task.then((function(){t(i)})).catch((function(t){i.error(t)}))}return t.prototype.next=function(t){this.forEachObserver((function(e){e.next(t)}))},t.prototype.error=function(t){this.forEachObserver((function(e){e.error(t)})),this.close(t)},t.prototype.complete=function(){this.forEachObserver((function(t){t.complete()})),this.close()},t.prototype.subscribe=function(t,e,i){var n,r=this;if(void 0===t&&void 0===e&&void 0===i)throw new Error("Missing Observer.");void 0===(n=function(t,e){if("object"!=typeof t||null===t)return!1;for(var i=0,n=e;i<n.length;i++){var r=n[i];if(r in t&&"function"==typeof t[r])return!0}return!1}(t,["next","error","complete"])?t:{next:t,error:e,complete:i}).next&&(n.next=b),void 0===n.error&&(n.error=b),void 0===n.complete&&(n.complete=b);var o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((function(){try{r.finalError?n.error(r.finalError):n.complete()}catch(t){}})),this.observers.push(n),o},t.prototype.unsubscribeOne=function(t){void 0!==this.observers&&void 0!==this.observers[t]&&(delete this.observers[t],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))},t.prototype.forEachObserver=function(t){if(!this.finalized)for(var e=0;e<this.observers.length;e++)this.sendOne(e,t)},t.prototype.sendOne=function(t,e){var i=this;this.task.then((function(){if(void 0!==i.observers&&void 0!==i.observers[t])try{e(i.observers[t])}catch(t){"undefined"!=typeof console&&console.error&&console.error(t)}}))},t.prototype.close=function(t){var e=this;this.finalized||(this.finalized=!0,void 0!==t&&(this.finalError=t),this.task.then((function(){e.observers=void 0,e.onNoObservers=void 0})))},t}();function b(){}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function S(t,e,i){var n="";switch(e){case 1:n=i?"first":"First";break;case 2:n=i?"second":"Second";break;case 3:n=i?"third":"Third";break;case 4:n=i?"fourth":"Fourth";break;default:throw new Error("errorPrefix called with argumentNumber > 4.  Need to update it?")}var r=t+" failed: ";return r+=n+" argument "}e.CONSTANTS=r,e.Deferred=c,e.ErrorFactory=f,e.FirebaseError=p,e.Sha1=_,e.assert=o,e.assertionError=s,e.async=function(t,e){return function(){for(var i=[],n=0;n<arguments.length;n++)i[n]=arguments[n];Promise.resolve(!0).then((function(){t.apply(void 0,i)})).catch((function(t){e&&e(t)}))}},e.base64=h,e.base64Decode=l,e.base64Encode=function(t){var e=a(t);return h.encodeByteArray(e,!0)},e.contains=
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.createSubscribe=function(t,e){var i=new w(t,e);return i.subscribe.bind(i)},e.decode=g,e.deepCopy=
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function(t){return u(void 0,t)},e.deepExtend=u,e.errorPrefix=S,e.getUA=d,e.isAdmin=function(t){var e=g(t).claims;return"object"==typeof e&&!0===e.admin},e.isBrowser=function(){return"object"==typeof self&&self.self===self},e.isBrowserExtension=function(){var t="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof t&&void 0!==t.id},e.isElectron=function(){return d().indexOf("Electron/")>=0},e.isEmpty=function(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0},e.isIE=function(){var t=d();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0},e.isMobileCordova=function(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(d())},e.isNode=function(){try{return"[object process]"===Object.prototype.toString.call(t.process)}catch(t){return!1}},e.isNodeSdk=function(){return!0===r.NODE_CLIENT||!0===r.NODE_ADMIN},e.isReactNative=function(){return"object"==typeof navigator&&"ReactNative"===navigator.product},e.isUWP=function(){return d().indexOf("MSAppHost/")>=0},e.isValidFormat=function(t){var e=g(t).claims;return!!e&&"object"==typeof e&&e.hasOwnProperty("iat")},e.isValidTimestamp=function(t){var e=g(t).claims,i=Math.floor((new Date).getTime()/1e3),n=0,r=0;return"object"==typeof e&&(e.hasOwnProperty("nbf")?n=e.nbf:e.hasOwnProperty("iat")&&(n=e.iat),r=e.hasOwnProperty("exp")?e.exp:n+86400),!!i&&!!n&&!!r&&i>=n&&i<=r},e.issuedAtTime=function(t){var e=g(t).claims;return"object"==typeof e&&e.hasOwnProperty("iat")?e.iat:null},e.jsonEval=v,e.map=function(t,e,i){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=e.call(i,t[r],r,t));return n}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */,e.querystring=function(t){for(var e=[],i=function(t,i){Array.isArray(i)?i.forEach((function(i){e.push(encodeURIComponent(t)+"="+encodeURIComponent(i))})):e.push(encodeURIComponent(t)+"="+encodeURIComponent(i))},n=0,r=Object.entries(t);n<r.length;n++){var o=r[n];i(o[0],o[1])}return e.length?"&"+e.join("&"):""},e.querystringDecode=function(t){var e={};return t.replace(/^\?/,"").split("&").forEach((function(t){if(t){var i=t.split("=");e[i[0]]=i[1]}})),e},e.safeGet=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)?t[e]:void 0},e.stringLength=function(t){for(var e=0,i=0;i<t.length;i++){var n=t.charCodeAt(i);n<128?e++:n<2048?e+=2:n>=55296&&n<=56319?(e+=4,i++):e+=3}return e},e.stringToByteArray=function(t){for(var e=[],i=0,n=0;n<t.length;n++){var r=t.charCodeAt(n);if(r>=55296&&r<=56319){var s=r-55296;n++,o(n<t.length,"Surrogate pair missing trail surrogate."),r=65536+(s<<10)+(t.charCodeAt(n)-56320)}r<128?e[i++]=r:r<2048?(e[i++]=r>>6|192,e[i++]=63&r|128):r<65536?(e[i++]=r>>12|224,e[i++]=r>>6&63|128,e[i++]=63&r|128):(e[i++]=r>>18|240,e[i++]=r>>12&63|128,e[i++]=r>>6&63|128,e[i++]=63&r|128)}return e},e.stringify=function(t){return JSON.stringify(t)},e.validateArgCount=function(t,e,i,n){var r;if(n<e?r="at least "+e:n>i&&(r=0===i?"none":"no more than "+i),r)throw new Error(t+" failed: Was called with "+n+(1===n?" argument.":" arguments.")+" Expects "+r+".")},e.validateCallback=function(t,e,i,n){if((!n||i)&&"function"!=typeof i)throw new Error(S(t,e,n)+"must be a valid function.")},e.validateContextObject=function(t,e,i,n){if((!n||i)&&("object"!=typeof i||null===i))throw new Error(S(t,e,n)+"must be a valid context object.")}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */,e.validateNamespace=function(t,e,i,n){if((!n||i)&&"string"!=typeof i)throw new Error(S(t,e,n)+"must be a valid firebase namespace.")}}).call(this,i(7))},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,r,o=i(0),s=i(2),a=i(4),h=i(5),l=((n={})["no-app"]="No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",n["bad-app-name"]="Illegal App name: '{$appName}",n["duplicate-app"]="Firebase App named '{$appName}' already exists",n["app-deleted"]="Firebase App named '{$appName}' already deleted",n["invalid-app-argument"]="firebase.{$appName}() takes either no argument or a Firebase App instance.",n),u=new s.ErrorFactory("app","Firebase",l),c="@firebase/app",d=((r={})[c]="fire-core",r["@firebase/analytics"]="fire-analytics",r["@firebase/auth"]="fire-auth",r["@firebase/database"]="fire-rtdb",r["@firebase/functions"]="fire-fn",r["@firebase/installations"]="fire-iid",r["@firebase/messaging"]="fire-fcm",r["@firebase/performance"]="fire-perf",r["@firebase/remote-config"]="fire-rc",r["@firebase/storage"]="fire-gcs",r["@firebase/firestore"]="fire-fst",r["fire-js"]="fire-js",r["firebase-wrapper"]="fire-js-all",r),p=new h.Logger("@firebase/app"),f=function(){function t(t,e,i){var n,r,h=this;this.firebase_=i,this.isDeleted_=!1,this.name_=e.name,this.automaticDataCollectionEnabled_=e.automaticDataCollectionEnabled||!1,this.options_=s.deepCopy(t),this.container=new a.ComponentContainer(e.name),this._addComponent(new a.Component("app",(function(){return h}),"PUBLIC"));try{for(var l=o.__values(this.firebase_.INTERNAL.components.values()),u=l.next();!u.done;u=l.next()){var c=u.value;this._addComponent(c)}}catch(t){n={error:t}}finally{try{u&&!u.done&&(r=l.return)&&r.call(l)}finally{if(n)throw n.error}}}return Object.defineProperty(t.prototype,"automaticDataCollectionEnabled",{get:function(){return this.checkDestroyed_(),this.automaticDataCollectionEnabled_},set:function(t){this.checkDestroyed_(),this.automaticDataCollectionEnabled_=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this.checkDestroyed_(),this.name_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"options",{get:function(){return this.checkDestroyed_(),this.options_},enumerable:!0,configurable:!0}),t.prototype.delete=function(){var t=this;return new Promise((function(e){t.checkDestroyed_(),e()})).then((function(){return t.firebase_.INTERNAL.removeApp(t.name_),Promise.all(t.container.getProviders().map((function(t){return t.delete()})))})).then((function(){t.isDeleted_=!0}))},t.prototype._getService=function(t,e){return void 0===e&&(e="[DEFAULT]"),this.checkDestroyed_(),this.container.getProvider(t).getImmediate({identifier:e})},t.prototype._removeServiceInstance=function(t,e){void 0===e&&(e="[DEFAULT]"),this.container.getProvider(t).clearInstance(e)},t.prototype._addComponent=function(t){try{this.container.addComponent(t)}catch(e){p.debug("Component "+t.name+" failed to register with FirebaseApp "+this.name,e)}},t.prototype._addOrOverwriteComponent=function(t){this.container.addOrOverwriteComponent(t)},t.prototype.checkDestroyed_=function(){if(this.isDeleted_)throw u.create("app-deleted",{appName:this.name_})},t}();f.prototype.name&&f.prototype.options||f.prototype.delete||console.log("dc");var y=
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function t(){var e=
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function(t){var e={},i=new Map,n={__esModule:!0,initializeApp:function(i,r){void 0===r&&(r={});if("object"!=typeof r||null===r){r={name:r}}var o=r;void 0===o.name&&(o.name="[DEFAULT]");var a=o.name;if("string"!=typeof a||!a)throw u.create("bad-app-name",{appName:String(a)});if(s.contains(e,a))throw u.create("duplicate-app",{appName:a});var h=new t(i,o,n);return e[a]=h,h},app:r,registerVersion:function(t,e,i){var n,r=null!==(n=d[t])&&void 0!==n?n:t;i&&(r+="-"+i);var o=r.match(/\s|\//),s=e.match(/\s|\//);if(o||s){var l=['Unable to register library "'+r+'" with version "'+e+'":'];return o&&l.push('library name "'+r+'" contains illegal characters (whitespace or "/")'),o&&s&&l.push("and"),s&&l.push('version name "'+e+'" contains illegal characters (whitespace or "/")'),void p.warn(l.join(" "))}h(new a.Component(r+"-version",(function(){return{library:r,version:e}}),"VERSION"))},apps:null,SDK_VERSION:"7.7.0",INTERNAL:{registerComponent:h,removeApp:function(t){delete e[t]},components:i,useAsService:function(t,e){if("serverAuth"===e)return null;return e}}};function r(t){if(t=t||"[DEFAULT]",!s.contains(e,t))throw u.create("no-app",{appName:t});return e[t]}function h(a){var h,l,c=a.name;if(i.has(c))return p.debug("There were multiple attempts to register component "+c+"."),"PUBLIC"===a.type?n[c]:null;if(i.set(c,a),"PUBLIC"===a.type){var d=function(t){if(void 0===t&&(t=r()),"function"!=typeof t[c])throw u.create("invalid-app-argument",{appName:c});return t[c]()};void 0!==a.serviceProps&&s.deepExtend(d,a.serviceProps),n[c]=d,t.prototype[c]=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=this._getService.bind(this,c);return i.apply(this,a.multipleInstances?t:[])}}try{for(var f=o.__values(Object.keys(e)),y=f.next();!y.done;y=f.next()){var m=y.value;e[m]._addComponent(a)}}catch(t){h={error:t}}finally{try{y&&!y.done&&(l=f.return)&&l.call(f)}finally{if(h)throw h.error}}return"PUBLIC"===a.type?n[c]:null}return(n.default=n,Object.defineProperty(n,"apps",{get:function(){return Object.keys(e).map((function(t){return e[t]}))}}),r.App=t,n)}(f);return e.INTERNAL=o.__assign(o.__assign({},e.INTERNAL),{createFirebaseNamespace:t,extendNamespace:function(t){s.deepExtend(e,t)},createSubscribe:s.createSubscribe,ErrorFactory:s.ErrorFactory,deepExtend:s.deepExtend}),e}(),m=function(){function t(t){this.container=t}return t.prototype.getPlatformInfoString=function(){return this.container.getProviders().map((function(t){if(function(t){var e,i=t.getComponent();return"VERSION"===(null===(e=i)||void 0===e?void 0:e.type)}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(t)){var e=t.getImmediate();return e.library+"/"+e.version}return null})).filter((function(t){return t})).join(" ")},t}();
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
if(s.isBrowser()&&void 0!==self.firebase){p.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");var v=self.firebase.SDK_VERSION;v&&v.indexOf("LITE")>=0&&p.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}var g=y.initializeApp;y.initializeApp=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return s.isNode()&&p.warn('\n      Warning: This is a browser-targeted Firebase bundle but it appears it is being\n      run in a Node environment.  If running in a Node environment, make sure you\n      are using the bundle specified by the "main" field in package.json.\n      \n      If you are using Webpack, you can specify "main" as the first item in\n      "resolve.mainFields":\n      https://webpack.js.org/configuration/resolve/#resolvemainfields\n      \n      If using Rollup, use the rollup-plugin-node-resolve plugin and specify "main"\n      as the first item in "mainFields", e.g. [\'main\', \'module\'].\n      https://github.com/rollup/rollup-plugin-node-resolve\n      '),g.apply(void 0,t)};var _=y;!function(t,e){t.INTERNAL.registerComponent(new a.Component("platform-logger",(function(t){return new m(t)}),"PRIVATE")),t.registerVersion(c,"0.5.2",e),t.registerVersion("fire-js","")}(_),e.default=_,e.firebase=_},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(0),r=i(2),o=function(){function t(t,e,i){this.name=t,this.instanceFactory=e,this.type=i,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}return t.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},t.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},t.prototype.setServiceProps=function(t){return this.serviceProps=t,this},t}(),s=function(){function t(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map}return t.prototype.get=function(t){void 0===t&&(t="[DEFAULT]");var e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){var i=new r.Deferred;this.instancesDeferred.set(e,i);try{var n=this.getOrInitializeService(e);n&&i.resolve(n)}catch(t){}}return this.instancesDeferred.get(e).promise},t.prototype.getImmediate=function(t){var e=n.__assign({identifier:"[DEFAULT]",optional:!1},t),i=e.identifier,r=e.optional,o=this.normalizeInstanceIdentifier(i);try{var s=this.getOrInitializeService(o);if(!s){if(r)return null;throw Error("Service "+this.name+" is not available")}return s}catch(t){if(r)return null;throw t}},t.prototype.getComponent=function(){return this.component},t.prototype.setComponent=function(t){var e,i;if(t.name!==this.name)throw Error("Mismatching Component "+t.name+" for Provider "+this.name+".");if(this.component)throw Error("Component for "+this.name+" has already been provided");if(this.component=t,function(t){return"EAGER"===t.instantiationMode}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(t))try{this.getOrInitializeService("[DEFAULT]")}catch(t){}try{for(var r=n.__values(this.instancesDeferred.entries()),o=r.next();!o.done;o=r.next()){var s=n.__read(o.value,2),a=s[0],h=s[1],l=this.normalizeInstanceIdentifier(a);try{var u=this.getOrInitializeService(l);h.resolve(u)}catch(t){}}}catch(t){e={error:t}}finally{try{o&&!o.done&&(i=r.return)&&i.call(r)}finally{if(e)throw e.error}}},t.prototype.clearInstance=function(t){void 0===t&&(t="[DEFAULT]"),this.instancesDeferred.delete(t),this.instances.delete(t)},t.prototype.delete=function(){return n.__awaiter(this,void 0,void 0,(function(){var t;return n.__generator(this,(function(e){switch(e.label){case 0:return t=Array.from(this.instances.values()),[4,Promise.all(t.filter((function(t){return"INTERNAL"in t})).map((function(t){return t.INTERNAL.delete()})))];case 1:return e.sent(),[2]}}))}))},t.prototype.isComponentSet=function(){return null!=this.component},t.prototype.getOrInitializeService=function(t){var e=this.instances.get(t);return!e&&this.component&&(e=this.component.instanceFactory(this.container,function(t){return"[DEFAULT]"===t?void 0:t}(t)),this.instances.set(t,e)),e||null},t.prototype.normalizeInstanceIdentifier=function(t){return this.component?this.component.multipleInstances?t:"[DEFAULT]":t},t}();var a=function(){function t(t){this.name=t,this.providers=new Map}return t.prototype.addComponent=function(t){var e=this.getProvider(t.name);if(e.isComponentSet())throw new Error("Component "+t.name+" has already been registered with "+this.name);e.setComponent(t)},t.prototype.addOrOverwriteComponent=function(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)},t.prototype.getProvider=function(t){if(this.providers.has(t))return this.providers.get(t);var e=new s(t,this);return this.providers.set(t,e),e},t.prototype.getProviders=function(){return Array.from(this.providers.values())},t}();e.Component=o,e.ComponentContainer=a,e.Provider=s},function(t,e,i){"use strict";
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
function n(){for(var t=0,e=0,i=arguments.length;e<i;e++)t+=arguments[e].length;var n=Array(t),r=0;for(e=0;e<i;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,r++)n[r]=o[s];return n}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */i.r(e),i.d(e,"LogLevel",(function(){return r})),i.d(e,"Logger",(function(){return h})),i.d(e,"setLogLevel",(function(){return l}));var r,o=[];!function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"}(r||(r={}));var s=r.INFO,a=function(t,e){for(var i=[],o=2;o<arguments.length;o++)i[o-2]=arguments[o];if(!(e<t.logLevel)){var s=(new Date).toISOString();switch(e){case r.DEBUG:case r.VERBOSE:console.log.apply(console,n(["["+s+"]  "+t.name+":"],i));break;case r.INFO:console.info.apply(console,n(["["+s+"]  "+t.name+":"],i));break;case r.WARN:console.warn.apply(console,n(["["+s+"]  "+t.name+":"],i));break;case r.ERROR:console.error.apply(console,n(["["+s+"]  "+t.name+":"],i));break;default:throw new Error("Attempted to log a message with an invalid logType (value: "+e+")")}}},h=function(){function t(t){this.name=t,this._logLevel=s,this._logHandler=a,o.push(this)}return Object.defineProperty(t.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in r))throw new TypeError("Invalid value assigned to `logLevel`");this._logLevel=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!0,configurable:!0}),t.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,n([this,r.DEBUG],t))},t.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,n([this,r.VERBOSE],t))},t.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,n([this,r.INFO],t))},t.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,n([this,r.WARN],t))},t.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,n([this,r.ERROR],t))},t}();
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function l(t){o.forEach((function(e){e.logLevel=t}))}},function(t,e,i){},function(t,e){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch(t){"object"==typeof window&&(i=window)}t.exports=i},function(t,e,i){"use strict";(function(n){Object.defineProperty(e,"__esModule",{value:!0});var r,o,s=(r=i(3))&&"object"==typeof r&&"default"in r?r.default:r,a=i(0),h=i(2),l=i(5),u=i(4),c=function(){function t(t){this.domStorage_=t,this.prefix_="firebase:"}return t.prototype.set=function(t,e){null==e?this.domStorage_.removeItem(this.prefixedName_(t)):this.domStorage_.setItem(this.prefixedName_(t),h.stringify(e))},t.prototype.get=function(t){var e=this.domStorage_.getItem(this.prefixedName_(t));return null==e?null:h.jsonEval(e)},t.prototype.remove=function(t){this.domStorage_.removeItem(this.prefixedName_(t))},t.prototype.prefixedName_=function(t){return this.prefix_+t},t.prototype.toString=function(){return this.domStorage_.toString()},t}(),d=function(){function t(){this.cache_={},this.isInMemoryStorage=!0}return t.prototype.set=function(t,e){null==e?delete this.cache_[t]:this.cache_[t]=e},t.prototype.get=function(t){return h.contains(this.cache_,t)?this.cache_[t]:null},t.prototype.remove=function(t){delete this.cache_[t]},t}(),p=function(t){try{if("undefined"!=typeof window&&void 0!==window[t]){var e=window[t];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new c(e)}}catch(t){}return new d},f=p("localStorage"),y=p("sessionStorage"),m=new l.Logger("@firebase/database"),v=(o=1,function(){return o++}),g=function(t){var e=h.stringToByteArray(t),i=new h.Sha1;i.update(e);var n=i.digest();return h.base64.encodeByteArray(n)},_=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i="",n=0;n<t.length;n++){var r=t[n];Array.isArray(r)||r&&"object"==typeof r&&"number"==typeof r.length?i+=_.apply(null,r):i+="object"==typeof r?h.stringify(r):r,i+=" "}return i},w=null,b=!0,S=function(t,e){h.assert(!e||!0===t||!1===t,"Can't turn on custom loggers persistently."),!0===t?(m.logLevel=l.LogLevel.VERBOSE,w=m.log.bind(m),e&&y.set("logging_enabled",!0)):"function"==typeof t?w=t:(w=null,y.remove("logging_enabled"))},C=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(!0===b&&(b=!1,null===w&&!0===y.get("logging_enabled")&&S(!0)),w){var i=_.apply(null,t);w(i)}},E=function(t){return function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];C.apply(void 0,a.__spread([t],e))}},T=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i="FIREBASE INTERNAL ERROR: "+_.apply(void 0,a.__spread(t));m.error(i)},P=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i="FIREBASE FATAL ERROR: "+_.apply(void 0,a.__spread(t));throw m.error(i),new Error(i)},k=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i="FIREBASE WARNING: "+_.apply(void 0,a.__spread(t));m.warn(i)},x=function(t){return"number"==typeof t&&(t!=t||t===Number.POSITIVE_INFINITY||t===Number.NEGATIVE_INFINITY)},I="[MIN_NAME]",O="[MAX_NAME]",N=function(t,e){if(t===e)return 0;if(t===I||e===O)return-1;if(e===I||t===O)return 1;var i=W(t),n=W(e);return null!==i?null!==n?i-n==0?t.length-e.length:i-n:-1:null!==n?1:t<e?-1:1},R=function(t,e){return t===e?0:t<e?-1:1},D=function(t,e){if(e&&t in e)return e[t];throw new Error("Missing required key ("+t+") in object: "+h.stringify(e))},A=function(t){if("object"!=typeof t||null===t)return h.stringify(t);var e=[];for(var i in t)e.push(i);e.sort();for(var n="{",r=0;r<e.length;r++)0!==r&&(n+=","),n+=h.stringify(e[r]),n+=":",n+=A(t[e[r]]);return n+="}"},M=function(t,e){var i=t.length;if(i<=e)return[t];for(var n=[],r=0;r<i;r+=e)r+e>i?n.push(t.substring(r,i)):n.push(t.substring(r,r+e));return n};function L(t,e){for(var i in t)t.hasOwnProperty(i)&&e(i,t[i])}var F=function(t){h.assert(!x(t),"Invalid JSON number");var e,i,n,r,o;0===t?(i=0,n=0,e=1/t==-1/0?1:0):(e=t<0,(t=Math.abs(t))>=Math.pow(2,-1022)?(i=(r=Math.min(Math.floor(Math.log(t)/Math.LN2),1023))+1023,n=Math.round(t*Math.pow(2,52-r)-Math.pow(2,52))):(i=0,n=Math.round(t/Math.pow(2,-1074))));var s=[];for(o=52;o;o-=1)s.push(n%2?1:0),n=Math.floor(n/2);for(o=11;o;o-=1)s.push(i%2?1:0),i=Math.floor(i/2);s.push(e?1:0),s.reverse();var a=s.join(""),l="";for(o=0;o<64;o+=8){var u=parseInt(a.substr(o,8),2).toString(16);1===u.length&&(u="0"+u),l+=u}return l.toLowerCase()},j=new RegExp("^-?(0*)\\d{1,10}$"),W=function(t){if(j.test(t)){var e=Number(t);if(e>=-2147483648&&e<=2147483647)return e}return null},H=function(t){try{t()}catch(t){setTimeout((function(){var e=t.stack||"";throw k("Exception was thrown by user callback.",e),t}),Math.floor(0))}},Y=function(t,e){var i=setTimeout(t,e);return"object"==typeof i&&i.unref&&i.unref(),i},B=function(){function t(t,e){if(void 0===e){this.pieces_=t.split("/");for(var i=0,n=0;n<this.pieces_.length;n++)this.pieces_[n].length>0&&(this.pieces_[i]=this.pieces_[n],i++);this.pieces_.length=i,this.pieceNum_=0}else this.pieces_=t,this.pieceNum_=e}return Object.defineProperty(t,"Empty",{get:function(){return new t("")},enumerable:!0,configurable:!0}),t.prototype.getFront=function(){return this.pieceNum_>=this.pieces_.length?null:this.pieces_[this.pieceNum_]},t.prototype.getLength=function(){return this.pieces_.length-this.pieceNum_},t.prototype.popFront=function(){var e=this.pieceNum_;return e<this.pieces_.length&&e++,new t(this.pieces_,e)},t.prototype.getBack=function(){return this.pieceNum_<this.pieces_.length?this.pieces_[this.pieces_.length-1]:null},t.prototype.toString=function(){for(var t="",e=this.pieceNum_;e<this.pieces_.length;e++)""!==this.pieces_[e]&&(t+="/"+this.pieces_[e]);return t||"/"},t.prototype.toUrlEncodedString=function(){for(var t="",e=this.pieceNum_;e<this.pieces_.length;e++)""!==this.pieces_[e]&&(t+="/"+encodeURIComponent(String(this.pieces_[e])));return t||"/"},t.prototype.slice=function(t){return void 0===t&&(t=0),this.pieces_.slice(this.pieceNum_+t)},t.prototype.parent=function(){if(this.pieceNum_>=this.pieces_.length)return null;for(var e=[],i=this.pieceNum_;i<this.pieces_.length-1;i++)e.push(this.pieces_[i]);return new t(e,0)},t.prototype.child=function(e){for(var i=[],n=this.pieceNum_;n<this.pieces_.length;n++)i.push(this.pieces_[n]);if(e instanceof t)for(n=e.pieceNum_;n<e.pieces_.length;n++)i.push(e.pieces_[n]);else{var r=e.split("/");for(n=0;n<r.length;n++)r[n].length>0&&i.push(r[n])}return new t(i,0)},t.prototype.isEmpty=function(){return this.pieceNum_>=this.pieces_.length},t.relativePath=function(e,i){var n=e.getFront(),r=i.getFront();if(null===n)return i;if(n===r)return t.relativePath(e.popFront(),i.popFront());throw new Error("INTERNAL ERROR: innerPath ("+i+") is not within outerPath ("+e+")")},t.comparePaths=function(t,e){for(var i=t.slice(),n=e.slice(),r=0;r<i.length&&r<n.length;r++){var o=N(i[r],n[r]);if(0!==o)return o}return i.length===n.length?0:i.length<n.length?-1:1},t.prototype.equals=function(t){if(this.getLength()!==t.getLength())return!1;for(var e=this.pieceNum_,i=t.pieceNum_;e<=this.pieces_.length;e++,i++)if(this.pieces_[e]!==t.pieces_[i])return!1;return!0},t.prototype.contains=function(t){var e=this.pieceNum_,i=t.pieceNum_;if(this.getLength()>t.getLength())return!1;for(;e<this.pieces_.length;){if(this.pieces_[e]!==t.pieces_[i])return!1;++e,++i}return!0},t}(),U=function(){function t(t,e){this.errorPrefix_=e,this.parts_=t.slice(),this.byteLength_=Math.max(1,this.parts_.length);for(var i=0;i<this.parts_.length;i++)this.byteLength_+=h.stringLength(this.parts_[i]);this.checkValid_()}return Object.defineProperty(t,"MAX_PATH_DEPTH",{get:function(){return 32},enumerable:!0,configurable:!0}),Object.defineProperty(t,"MAX_PATH_LENGTH_BYTES",{get:function(){return 768},enumerable:!0,configurable:!0}),t.prototype.push=function(t){this.parts_.length>0&&(this.byteLength_+=1),this.parts_.push(t),this.byteLength_+=h.stringLength(t),this.checkValid_()},t.prototype.pop=function(){var t=this.parts_.pop();this.byteLength_-=h.stringLength(t),this.parts_.length>0&&(this.byteLength_-=1)},t.prototype.checkValid_=function(){if(this.byteLength_>t.MAX_PATH_LENGTH_BYTES)throw new Error(this.errorPrefix_+"has a key path longer than "+t.MAX_PATH_LENGTH_BYTES+" bytes ("+this.byteLength_+").");if(this.parts_.length>t.MAX_PATH_DEPTH)throw new Error(this.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+t.MAX_PATH_DEPTH+") or object contains a cycle "+this.toErrorString())},t.prototype.toErrorString=function(){return 0===this.parts_.length?"":"in property '"+this.parts_.join(".")+"'"},t}(),X=function(){function t(t,e,i,n,r,o){void 0===r&&(r=""),void 0===o&&(o=!1),this.secure=e,this.namespace=i,this.webSocketOnly=n,this.persistenceKey=r,this.includeNamespaceInQueryParams=o,this.host=t.toLowerCase(),this.domain=this.host.substr(this.host.indexOf(".")+1),this.internalHost=f.get("host:"+t)||this.host}return t.prototype.needsQueryParam=function(){return this.host!==this.internalHost||this.isCustomHost()||this.includeNamespaceInQueryParams},t.prototype.isCacheableHost=function(){return"s-"===this.internalHost.substr(0,2)},t.prototype.isDemoHost=function(){return"firebaseio-demo.com"===this.domain},t.prototype.isCustomHost=function(){return"firebaseio.com"!==this.domain&&"firebaseio-demo.com"!==this.domain},t.prototype.updateHost=function(t){t!==this.internalHost&&(this.internalHost=t,this.isCacheableHost()&&f.set("host:"+this.host,this.internalHost))},t.prototype.connectionURL=function(t,e){var i;if(h.assert("string"==typeof t,"typeof type must == string"),h.assert("object"==typeof e,"typeof params must == object"),"websocket"===t)i=(this.secure?"wss://":"ws://")+this.internalHost+"/.ws?";else{if("long_polling"!==t)throw new Error("Unknown connection type: "+t);i=(this.secure?"https://":"http://")+this.internalHost+"/.lp?"}this.needsQueryParam()&&(e.ns=this.namespace);var n=[];return L(e,(function(t,e){n.push(t+"="+e)})),i+n.join("&")},t.prototype.toString=function(){var t=this.toURLString();return this.persistenceKey&&(t+="<"+this.persistenceKey+">"),t},t.prototype.toURLString=function(){return(this.secure?"https://":"http://")+this.host},t}();var V,q,z,Q,K,G=function(t){var e=$(t),i=e.namespace;"firebase"===e.domain&&P(e.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),i&&"undefined"!==i||"localhost"===e.domain||P("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),e.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&k("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().");var n="ws"===e.scheme||"wss"===e.scheme;return{repoInfo:new X(e.host,e.secure,i,n,"",i!==e.subdomain),path:new B(e.pathString)}},$=function(t){var e="",i="",n="",r="",o="",s=!0,h="https",l=443;if("string"==typeof t){var u=t.indexOf("//");u>=0&&(h=t.substring(0,u-1),t=t.substring(u+2));var c=t.indexOf("/");-1===c&&(c=t.length);var d=t.indexOf("?");-1===d&&(d=t.length),e=t.substring(0,Math.min(c,d)),c<d&&(r=
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function(t){for(var e="",i=t.split("/"),n=0;n<i.length;n++)if(i[n].length>0){var r=i[n];try{r=decodeURIComponent(r.replace(/\+/g," "))}catch(t){}e+="/"+r}return e}(t.substring(c,d)));var p=function(t){var e,i,n={};"?"===t.charAt(0)&&(t=t.substring(1));try{for(var r=a.__values(t.split("&")),o=r.next();!o.done;o=r.next()){var s=o.value;if(0!==s.length){var h=s.split("=");2===h.length?n[decodeURIComponent(h[0])]=decodeURIComponent(h[1]):k("Invalid query segment '"+s+"' in query '"+t+"'")}}}catch(t){e={error:t}}finally{try{o&&!o.done&&(i=r.return)&&i.call(r)}finally{if(e)throw e.error}}return n}(t.substring(Math.min(t.length,d)));(u=e.indexOf(":"))>=0?(s="https"===h||"wss"===h,l=parseInt(e.substring(u+1),10)):u=t.length;var f=e.split(".");3===f.length?(i=f[1],o=n=f[0].toLowerCase()):2===f.length?i=f[0]:"localhost"===f[0].slice(0,u).toLowerCase()&&(i="localhost"),"ns"in p&&(o=p.ns)}return{host:e,port:l,domain:i,subdomain:n,secure:s,scheme:h,pathString:r,namespace:o}},J=/[\[\].#$\/\u0000-\u001F\u007F]/,Z=/[\[\].#$\u0000-\u001F\u007F]/,tt=function(t){return"string"==typeof t&&0!==t.length&&!J.test(t)},et=function(t){return"string"==typeof t&&0!==t.length&&!Z.test(t)},it=function(t){return null===t||"string"==typeof t||"number"==typeof t&&!x(t)||t&&"object"==typeof t&&h.contains(t,".sv")},nt=function(t,e,i,n,r){r&&void 0===i||rt(h.errorPrefix(t,e,r),i,n)},rt=function(t,e,i){var n=i instanceof B?new U(i,t):i;if(void 0===e)throw new Error(t+"contains undefined "+n.toErrorString());if("function"==typeof e)throw new Error(t+"contains a function "+n.toErrorString()+" with contents = "+e.toString());if(x(e))throw new Error(t+"contains "+e.toString()+" "+n.toErrorString());if("string"==typeof e&&e.length>10485760/3&&h.stringLength(e)>10485760)throw new Error(t+"contains a string greater than 10485760 utf8 bytes "+n.toErrorString()+" ('"+e.substring(0,50)+"...')");if(e&&"object"==typeof e){var r=!1,o=!1;if(L(e,(function(e,i){if(".value"===e)r=!0;else if(".priority"!==e&&".sv"!==e&&(o=!0,!tt(e)))throw new Error(t+" contains an invalid key ("+e+") "+n.toErrorString()+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');n.push(e),rt(t,i,n),n.pop()})),r&&o)throw new Error(t+' contains ".value" child '+n.toErrorString()+" in addition to actual children.")}},ot=function(t,e,i,n,r){if(!r||void 0!==i){var o=h.errorPrefix(t,e,r);if(!i||"object"!=typeof i||Array.isArray(i))throw new Error(o+" must be an object containing the children to replace.");var s=[];L(i,(function(t,e){var i=new B(t);if(rt(o,e,n.child(i)),".priority"===i.getBack()&&!it(e))throw new Error(o+"contains an invalid value for '"+i.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");s.push(i)})),function(t,e){var i,n;for(i=0;i<e.length;i++)for(var r=(n=e[i]).slice(),o=0;o<r.length;o++)if(".priority"===r[o]&&o===r.length-1);else if(!tt(r[o]))throw new Error(t+"contains an invalid key ("+r[o]+") in path "+n.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');e.sort(B.comparePaths);var s=null;for(i=0;i<e.length;i++){if(n=e[i],null!==s&&s.contains(n))throw new Error(t+"contains a path "+s.toString()+" that is ancestor of another path "+n.toString());s=n}}(o,s)}},st=function(t,e,i,n){if(!n||void 0!==i){if(x(i))throw new Error(h.errorPrefix(t,e,n)+"is "+i.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!it(i))throw new Error(h.errorPrefix(t,e,n)+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},at=function(t,e,i,n){if(!n||void 0!==i)switch(i){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(h.errorPrefix(t,e,n)+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}},ht=function(t,e,i,n){if(!(n&&void 0===i||tt(i)))throw new Error(h.errorPrefix(t,e,n)+'was an invalid key = "'+i+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')},lt=function(t,e,i,n){if(!(n&&void 0===i||et(i)))throw new Error(h.errorPrefix(t,e,n)+'was an invalid path = "'+i+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},ut=function(t,e,i,n){i&&(i=i.replace(/^\/*\.info(\/|$)/,"/")),lt(t,e,i,n)},ct=function(t,e){if(".info"===e.getFront())throw new Error(t+" failed = Can't modify data under /.info/")},dt=function(t,e,i){var n=i.path.toString();if("string"!=typeof i.repoInfo.host||0===i.repoInfo.host.length||!tt(i.repoInfo.namespace)&&"localhost"!==i.repoInfo.host.split(":")[0]||0!==n.length&&!function(t){return t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),et(t)}(n))throw new Error(h.errorPrefix(t,e,!1)+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')},pt=function(t,e,i,n){if((!n||void 0!==i)&&"boolean"!=typeof i)throw new Error(h.errorPrefix(t,e,n)+"must be a boolean.")},ft=function(){function t(t,e){this.repo_=t,this.path_=e}return t.prototype.cancel=function(t){h.validateArgCount("OnDisconnect.cancel",0,1,arguments.length),h.validateCallback("OnDisconnect.cancel",1,t,!0);var e=new h.Deferred;return this.repo_.onDisconnectCancel(this.path_,e.wrapCallback(t)),e.promise},t.prototype.remove=function(t){h.validateArgCount("OnDisconnect.remove",0,1,arguments.length),ct("OnDisconnect.remove",this.path_),h.validateCallback("OnDisconnect.remove",1,t,!0);var e=new h.Deferred;return this.repo_.onDisconnectSet(this.path_,null,e.wrapCallback(t)),e.promise},t.prototype.set=function(t,e){h.validateArgCount("OnDisconnect.set",1,2,arguments.length),ct("OnDisconnect.set",this.path_),nt("OnDisconnect.set",1,t,this.path_,!1),h.validateCallback("OnDisconnect.set",2,e,!0);var i=new h.Deferred;return this.repo_.onDisconnectSet(this.path_,t,i.wrapCallback(e)),i.promise},t.prototype.setWithPriority=function(t,e,i){h.validateArgCount("OnDisconnect.setWithPriority",2,3,arguments.length),ct("OnDisconnect.setWithPriority",this.path_),nt("OnDisconnect.setWithPriority",1,t,this.path_,!1),st("OnDisconnect.setWithPriority",2,e,!1),h.validateCallback("OnDisconnect.setWithPriority",3,i,!0);var n=new h.Deferred;return this.repo_.onDisconnectSetWithPriority(this.path_,t,e,n.wrapCallback(i)),n.promise},t.prototype.update=function(t,e){if(h.validateArgCount("OnDisconnect.update",1,2,arguments.length),ct("OnDisconnect.update",this.path_),Array.isArray(t)){for(var i={},n=0;n<t.length;++n)i[""+n]=t[n];t=i,k("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}ot("OnDisconnect.update",1,t,this.path_,!1),h.validateCallback("OnDisconnect.update",2,e,!0);var r=new h.Deferred;return this.repo_.onDisconnectUpdate(this.path_,t,r.wrapCallback(e)),r.promise},t}(),yt=function(){function t(t,e){this.committed=t,this.snapshot=e}return t.prototype.toJSON=function(){return h.validateArgCount("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}},t}(),mt=(V="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",q=0,z=[],function(t){var e,i=t===q;q=t;var n=new Array(8);for(e=7;e>=0;e--)n[e]=V.charAt(t%64),t=Math.floor(t/64);h.assert(0===t,"Cannot push at time == 0");var r=n.join("");if(i){for(e=11;e>=0&&63===z[e];e--)z[e]=0;z[e]++}else for(e=0;e<12;e++)z[e]=Math.floor(64*Math.random());for(e=0;e<12;e++)r+=V.charAt(z[e]);return h.assert(20===r.length,"nextPushId: Length should be 20."),r}),vt=function(){function t(t,e){this.name=t,this.node=e}return t.Wrap=function(e,i){return new t(e,i)},t}(),gt=function(){function t(){}return t.prototype.getCompare=function(){return this.compare.bind(this)},t.prototype.indexedValueChanged=function(t,e){var i=new vt(I,t),n=new vt(I,e);return 0!==this.compare(i,n)},t.prototype.minPost=function(){return vt.MIN},t}(),_t=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a.__extends(e,t),Object.defineProperty(e,"__EMPTY_NODE",{get:function(){return Q},set:function(t){Q=t},enumerable:!0,configurable:!0}),e.prototype.compare=function(t,e){return N(t.name,e.name)},e.prototype.isDefinedOn=function(t){throw h.assertionError("KeyIndex.isDefinedOn not expected to be called.")},e.prototype.indexedValueChanged=function(t,e){return!1},e.prototype.minPost=function(){return vt.MIN},e.prototype.maxPost=function(){return new vt(O,Q)},e.prototype.makePost=function(t,e){return h.assert("string"==typeof t,"KeyIndex indexValue must always be a string."),new vt(t,Q)},e.prototype.toString=function(){return".key"},e}(gt),wt=new _t;var bt,St,Ct,Et=function(t){return"number"==typeof t?"number:"+F(t):"string:"+t},Tt=function(t){if(t.isLeafNode()){var e=t.val();h.assert("string"==typeof e||"number"==typeof e||"object"==typeof e&&h.contains(e,".sv"),"Priority must be a string or number.")}else h.assert(t===K||t.isEmpty(),"priority of unexpected type.");h.assert(t===K||t.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")},Pt=function(){function t(e,i){void 0===i&&(i=t.__childrenNodeConstructor.EMPTY_NODE),this.value_=e,this.priorityNode_=i,this.lazyHash_=null,h.assert(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),Tt(this.priorityNode_)}return Object.defineProperty(t,"__childrenNodeConstructor",{get:function(){return bt},set:function(t){bt=t},enumerable:!0,configurable:!0}),t.prototype.isLeafNode=function(){return!0},t.prototype.getPriority=function(){return this.priorityNode_},t.prototype.updatePriority=function(e){return new t(this.value_,e)},t.prototype.getImmediateChild=function(e){return".priority"===e?this.priorityNode_:t.__childrenNodeConstructor.EMPTY_NODE},t.prototype.getChild=function(e){return e.isEmpty()?this:".priority"===e.getFront()?this.priorityNode_:t.__childrenNodeConstructor.EMPTY_NODE},t.prototype.hasChild=function(){return!1},t.prototype.getPredecessorChildName=function(t,e){return null},t.prototype.updateImmediateChild=function(e,i){return".priority"===e?this.updatePriority(i):i.isEmpty()&&".priority"!==e?this:t.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,i).updatePriority(this.priorityNode_)},t.prototype.updateChild=function(e,i){var n=e.getFront();return null===n?i:i.isEmpty()&&".priority"!==n?this:(h.assert(".priority"!==n||1===e.getLength(),".priority must be the last token in a path"),this.updateImmediateChild(n,t.__childrenNodeConstructor.EMPTY_NODE.updateChild(e.popFront(),i)))},t.prototype.isEmpty=function(){return!1},t.prototype.numChildren=function(){return 0},t.prototype.forEachChild=function(t,e){return!1},t.prototype.val=function(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()},t.prototype.hash=function(){if(null===this.lazyHash_){var t="";this.priorityNode_.isEmpty()||(t+="priority:"+Et(this.priorityNode_.val())+":");var e=typeof this.value_;t+=e+":",t+="number"===e?F(this.value_):this.value_,this.lazyHash_=g(t)}return this.lazyHash_},t.prototype.getValue=function(){return this.value_},t.prototype.compareTo=function(e){return e===t.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof t.__childrenNodeConstructor?-1:(h.assert(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))},t.prototype.compareToLeafNode_=function(e){var i=typeof e.value_,n=typeof this.value_,r=t.VALUE_TYPE_ORDER.indexOf(i),o=t.VALUE_TYPE_ORDER.indexOf(n);return h.assert(r>=0,"Unknown leaf type: "+i),h.assert(o>=0,"Unknown leaf type: "+n),r===o?"object"===n?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:o-r},t.prototype.withIndex=function(){return this},t.prototype.isIndexed=function(){return!0},t.prototype.equals=function(t){if(t===this)return!0;if(t.isLeafNode()){var e=t;return this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_)}return!1},t.VALUE_TYPE_ORDER=["object","boolean","number","string"],t}();var kt,xt,It=new(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a.__extends(e,t),e.prototype.compare=function(t,e){var i=t.node.getPriority(),n=e.node.getPriority(),r=i.compareTo(n);return 0===r?N(t.name,e.name):r},e.prototype.isDefinedOn=function(t){return!t.getPriority().isEmpty()},e.prototype.indexedValueChanged=function(t,e){return!t.getPriority().equals(e.getPriority())},e.prototype.minPost=function(){return vt.MIN},e.prototype.maxPost=function(){return new vt(O,new Pt("[PRIORITY-POST]",Ct))},e.prototype.makePost=function(t,e){var i=St(t);return new vt(e,new Pt("[PRIORITY-POST]",i))},e.prototype.toString=function(){return".priority"},e}(gt)),Ot=function(){function t(t,e,i,n,r){void 0===r&&(r=null),this.isReverse_=n,this.resultGenerator_=r,this.nodeStack_=[];for(var o=1;!t.isEmpty();)if(t=t,o=e?i(t.key,e):1,n&&(o*=-1),o<0)t=this.isReverse_?t.left:t.right;else{if(0===o){this.nodeStack_.push(t);break}this.nodeStack_.push(t),t=this.isReverse_?t.right:t.left}}return t.prototype.getNext=function(){if(0===this.nodeStack_.length)return null;var t,e=this.nodeStack_.pop();if(t=this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t},t.prototype.hasNext=function(){return this.nodeStack_.length>0},t.prototype.peek=function(){if(0===this.nodeStack_.length)return null;var t=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value}},t}(),Nt=function(){function t(e,i,n,r,o){this.key=e,this.value=i,this.color=null!=n?n:t.RED,this.left=null!=r?r:Dt.EMPTY_NODE,this.right=null!=o?o:Dt.EMPTY_NODE}return t.prototype.copy=function(e,i,n,r,o){return new t(null!=e?e:this.key,null!=i?i:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=o?o:this.right)},t.prototype.count=function(){return this.left.count()+1+this.right.count()},t.prototype.isEmpty=function(){return!1},t.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||!!t(this.key,this.value)||this.right.inorderTraversal(t)},t.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},t.prototype.min_=function(){return this.left.isEmpty()?this:this.left.min_()},t.prototype.minKey=function(){return this.min_().key},t.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},t.prototype.insert=function(t,e,i){var n=this,r=i(t,n.key);return(n=r<0?n.copy(null,null,null,n.left.insert(t,e,i),null):0===r?n.copy(null,e,null,null,null):n.copy(null,null,null,null,n.right.insert(t,e,i))).fixUp_()},t.prototype.removeMin_=function(){if(this.left.isEmpty())return Dt.EMPTY_NODE;var t=this;return t.left.isRed_()||t.left.left.isRed_()||(t=t.moveRedLeft_()),(t=t.copy(null,null,null,t.left.removeMin_(),null)).fixUp_()},t.prototype.remove=function(t,e){var i,n;if(e(t,(i=this).key)<0)i.left.isEmpty()||i.left.isRed_()||i.left.left.isRed_()||(i=i.moveRedLeft_()),i=i.copy(null,null,null,i.left.remove(t,e),null);else{if(i.left.isRed_()&&(i=i.rotateRight_()),i.right.isEmpty()||i.right.isRed_()||i.right.left.isRed_()||(i=i.moveRedRight_()),0===e(t,i.key)){if(i.right.isEmpty())return Dt.EMPTY_NODE;n=i.right.min_(),i=i.copy(n.key,n.value,null,null,i.right.removeMin_())}i=i.copy(null,null,null,null,i.right.remove(t,e))}return i.fixUp_()},t.prototype.isRed_=function(){return this.color},t.prototype.fixUp_=function(){var t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t},t.prototype.moveRedLeft_=function(){var t=this.colorFlip_();return t.right.left.isRed_()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight_())).rotateLeft_()).colorFlip_()),t},t.prototype.moveRedRight_=function(){var t=this.colorFlip_();return t.left.left.isRed_()&&(t=(t=t.rotateRight_()).colorFlip_()),t},t.prototype.rotateLeft_=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.rotateRight_=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.colorFlip_=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.checkMaxDepth_=function(){var t=this.check_();return Math.pow(2,t)<=this.count()+1},t.prototype.check_=function(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");var t=this.left.check_();if(t!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)},t.RED=!0,t.BLACK=!1,t}(),Rt=function(){function t(){}return t.prototype.copy=function(t,e,i,n,r){return this},t.prototype.insert=function(t,e,i){return new Nt(t,e,null)},t.prototype.remove=function(t,e){return this},t.prototype.count=function(){return 0},t.prototype.isEmpty=function(){return!0},t.prototype.inorderTraversal=function(t){return!1},t.prototype.reverseTraversal=function(t){return!1},t.prototype.minKey=function(){return null},t.prototype.maxKey=function(){return null},t.prototype.check_=function(){return 0},t.prototype.isRed_=function(){return!1},t}(),Dt=function(){function t(e,i){void 0===i&&(i=t.EMPTY_NODE),this.comparator_=e,this.root_=i}return t.prototype.insert=function(e,i){return new t(this.comparator_,this.root_.insert(e,i,this.comparator_).copy(null,null,Nt.BLACK,null,null))},t.prototype.remove=function(e){return new t(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Nt.BLACK,null,null))},t.prototype.get=function(t){for(var e,i=this.root_;!i.isEmpty();){if(0===(e=this.comparator_(t,i.key)))return i.value;e<0?i=i.left:e>0&&(i=i.right)}return null},t.prototype.getPredecessorKey=function(t){for(var e,i=this.root_,n=null;!i.isEmpty();){if(0===(e=this.comparator_(t,i.key))){if(i.left.isEmpty())return n?n.key:null;for(i=i.left;!i.right.isEmpty();)i=i.right;return i.key}e<0?i=i.left:e>0&&(n=i,i=i.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")},t.prototype.isEmpty=function(){return this.root_.isEmpty()},t.prototype.count=function(){return this.root_.count()},t.prototype.minKey=function(){return this.root_.minKey()},t.prototype.maxKey=function(){return this.root_.maxKey()},t.prototype.inorderTraversal=function(t){return this.root_.inorderTraversal(t)},t.prototype.reverseTraversal=function(t){return this.root_.reverseTraversal(t)},t.prototype.getIterator=function(t){return new Ot(this.root_,null,this.comparator_,!1,t)},t.prototype.getIteratorFrom=function(t,e){return new Ot(this.root_,t,this.comparator_,!1,e)},t.prototype.getReverseIteratorFrom=function(t,e){return new Ot(this.root_,t,this.comparator_,!0,e)},t.prototype.getReverseIterator=function(t){return new Ot(this.root_,null,this.comparator_,!0,t)},t.EMPTY_NODE=new Rt,t}(),At=Math.log(2),Mt=function(){function t(t){var e;this.count=(e=t+1,parseInt(Math.log(e)/At,10)),this.current_=this.count-1;var i,n=(i=this.count,parseInt(Array(i+1).join("1"),2));this.bits_=t+1&n}return t.prototype.nextBitIsOne=function(){var t=!(this.bits_&1<<this.current_);return this.current_--,t},t}(),Lt=function(t,e,i,n){t.sort(e);var r=function(e,n){var o,s,a=n-e;if(0===a)return null;if(1===a)return o=t[e],s=i?i(o):o,new Nt(s,o.node,Nt.BLACK,null,null);var h=parseInt(a/2,10)+e,l=r(e,h),u=r(h+1,n);return o=t[h],s=i?i(o):o,new Nt(s,o.node,Nt.BLACK,l,u)},o=function(e){for(var n=null,o=null,s=t.length,a=function(e,n){var o=s-e,a=s;s-=e;var l=r(o+1,a),u=t[o],c=i?i(u):u;h(new Nt(c,u.node,n,null,l))},h=function(t){n?(n.left=t,n=t):(o=t,n=t)},l=0;l<e.count;++l){var u=e.nextBitIsOne(),c=Math.pow(2,e.count-(l+1));u?a(c,Nt.BLACK):(a(c,Nt.BLACK),a(c,Nt.RED))}return o}(new Mt(t.length));return new Dt(n||e,o)},Ft={},jt=function(){function t(t,e){this.indexes_=t,this.indexSet_=e}return Object.defineProperty(t,"Default",{get:function(){return h.assert(Ft&&It,"ChildrenNode.ts has not been loaded"),kt=kt||new t({".priority":Ft},{".priority":It})},enumerable:!0,configurable:!0}),t.prototype.get=function(t){var e=h.safeGet(this.indexes_,t);if(!e)throw new Error("No index defined for "+t);return e instanceof Dt?e:null},t.prototype.hasIndex=function(t){return h.contains(this.indexSet_,t.toString())},t.prototype.addIndex=function(e,i){h.assert(e!==wt,"KeyIndex always exists and isn't meant to be added to the IndexMap.");for(var n,r=[],o=!1,s=i.getIterator(vt.Wrap),l=s.getNext();l;)o=o||e.isDefinedOn(l.node),r.push(l),l=s.getNext();n=o?Lt(r,e.getCompare()):Ft;var u=e.toString(),c=a.__assign({},this.indexSet_);c[u]=e;var d=a.__assign({},this.indexes_);return d[u]=n,new t(d,c)},t.prototype.addToIndexes=function(e,i){var n=this;return new t(h.map(this.indexes_,(function(t,r){var o=h.safeGet(n.indexSet_,r);if(h.assert(o,"Missing index implementation for "+r),t===Ft){if(o.isDefinedOn(e.node)){for(var s=[],a=i.getIterator(vt.Wrap),l=a.getNext();l;)l.name!==e.name&&s.push(l),l=a.getNext();return s.push(e),Lt(s,o.getCompare())}return Ft}var u=i.get(e.name),c=t;return u&&(c=c.remove(new vt(e.name,u))),c.insert(e,e.node)})),this.indexSet_)},t.prototype.removeFromIndexes=function(e,i){return new t(h.map(this.indexes_,(function(t){if(t===Ft)return t;var n=i.get(e.name);return n?t.remove(new vt(e.name,n)):t})),this.indexSet_)},t}();
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Wt(t,e){return N(t.name,e.name)}function Ht(t,e){return N(t,e)}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Yt=function(){function t(t,e,i){this.children_=t,this.priorityNode_=e,this.indexMap_=i,this.lazyHash_=null,this.priorityNode_&&Tt(this.priorityNode_),this.children_.isEmpty()&&h.assert(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}return Object.defineProperty(t,"EMPTY_NODE",{get:function(){return xt||(xt=new t(new Dt(Ht),null,jt.Default))},enumerable:!0,configurable:!0}),t.prototype.isLeafNode=function(){return!1},t.prototype.getPriority=function(){return this.priorityNode_||xt},t.prototype.updatePriority=function(e){return this.children_.isEmpty()?this:new t(this.children_,e,this.indexMap_)},t.prototype.getImmediateChild=function(t){if(".priority"===t)return this.getPriority();var e=this.children_.get(t);return null===e?xt:e},t.prototype.getChild=function(t){var e=t.getFront();return null===e?this:this.getImmediateChild(e).getChild(t.popFront())},t.prototype.hasChild=function(t){return null!==this.children_.get(t)},t.prototype.updateImmediateChild=function(e,i){if(h.assert(i,"We should always be passing snapshot nodes"),".priority"===e)return this.updatePriority(i);var n=new vt(e,i),r=void 0,o=void 0;i.isEmpty()?(r=this.children_.remove(e),o=this.indexMap_.removeFromIndexes(n,this.children_)):(r=this.children_.insert(e,i),o=this.indexMap_.addToIndexes(n,this.children_));var s=r.isEmpty()?xt:this.priorityNode_;return new t(r,s,o)},t.prototype.updateChild=function(t,e){var i=t.getFront();if(null===i)return e;h.assert(".priority"!==t.getFront()||1===t.getLength(),".priority must be the last token in a path");var n=this.getImmediateChild(i).updateChild(t.popFront(),e);return this.updateImmediateChild(i,n)},t.prototype.isEmpty=function(){return this.children_.isEmpty()},t.prototype.numChildren=function(){return this.children_.count()},t.prototype.val=function(e){if(this.isEmpty())return null;var i={},n=0,r=0,o=!0;if(this.forEachChild(It,(function(s,a){i[s]=a.val(e),n++,o&&t.INTEGER_REGEXP_.test(s)?r=Math.max(r,Number(s)):o=!1})),!e&&o&&r<2*n){var s=[];for(var a in i)s[a]=i[a];return s}return e&&!this.getPriority().isEmpty()&&(i[".priority"]=this.getPriority().val()),i},t.prototype.hash=function(){if(null===this.lazyHash_){var t="";this.getPriority().isEmpty()||(t+="priority:"+Et(this.getPriority().val())+":"),this.forEachChild(It,(function(e,i){var n=i.hash();""!==n&&(t+=":"+e+":"+n)})),this.lazyHash_=""===t?"":g(t)}return this.lazyHash_},t.prototype.getPredecessorChildName=function(t,e,i){var n=this.resolveIndex_(i);if(n){var r=n.getPredecessorKey(new vt(t,e));return r?r.name:null}return this.children_.getPredecessorKey(t)},t.prototype.getFirstChildName=function(t){var e=this.resolveIndex_(t);if(e){var i=e.minKey();return i&&i.name}return this.children_.minKey()},t.prototype.getFirstChild=function(t){var e=this.getFirstChildName(t);return e?new vt(e,this.children_.get(e)):null},t.prototype.getLastChildName=function(t){var e=this.resolveIndex_(t);if(e){var i=e.maxKey();return i&&i.name}return this.children_.maxKey()},t.prototype.getLastChild=function(t){var e=this.getLastChildName(t);return e?new vt(e,this.children_.get(e)):null},t.prototype.forEachChild=function(t,e){var i=this.resolveIndex_(t);return i?i.inorderTraversal((function(t){return e(t.name,t.node)})):this.children_.inorderTraversal(e)},t.prototype.getIterator=function(t){return this.getIteratorFrom(t.minPost(),t)},t.prototype.getIteratorFrom=function(t,e){var i=this.resolveIndex_(e);if(i)return i.getIteratorFrom(t,(function(t){return t}));for(var n=this.children_.getIteratorFrom(t.name,vt.Wrap),r=n.peek();null!=r&&e.compare(r,t)<0;)n.getNext(),r=n.peek();return n},t.prototype.getReverseIterator=function(t){return this.getReverseIteratorFrom(t.maxPost(),t)},t.prototype.getReverseIteratorFrom=function(t,e){var i=this.resolveIndex_(e);if(i)return i.getReverseIteratorFrom(t,(function(t){return t}));for(var n=this.children_.getReverseIteratorFrom(t.name,vt.Wrap),r=n.peek();null!=r&&e.compare(r,t)>0;)n.getNext(),r=n.peek();return n},t.prototype.compareTo=function(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===Bt?-1:0},t.prototype.withIndex=function(e){if(e===wt||this.indexMap_.hasIndex(e))return this;var i=this.indexMap_.addIndex(e,this.children_);return new t(this.children_,this.priorityNode_,i)},t.prototype.isIndexed=function(t){return t===wt||this.indexMap_.hasIndex(t)},t.prototype.equals=function(t){if(t===this)return!0;if(t.isLeafNode())return!1;var e=t;if(this.getPriority().equals(e.getPriority())){if(this.children_.count()===e.children_.count()){for(var i=this.getIterator(It),n=e.getIterator(It),r=i.getNext(),o=n.getNext();r&&o;){if(r.name!==o.name||!r.node.equals(o.node))return!1;r=i.getNext(),o=n.getNext()}return null===r&&null===o}return!1}return!1},t.prototype.resolveIndex_=function(t){return t===wt?null:this.indexMap_.get(t.toString())},t.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,t}(),Bt=new(function(t){function e(){return t.call(this,new Dt(Ht),Yt.EMPTY_NODE,jt.Default)||this}return a.__extends(e,t),e.prototype.compareTo=function(t){return t===this?0:1},e.prototype.equals=function(t){return t===this},e.prototype.getPriority=function(){return this},e.prototype.getImmediateChild=function(t){return Yt.EMPTY_NODE},e.prototype.isEmpty=function(){return!1},e}(Yt));Object.defineProperties(vt,{MIN:{value:new vt(I,Yt.EMPTY_NODE)},MAX:{value:new vt(O,Bt)}}),_t.__EMPTY_NODE=Yt.EMPTY_NODE,Pt.__childrenNodeConstructor=Yt,K=Bt,function(t){Ct=t}(Bt);function Ut(t,e){if(void 0===e&&(e=null),null===t)return Yt.EMPTY_NODE;if("object"==typeof t&&".priority"in t&&(e=t[".priority"]),h.assert(null===e||"string"==typeof e||"number"==typeof e||"object"==typeof e&&".sv"in e,"Invalid priority type found: "+typeof e),"object"==typeof t&&".value"in t&&null!==t[".value"]&&(t=t[".value"]),"object"!=typeof t||".sv"in t)return new Pt(t,Ut(e));if(t instanceof Array){var i=Yt.EMPTY_NODE;return L(t,(function(e,n){if(h.contains(t,e)&&"."!==e.substring(0,1)){var r=Ut(n);!r.isLeafNode()&&r.isEmpty()||(i=i.updateImmediateChild(e,r))}})),i.updatePriority(Ut(e))}var n=[],r=!1;if(L(t,(function(t,e){if("."!==t.substring(0,1)){var i=Ut(e);i.isEmpty()||(r=r||!i.getPriority().isEmpty(),n.push(new vt(t,i)))}})),0===n.length)return Yt.EMPTY_NODE;var o=Lt(n,Wt,(function(t){return t.name}),Ht);if(r){var s=Lt(n,It.getCompare());return new Yt(o,Ut(e),new jt({".priority":s},{".priority":It}))}return new Yt(o,Ut(e),jt.Default)}!function(t){St=t}(Ut);
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Xt,Vt,qt=new(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a.__extends(e,t),e.prototype.compare=function(t,e){var i=t.node.compareTo(e.node);return 0===i?N(t.name,e.name):i},e.prototype.isDefinedOn=function(t){return!0},e.prototype.indexedValueChanged=function(t,e){return!t.equals(e)},e.prototype.minPost=function(){return vt.MIN},e.prototype.maxPost=function(){return vt.MAX},e.prototype.makePost=function(t,e){var i=Ut(t);return new vt(e,i)},e.prototype.toString=function(){return".value"},e}(gt)),zt=function(t){function e(e){var i=t.call(this)||this;return i.indexPath_=e,h.assert(!e.isEmpty()&&".priority"!==e.getFront(),"Can't create PathIndex with empty path or .priority key"),i}return a.__extends(e,t),e.prototype.extractChild=function(t){return t.getChild(this.indexPath_)},e.prototype.isDefinedOn=function(t){return!t.getChild(this.indexPath_).isEmpty()},e.prototype.compare=function(t,e){var i=this.extractChild(t.node),n=this.extractChild(e.node),r=i.compareTo(n);return 0===r?N(t.name,e.name):r},e.prototype.makePost=function(t,e){var i=Ut(t),n=Yt.EMPTY_NODE.updateChild(this.indexPath_,i);return new vt(e,n)},e.prototype.maxPost=function(){var t=Yt.EMPTY_NODE.updateChild(this.indexPath_,Bt);return new vt(O,t)},e.prototype.toString=function(){return this.indexPath_.slice().join("/")},e}(gt),Qt=function(){function t(t,e,i){this.node_=t,this.ref_=e,this.index_=i}return t.prototype.val=function(){return h.validateArgCount("DataSnapshot.val",0,0,arguments.length),this.node_.val()},t.prototype.exportVal=function(){return h.validateArgCount("DataSnapshot.exportVal",0,0,arguments.length),this.node_.val(!0)},t.prototype.toJSON=function(){return h.validateArgCount("DataSnapshot.toJSON",0,1,arguments.length),this.exportVal()},t.prototype.exists=function(){return h.validateArgCount("DataSnapshot.exists",0,0,arguments.length),!this.node_.isEmpty()},t.prototype.child=function(e){h.validateArgCount("DataSnapshot.child",0,1,arguments.length),e=String(e),lt("DataSnapshot.child",1,e,!1);var i=new B(e),n=this.ref_.child(i);return new t(this.node_.getChild(i),n,It)},t.prototype.hasChild=function(t){h.validateArgCount("DataSnapshot.hasChild",1,1,arguments.length),lt("DataSnapshot.hasChild",1,t,!1);var e=new B(t);return!this.node_.getChild(e).isEmpty()},t.prototype.getPriority=function(){return h.validateArgCount("DataSnapshot.getPriority",0,0,arguments.length),this.node_.getPriority().val()},t.prototype.forEach=function(e){var i=this;if(h.validateArgCount("DataSnapshot.forEach",1,1,arguments.length),h.validateCallback("DataSnapshot.forEach",1,e,!1),this.node_.isLeafNode())return!1;var n=this.node_;return!!n.forEachChild(this.index_,(function(n,r){return e(new t(r,i.ref_.child(n),It))}))},t.prototype.hasChildren=function(){return h.validateArgCount("DataSnapshot.hasChildren",0,0,arguments.length),!this.node_.isLeafNode()&&!this.node_.isEmpty()},Object.defineProperty(t.prototype,"key",{get:function(){return this.ref_.getKey()},enumerable:!0,configurable:!0}),t.prototype.numChildren=function(){return h.validateArgCount("DataSnapshot.numChildren",0,0,arguments.length),this.node_.numChildren()},t.prototype.getRef=function(){return h.validateArgCount("DataSnapshot.ref",0,0,arguments.length),this.ref_},Object.defineProperty(t.prototype,"ref",{get:function(){return this.getRef()},enumerable:!0,configurable:!0}),t}(),Kt=function(){function t(t,e,i,n){this.eventType=t,this.eventRegistration=e,this.snapshot=i,this.prevName=n}return t.prototype.getPath=function(){var t=this.snapshot.getRef();return"value"===this.eventType?t.path:t.getParent().path},t.prototype.getEventType=function(){return this.eventType},t.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},t.prototype.toString=function(){return this.getPath().toString()+":"+this.eventType+":"+h.stringify(this.snapshot.exportVal())},t}(),Gt=function(){function t(t,e,i){this.eventRegistration=t,this.error=e,this.path=i}return t.prototype.getPath=function(){return this.path},t.prototype.getEventType=function(){return"cancel"},t.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},t.prototype.toString=function(){return this.path.toString()+":cancel"},t}(),$t=function(){function t(t,e,i){this.callback_=t,this.cancelCallback_=e,this.context_=i}return t.prototype.respondsTo=function(t){return"value"===t},t.prototype.createEvent=function(t,e){var i=e.getQueryParams().getIndex();return new Kt("value",this,new Qt(t.snapshotNode,e.getRef(),i))},t.prototype.getEventRunner=function(t){var e=this.context_;if("cancel"===t.getEventType()){h.assert(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var i=this.cancelCallback_;return function(){i.call(e,t.error)}}var n=this.callback_;return function(){n.call(e,t.snapshot)}},t.prototype.createCancelEvent=function(t,e){return this.cancelCallback_?new Gt(this,t,e):null},t.prototype.matches=function(e){return e instanceof t&&(!e.callback_||!this.callback_||e.callback_===this.callback_&&e.context_===this.context_)},t.prototype.hasAnyCallback=function(){return null!==this.callback_},t}(),Jt=function(){function t(t,e,i){this.callbacks_=t,this.cancelCallback_=e,this.context_=i}return t.prototype.respondsTo=function(t){var e="children_added"===t?"child_added":t;return e="children_removed"===e?"child_removed":e,h.contains(this.callbacks_,e)},t.prototype.createCancelEvent=function(t,e){return this.cancelCallback_?new Gt(this,t,e):null},t.prototype.createEvent=function(t,e){h.assert(null!=t.childName,"Child events should have a childName.");var i=e.getRef().child(t.childName),n=e.getQueryParams().getIndex();return new Kt(t.type,this,new Qt(t.snapshotNode,i,n),t.prevName)},t.prototype.getEventRunner=function(t){var e=this.context_;if("cancel"===t.getEventType()){h.assert(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var i=this.cancelCallback_;return function(){i.call(e,t.error)}}var n=this.callbacks_[t.eventType];return function(){n.call(e,t.snapshot,t.prevName)}},t.prototype.matches=function(e){var i=this;if(e instanceof t){if(!this.callbacks_||!e.callbacks_)return!0;if(this.context_===e.context_){var n=Object.keys(e.callbacks_),r=Object.keys(this.callbacks_),o=n.length;if(o===r.length){if(1===o){var s=n[0],a=r[0];return!(a!==s||e.callbacks_[s]&&this.callbacks_[a]&&e.callbacks_[s]!==this.callbacks_[a])}return r.every((function(t){return e.callbacks_[t]===i.callbacks_[t]}))}}}return!1},t.prototype.hasAnyCallback=function(){return null!==this.callbacks_},t}(),Zt=function(){function t(t,e,i,n){this.repo=t,this.path=e,this.queryParams_=i,this.orderByCalled_=n}return Object.defineProperty(t,"__referenceConstructor",{get:function(){return h.assert(Xt,"Reference.ts has not been loaded"),Xt},set:function(t){Xt=t},enumerable:!0,configurable:!0}),t.validateQueryEndpoints_=function(t){var e=null,i=null;if(t.hasStart()&&(e=t.getIndexStartValue()),t.hasEnd()&&(i=t.getIndexEndValue()),t.getIndex()===wt){var n="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",r="Query: When ordering by key, the argument passed to startAt(), endAt(),or equalTo() must be a string.";if(t.hasStart()){if(t.getIndexStartName()!==I)throw new Error(n);if("string"!=typeof e)throw new Error(r)}if(t.hasEnd()){if(t.getIndexEndName()!==O)throw new Error(n);if("string"!=typeof i)throw new Error(r)}}else if(t.getIndex()===It){if(null!=e&&!it(e)||null!=i&&!it(i))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), endAt(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(h.assert(t.getIndex()instanceof zt||t.getIndex()===qt,"unknown index type."),null!=e&&"object"==typeof e||null!=i&&"object"==typeof i)throw new Error("Query: First argument passed to startAt(), endAt(), or equalTo() cannot be an object.")},t.validateLimit_=function(t){if(t.hasStart()&&t.hasEnd()&&t.hasLimit()&&!t.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), endAt(), and limit(). Use limitToFirst() or limitToLast() instead.")},t.prototype.validateNoPreviousOrderByCall_=function(t){if(!0===this.orderByCalled_)throw new Error(t+": You can't combine multiple orderBy calls.")},t.prototype.getQueryParams=function(){return this.queryParams_},t.prototype.getRef=function(){return h.validateArgCount("Query.ref",0,0,arguments.length),new t.__referenceConstructor(this.repo,this.path)},t.prototype.on=function(e,i,n,r){h.validateArgCount("Query.on",2,4,arguments.length),at("Query.on",1,e,!1),h.validateCallback("Query.on",2,i,!1);var o=t.getCancelAndContextArgs_("Query.on",n,r);if("value"===e)this.onValueEvent(i,o.cancel,o.context);else{var s={};s[e]=i,this.onChildEvent(s,o.cancel,o.context)}return i},t.prototype.onValueEvent=function(t,e,i){var n=new $t(t,e||null,i||null);this.repo.addEventCallbackForQuery(this,n)},t.prototype.onChildEvent=function(t,e,i){var n=new Jt(t,e,i);this.repo.addEventCallbackForQuery(this,n)},t.prototype.off=function(t,e,i){h.validateArgCount("Query.off",0,3,arguments.length),at("Query.off",1,t,!0),h.validateCallback("Query.off",2,e,!0),h.validateContextObject("Query.off",3,i,!0);var n=null,r=null;if("value"===t){var o=e||null;n=new $t(o,null,i||null)}else t&&(e&&((r={})[t]=e),n=new Jt(r,null,i||null));this.repo.removeEventCallbackForQuery(this,n)},t.prototype.once=function(e,i,n,r){var o=this;h.validateArgCount("Query.once",1,4,arguments.length),at("Query.once",1,e,!1),h.validateCallback("Query.once",2,i,!0);var s=t.getCancelAndContextArgs_("Query.once",n,r),a=!0,l=new h.Deferred;l.promise.catch((function(){}));var u=function(t){a&&(a=!1,o.off(e,u),i&&i.bind(s.context)(t),l.resolve(t))};return this.on(e,u,(function(t){o.off(e,u),s.cancel&&s.cancel.bind(s.context)(t),l.reject(t)})),l.promise},t.prototype.limitToFirst=function(e){if(h.validateArgCount("Query.limitToFirst",1,1,arguments.length),"number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("Query.limitToFirst: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToFirst: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new t(this.repo,this.path,this.queryParams_.limitToFirst(e),this.orderByCalled_)},t.prototype.limitToLast=function(e){if(h.validateArgCount("Query.limitToLast",1,1,arguments.length),"number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("Query.limitToLast: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToLast: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new t(this.repo,this.path,this.queryParams_.limitToLast(e),this.orderByCalled_)},t.prototype.orderByChild=function(e){if(h.validateArgCount("Query.orderByChild",1,1,arguments.length),"$key"===e)throw new Error('Query.orderByChild: "$key" is invalid.  Use Query.orderByKey() instead.');if("$priority"===e)throw new Error('Query.orderByChild: "$priority" is invalid.  Use Query.orderByPriority() instead.');if("$value"===e)throw new Error('Query.orderByChild: "$value" is invalid.  Use Query.orderByValue() instead.');lt("Query.orderByChild",1,e,!1),this.validateNoPreviousOrderByCall_("Query.orderByChild");var i=new B(e);if(i.isEmpty())throw new Error("Query.orderByChild: cannot pass in empty path.  Use Query.orderByValue() instead.");var n=new zt(i),r=this.queryParams_.orderBy(n);return t.validateQueryEndpoints_(r),new t(this.repo,this.path,r,!0)},t.prototype.orderByKey=function(){h.validateArgCount("Query.orderByKey",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByKey");var e=this.queryParams_.orderBy(wt);return t.validateQueryEndpoints_(e),new t(this.repo,this.path,e,!0)},t.prototype.orderByPriority=function(){h.validateArgCount("Query.orderByPriority",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByPriority");var e=this.queryParams_.orderBy(It);return t.validateQueryEndpoints_(e),new t(this.repo,this.path,e,!0)},t.prototype.orderByValue=function(){h.validateArgCount("Query.orderByValue",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByValue");var e=this.queryParams_.orderBy(qt);return t.validateQueryEndpoints_(e),new t(this.repo,this.path,e,!0)},t.prototype.startAt=function(e,i){void 0===e&&(e=null),h.validateArgCount("Query.startAt",0,2,arguments.length),nt("Query.startAt",1,e,this.path,!0),ht("Query.startAt",2,i,!0);var n=this.queryParams_.startAt(e,i);if(t.validateLimit_(n),t.validateQueryEndpoints_(n),this.queryParams_.hasStart())throw new Error("Query.startAt: Starting point was already set (by another call to startAt or equalTo).");return void 0===e&&(e=null,i=null),new t(this.repo,this.path,n,this.orderByCalled_)},t.prototype.endAt=function(e,i){void 0===e&&(e=null),h.validateArgCount("Query.endAt",0,2,arguments.length),nt("Query.endAt",1,e,this.path,!0),ht("Query.endAt",2,i,!0);var n=this.queryParams_.endAt(e,i);if(t.validateLimit_(n),t.validateQueryEndpoints_(n),this.queryParams_.hasEnd())throw new Error("Query.endAt: Ending point was already set (by another call to endAt or equalTo).");return new t(this.repo,this.path,n,this.orderByCalled_)},t.prototype.equalTo=function(t,e){if(h.validateArgCount("Query.equalTo",1,2,arguments.length),nt("Query.equalTo",1,t,this.path,!1),ht("Query.equalTo",2,e,!0),this.queryParams_.hasStart())throw new Error("Query.equalTo: Starting point was already set (by another call to startAt or equalTo).");if(this.queryParams_.hasEnd())throw new Error("Query.equalTo: Ending point was already set (by another call to endAt or equalTo).");return this.startAt(t,e).endAt(t,e)},t.prototype.toString=function(){return h.validateArgCount("Query.toString",0,0,arguments.length),this.repo.toString()+this.path.toUrlEncodedString()},t.prototype.toJSON=function(){return h.validateArgCount("Query.toJSON",0,1,arguments.length),this.toString()},t.prototype.queryObject=function(){return this.queryParams_.getQueryObject()},t.prototype.queryIdentifier=function(){var t=this.queryObject(),e=A(t);return"{}"===e?"default":e},t.prototype.isEqual=function(e){if(h.validateArgCount("Query.isEqual",1,1,arguments.length),!(e instanceof t)){var i="Query.isEqual failed: First argument must be an instance of firebase.database.Query.";throw new Error(i)}var n=this.repo===e.repo,r=this.path.equals(e.path),o=this.queryIdentifier()===e.queryIdentifier();return n&&r&&o},t.getCancelAndContextArgs_=function(t,e,i){var n={cancel:null,context:null};if(e&&i)n.cancel=e,h.validateCallback(t,3,n.cancel,!0),n.context=i,h.validateContextObject(t,4,n.context,!0);else if(e)if("object"==typeof e&&null!==e)n.context=e;else{if("function"!=typeof e)throw new Error(h.errorPrefix(t,3,!0)+" must either be a cancel callback or a context object.");n.cancel=e}return n},Object.defineProperty(t.prototype,"ref",{get:function(){return this.getRef()},enumerable:!0,configurable:!0}),t}(),te=function(){function t(){this.value=null,this.children=new Map}return t.prototype.find=function(t){if(null!=this.value)return this.value.getChild(t);if(!t.isEmpty()&&this.children.size>0){var e=t.getFront();return t=t.popFront(),this.children.has(e)?this.children.get(e).find(t):null}return null},t.prototype.remember=function(e,i){if(e.isEmpty())this.value=i,this.children.clear();else if(null!==this.value)this.value=this.value.updateChild(e,i);else{var n=e.getFront();this.children.has(n)||this.children.set(n,new t);var r=this.children.get(n);e=e.popFront(),r.remember(e,i)}},t.prototype.forget=function(t){if(t.isEmpty())return this.value=null,this.children.clear(),!0;if(null!==this.value){if(this.value.isLeafNode())return!1;var e=this.value;this.value=null;var i=this;return e.forEachChild(It,(function(t,e){i.remember(new B(t),e)})),this.forget(t)}if(this.children.size>0){var n=t.getFront();if(t=t.popFront(),this.children.has(n))this.children.get(n).forget(t)&&this.children.delete(n);return 0===this.children.size}return!0},t.prototype.forEachTree=function(t,e){null!==this.value?e(t,this.value):this.forEachChild((function(i,n){var r=new B(t.toString()+"/"+i);n.forEachTree(r,e)}))},t.prototype.forEachChild=function(t){this.children.forEach((function(e,i){t(i,e)}))},t}(),ee=function(t,e){return t&&"object"==typeof t?(h.assert(".sv"in t,"Unexpected leaf node or priority contents"),e[t[".sv"]]):t},ie=function(t,e){var i,n=t.getPriority().val(),r=ee(n,e);if(t.isLeafNode()){var o=t,s=ee(o.getValue(),e);return s!==o.getValue()||r!==o.getPriority().val()?new Pt(s,Ut(r)):t}var a=t;return i=a,r!==a.getPriority().val()&&(i=i.updatePriority(new Pt(r))),a.forEachChild(It,(function(t,n){var r=ie(n,e);r!==n&&(i=i.updateImmediateChild(t,r))})),i};!function(t){t[t.OVERWRITE=0]="OVERWRITE",t[t.MERGE=1]="MERGE",t[t.ACK_USER_WRITE=2]="ACK_USER_WRITE",t[t.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"}(Vt||(Vt={}));var ne,re,oe=function(){function t(t,e,i,n){this.fromUser=t,this.fromServer=e,this.queryId=i,this.tagged=n,h.assert(!n||e,"Tagged queries must be from server.")}return t.User=new t(!0,!1,null,!1),t.Server=new t(!1,!0,null,!1),t.forServerTaggedQuery=function(e){return new t(!1,!0,e,!0)},t}(),se=function(){function t(t,e,i){this.path=t,this.affectedTree=e,this.revert=i,this.type=Vt.ACK_USER_WRITE,this.source=oe.User}return t.prototype.operationForChild=function(e){if(this.path.isEmpty()){if(null!=this.affectedTree.value)return h.assert(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;var i=this.affectedTree.subtree(new B(e));return new t(B.Empty,i,this.revert)}return h.assert(this.path.getFront()===e,"operationForChild called for unrelated child."),new t(this.path.popFront(),this.affectedTree,this.revert)},t}(),ae=function(){function t(t,e){void 0===e&&(ne||(ne=new Dt(R)),e=ne),this.value=t,this.children=e}return t.fromObject=function(e){var i=t.Empty;return L(e,(function(t,e){i=i.set(new B(t),e)})),i},t.prototype.isEmpty=function(){return null===this.value&&this.children.isEmpty()},t.prototype.findRootMostMatchingPathAndValue=function(t,e){if(null!=this.value&&e(this.value))return{path:B.Empty,value:this.value};if(t.isEmpty())return null;var i=t.getFront(),n=this.children.get(i);if(null!==n){var r=n.findRootMostMatchingPathAndValue(t.popFront(),e);return null!=r?{path:new B(i).child(r.path),value:r.value}:null}return null},t.prototype.findRootMostValueAndPath=function(t){return this.findRootMostMatchingPathAndValue(t,(function(){return!0}))},t.prototype.subtree=function(e){if(e.isEmpty())return this;var i=e.getFront(),n=this.children.get(i);return null!==n?n.subtree(e.popFront()):t.Empty},t.prototype.set=function(e,i){if(e.isEmpty())return new t(i,this.children);var n=e.getFront(),r=(this.children.get(n)||t.Empty).set(e.popFront(),i),o=this.children.insert(n,r);return new t(this.value,o)},t.prototype.remove=function(e){if(e.isEmpty())return this.children.isEmpty()?t.Empty:new t(null,this.children);var i=e.getFront(),n=this.children.get(i);if(n){var r=n.remove(e.popFront()),o=void 0;return o=r.isEmpty()?this.children.remove(i):this.children.insert(i,r),null===this.value&&o.isEmpty()?t.Empty:new t(this.value,o)}return this},t.prototype.get=function(t){if(t.isEmpty())return this.value;var e=t.getFront(),i=this.children.get(e);return i?i.get(t.popFront()):null},t.prototype.setTree=function(e,i){if(e.isEmpty())return i;var n=e.getFront(),r=(this.children.get(n)||t.Empty).setTree(e.popFront(),i),o=void 0;return o=r.isEmpty()?this.children.remove(n):this.children.insert(n,r),new t(this.value,o)},t.prototype.fold=function(t){return this.fold_(B.Empty,t)},t.prototype.fold_=function(t,e){var i={};return this.children.inorderTraversal((function(n,r){i[n]=r.fold_(t.child(n),e)})),e(t,this.value,i)},t.prototype.findOnPath=function(t,e){return this.findOnPath_(t,B.Empty,e)},t.prototype.findOnPath_=function(t,e,i){var n=!!this.value&&i(e,this.value);if(n)return n;if(t.isEmpty())return null;var r=t.getFront(),o=this.children.get(r);return o?o.findOnPath_(t.popFront(),e.child(r),i):null},t.prototype.foreachOnPath=function(t,e){return this.foreachOnPath_(t,B.Empty,e)},t.prototype.foreachOnPath_=function(e,i,n){if(e.isEmpty())return this;this.value&&n(i,this.value);var r=e.getFront(),o=this.children.get(r);return o?o.foreachOnPath_(e.popFront(),i.child(r),n):t.Empty},t.prototype.foreach=function(t){this.foreach_(B.Empty,t)},t.prototype.foreach_=function(t,e){this.children.inorderTraversal((function(i,n){n.foreach_(t.child(i),e)})),this.value&&e(t,this.value)},t.prototype.foreachChild=function(t){this.children.inorderTraversal((function(e,i){i.value&&t(e,i.value)}))},t.Empty=new t(null),t}(),he=function(){function t(t,e){this.source=t,this.path=e,this.type=Vt.LISTEN_COMPLETE}return t.prototype.operationForChild=function(e){return this.path.isEmpty()?new t(this.source,B.Empty):new t(this.source,this.path.popFront())},t}(),le=function(){function t(t,e,i){this.source=t,this.path=e,this.snap=i,this.type=Vt.OVERWRITE}return t.prototype.operationForChild=function(e){return this.path.isEmpty()?new t(this.source,B.Empty,this.snap.getImmediateChild(e)):new t(this.source,this.path.popFront(),this.snap)},t}(),ue=function(){function t(t,e,i){this.source=t,this.path=e,this.children=i,this.type=Vt.MERGE}return t.prototype.operationForChild=function(e){if(this.path.isEmpty()){var i=this.children.subtree(new B(e));return i.isEmpty()?null:i.value?new le(this.source,B.Empty,i.value):new t(this.source,B.Empty,i)}return h.assert(this.path.getFront()===e,"Can't get a merge for a child not on the path of the operation"),new t(this.source,this.path.popFront(),this.children)},t.prototype.toString=function(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"},t}(),ce=function(){function t(t,e,i){this.node_=t,this.fullyInitialized_=e,this.filtered_=i}return t.prototype.isFullyInitialized=function(){return this.fullyInitialized_},t.prototype.isFiltered=function(){return this.filtered_},t.prototype.isCompleteForPath=function(t){if(t.isEmpty())return this.isFullyInitialized()&&!this.filtered_;var e=t.getFront();return this.isCompleteForChild(e)},t.prototype.isCompleteForChild=function(t){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(t)},t.prototype.getNode=function(){return this.node_},t}(),de=function(){function t(t,e){this.eventCache_=t,this.serverCache_=e}return t.prototype.updateEventSnap=function(e,i,n){return new t(new ce(e,i,n),this.serverCache_)},t.prototype.updateServerSnap=function(e,i,n){return new t(this.eventCache_,new ce(e,i,n))},t.prototype.getEventCache=function(){return this.eventCache_},t.prototype.getCompleteEventSnap=function(){return this.eventCache_.isFullyInitialized()?this.eventCache_.getNode():null},t.prototype.getServerCache=function(){return this.serverCache_},t.prototype.getCompleteServerSnap=function(){return this.serverCache_.isFullyInitialized()?this.serverCache_.getNode():null},t.Empty=new t(new ce(Yt.EMPTY_NODE,!1,!1),new ce(Yt.EMPTY_NODE,!1,!1)),t}(),pe=function(){function t(t,e,i,n,r){this.type=t,this.snapshotNode=e,this.childName=i,this.oldSnap=n,this.prevName=r}return t.valueChange=function(e){return new t(t.VALUE,e)},t.childAddedChange=function(e,i){return new t(t.CHILD_ADDED,i,e)},t.childRemovedChange=function(e,i){return new t(t.CHILD_REMOVED,i,e)},t.childChangedChange=function(e,i,n){return new t(t.CHILD_CHANGED,i,e,n)},t.childMovedChange=function(e,i){return new t(t.CHILD_MOVED,i,e)},t.CHILD_ADDED="child_added",t.CHILD_REMOVED="child_removed",t.CHILD_CHANGED="child_changed",t.CHILD_MOVED="child_moved",t.VALUE="value",t}(),fe=function(){function t(t){this.index_=t}return t.prototype.updateChild=function(t,e,i,n,r,o){h.assert(t.isIndexed(this.index_),"A node must be indexed if only a child is updated");var s=t.getImmediateChild(e);return s.getChild(n).equals(i.getChild(n))&&s.isEmpty()===i.isEmpty()?t:(null!=o&&(i.isEmpty()?t.hasChild(e)?o.trackChildChange(pe.childRemovedChange(e,s)):h.assert(t.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):s.isEmpty()?o.trackChildChange(pe.childAddedChange(e,i)):o.trackChildChange(pe.childChangedChange(e,i,s))),t.isLeafNode()&&i.isEmpty()?t:t.updateImmediateChild(e,i).withIndex(this.index_))},t.prototype.updateFullNode=function(t,e,i){return null!=i&&(t.isLeafNode()||t.forEachChild(It,(function(t,n){e.hasChild(t)||i.trackChildChange(pe.childRemovedChange(t,n))})),e.isLeafNode()||e.forEachChild(It,(function(e,n){if(t.hasChild(e)){var r=t.getImmediateChild(e);r.equals(n)||i.trackChildChange(pe.childChangedChange(e,n,r))}else i.trackChildChange(pe.childAddedChange(e,n))}))),e.withIndex(this.index_)},t.prototype.updatePriority=function(t,e){return t.isEmpty()?Yt.EMPTY_NODE:t.updatePriority(e)},t.prototype.filtersNodes=function(){return!1},t.prototype.getIndexedFilter=function(){return this},t.prototype.getIndex=function(){return this.index_},t}(),ye=function(){function t(){this.changeMap=new Map}return t.prototype.trackChildChange=function(t){var e=t.type,i=t.childName;h.assert(e===pe.CHILD_ADDED||e===pe.CHILD_CHANGED||e===pe.CHILD_REMOVED,"Only child changes supported for tracking"),h.assert(".priority"!==i,"Only non-priority child changes can be tracked.");var n=this.changeMap.get(i);if(n){var r=n.type;if(e===pe.CHILD_ADDED&&r===pe.CHILD_REMOVED)this.changeMap.set(i,pe.childChangedChange(i,t.snapshotNode,n.snapshotNode));else if(e===pe.CHILD_REMOVED&&r===pe.CHILD_ADDED)this.changeMap.delete(i);else if(e===pe.CHILD_REMOVED&&r===pe.CHILD_CHANGED)this.changeMap.set(i,pe.childRemovedChange(i,n.oldSnap));else if(e===pe.CHILD_CHANGED&&r===pe.CHILD_ADDED)this.changeMap.set(i,pe.childAddedChange(i,t.snapshotNode));else{if(e!==pe.CHILD_CHANGED||r!==pe.CHILD_CHANGED)throw h.assertionError("Illegal combination of changes: "+t+" occurred after "+n);this.changeMap.set(i,pe.childChangedChange(i,t.snapshotNode,n.oldSnap))}}else this.changeMap.set(i,t)},t.prototype.getChanges=function(){return Array.from(this.changeMap.values())},t}(),me=new(function(){function t(){}return t.prototype.getCompleteChild=function(t){return null},t.prototype.getChildAfterChild=function(t,e,i){return null},t}()),ve=function(){function t(t,e,i){void 0===i&&(i=null),this.writes_=t,this.viewCache_=e,this.optCompleteServerCache_=i}return t.prototype.getCompleteChild=function(t){var e=this.viewCache_.getEventCache();if(e.isCompleteForChild(t))return e.getNode().getImmediateChild(t);var i=null!=this.optCompleteServerCache_?new ce(this.optCompleteServerCache_,!0,!1):this.viewCache_.getServerCache();return this.writes_.calcCompleteChild(t,i)},t.prototype.getChildAfterChild=function(t,e,i){var n=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:this.viewCache_.getCompleteServerSnap(),r=this.writes_.calcIndexedSlice(n,e,1,i,t);return 0===r.length?null:r[0]},t}(),ge=function(t,e){this.viewCache=t,this.changes=e},_e=function(){function t(t){this.filter_=t}return t.prototype.assertIndexed=function(t){h.assert(t.getEventCache().getNode().isIndexed(this.filter_.getIndex()),"Event snap not indexed"),h.assert(t.getServerCache().getNode().isIndexed(this.filter_.getIndex()),"Server snap not indexed")},t.prototype.applyOperation=function(e,i,n,r){var o,s,a=new ye;if(i.type===Vt.OVERWRITE){var l=i;l.source.fromUser?o=this.applyUserOverwrite_(e,l.path,l.snap,n,r,a):(h.assert(l.source.fromServer,"Unknown source."),s=l.source.tagged||e.getServerCache().isFiltered()&&!l.path.isEmpty(),o=this.applyServerOverwrite_(e,l.path,l.snap,n,r,s,a))}else if(i.type===Vt.MERGE){var u=i;u.source.fromUser?o=this.applyUserMerge_(e,u.path,u.children,n,r,a):(h.assert(u.source.fromServer,"Unknown source."),s=u.source.tagged||e.getServerCache().isFiltered(),o=this.applyServerMerge_(e,u.path,u.children,n,r,s,a))}else if(i.type===Vt.ACK_USER_WRITE){var c=i;o=c.revert?this.revertUserWrite_(e,c.path,n,r,a):this.ackUserWrite_(e,c.path,c.affectedTree,n,r,a)}else{if(i.type!==Vt.LISTEN_COMPLETE)throw h.assertionError("Unknown operation type: "+i.type);o=this.listenComplete_(e,i.path,n,a)}var d=a.getChanges();return t.maybeAddValueEvent_(e,o,d),new ge(o,d)},t.maybeAddValueEvent_=function(t,e,i){var n=e.getEventCache();if(n.isFullyInitialized()){var r=n.getNode().isLeafNode()||n.getNode().isEmpty(),o=t.getCompleteEventSnap();(i.length>0||!t.getEventCache().isFullyInitialized()||r&&!n.getNode().equals(o)||!n.getNode().getPriority().equals(o.getPriority()))&&i.push(pe.valueChange(e.getCompleteEventSnap()))}},t.prototype.generateEventCacheAfterServerEvent_=function(t,e,i,n,r){var o=t.getEventCache();if(null!=i.shadowingWrite(e))return t;var s=void 0,a=void 0;if(e.isEmpty())if(h.assert(t.getServerCache().isFullyInitialized(),"If change path is empty, we must have complete server data"),t.getServerCache().isFiltered()){var l=t.getCompleteServerSnap(),u=l instanceof Yt?l:Yt.EMPTY_NODE,c=i.calcCompleteEventChildren(u);s=this.filter_.updateFullNode(t.getEventCache().getNode(),c,r)}else{var d=i.calcCompleteEventCache(t.getCompleteServerSnap());s=this.filter_.updateFullNode(t.getEventCache().getNode(),d,r)}else{var p=e.getFront();if(".priority"===p){h.assert(1===e.getLength(),"Can't have a priority with additional path components");var f=o.getNode();a=t.getServerCache().getNode();var y=i.calcEventCacheAfterServerOverwrite(e,f,a);s=null!=y?this.filter_.updatePriority(f,y):o.getNode()}else{var m=e.popFront(),v=void 0;if(o.isCompleteForChild(p)){a=t.getServerCache().getNode();var g=i.calcEventCacheAfterServerOverwrite(e,o.getNode(),a);v=null!=g?o.getNode().getImmediateChild(p).updateChild(m,g):o.getNode().getImmediateChild(p)}else v=i.calcCompleteChild(p,t.getServerCache());s=null!=v?this.filter_.updateChild(o.getNode(),p,v,m,n,r):o.getNode()}}return t.updateEventSnap(s,o.isFullyInitialized()||e.isEmpty(),this.filter_.filtersNodes())},t.prototype.applyServerOverwrite_=function(t,e,i,n,r,o,s){var a,h=t.getServerCache(),l=o?this.filter_:this.filter_.getIndexedFilter();if(e.isEmpty())a=l.updateFullNode(h.getNode(),i,null);else if(l.filtersNodes()&&!h.isFiltered()){var u=h.getNode().updateChild(e,i);a=l.updateFullNode(h.getNode(),u,null)}else{var c=e.getFront();if(!h.isCompleteForPath(e)&&e.getLength()>1)return t;var d=e.popFront(),p=h.getNode().getImmediateChild(c).updateChild(d,i);a=".priority"===c?l.updatePriority(h.getNode(),p):l.updateChild(h.getNode(),c,p,d,me,null)}var f=t.updateServerSnap(a,h.isFullyInitialized()||e.isEmpty(),l.filtersNodes()),y=new ve(n,f,r);return this.generateEventCacheAfterServerEvent_(f,e,n,y,s)},t.prototype.applyUserOverwrite_=function(t,e,i,n,r,o){var s,a,h=t.getEventCache(),l=new ve(n,t,r);if(e.isEmpty())a=this.filter_.updateFullNode(t.getEventCache().getNode(),i,o),s=t.updateEventSnap(a,!0,this.filter_.filtersNodes());else{var u=e.getFront();if(".priority"===u)a=this.filter_.updatePriority(t.getEventCache().getNode(),i),s=t.updateEventSnap(a,h.isFullyInitialized(),h.isFiltered());else{var c=e.popFront(),d=h.getNode().getImmediateChild(u),p=void 0;if(c.isEmpty())p=i;else{var f=l.getCompleteChild(u);p=null!=f?".priority"===c.getBack()&&f.getChild(c.parent()).isEmpty()?f:f.updateChild(c,i):Yt.EMPTY_NODE}if(d.equals(p))s=t;else{var y=this.filter_.updateChild(h.getNode(),u,p,c,l,o);s=t.updateEventSnap(y,h.isFullyInitialized(),this.filter_.filtersNodes())}}}return s},t.cacheHasChild_=function(t,e){return t.getEventCache().isCompleteForChild(e)},t.prototype.applyUserMerge_=function(e,i,n,r,o,s){var a=this,h=e;return n.foreach((function(n,l){var u=i.child(n);t.cacheHasChild_(e,u.getFront())&&(h=a.applyUserOverwrite_(h,u,l,r,o,s))})),n.foreach((function(n,l){var u=i.child(n);t.cacheHasChild_(e,u.getFront())||(h=a.applyUserOverwrite_(h,u,l,r,o,s))})),h},t.prototype.applyMerge_=function(t,e){return e.foreach((function(e,i){t=t.updateChild(e,i)})),t},t.prototype.applyServerMerge_=function(t,e,i,n,r,o,s){var a=this;if(t.getServerCache().getNode().isEmpty()&&!t.getServerCache().isFullyInitialized())return t;var h,l=t;h=e.isEmpty()?i:ae.Empty.setTree(e,i);var u=t.getServerCache().getNode();return h.children.inorderTraversal((function(e,i){if(u.hasChild(e)){var h=t.getServerCache().getNode().getImmediateChild(e),c=a.applyMerge_(h,i);l=a.applyServerOverwrite_(l,new B(e),c,n,r,o,s)}})),h.children.inorderTraversal((function(e,i){var h=!t.getServerCache().isCompleteForChild(e)&&null==i.value;if(!u.hasChild(e)&&!h){var c=t.getServerCache().getNode().getImmediateChild(e),d=a.applyMerge_(c,i);l=a.applyServerOverwrite_(l,new B(e),d,n,r,o,s)}})),l},t.prototype.ackUserWrite_=function(t,e,i,n,r,o){if(null!=n.shadowingWrite(e))return t;var s=t.getServerCache().isFiltered(),a=t.getServerCache();if(null!=i.value){if(e.isEmpty()&&a.isFullyInitialized()||a.isCompleteForPath(e))return this.applyServerOverwrite_(t,e,a.getNode().getChild(e),n,r,s,o);if(e.isEmpty()){var h=ae.Empty;return a.getNode().forEachChild(wt,(function(t,e){h=h.set(new B(t),e)})),this.applyServerMerge_(t,e,h,n,r,s,o)}return t}var l=ae.Empty;return i.foreach((function(t,i){var n=e.child(t);a.isCompleteForPath(n)&&(l=l.set(t,a.getNode().getChild(n)))})),this.applyServerMerge_(t,e,l,n,r,s,o)},t.prototype.listenComplete_=function(t,e,i,n){var r=t.getServerCache(),o=t.updateServerSnap(r.getNode(),r.isFullyInitialized()||e.isEmpty(),r.isFiltered());return this.generateEventCacheAfterServerEvent_(o,e,i,me,n)},t.prototype.revertUserWrite_=function(t,e,i,n,r){var o;if(null!=i.shadowingWrite(e))return t;var s=new ve(i,t,n),a=t.getEventCache().getNode(),l=void 0;if(e.isEmpty()||".priority"===e.getFront()){var u=void 0;if(t.getServerCache().isFullyInitialized())u=i.calcCompleteEventCache(t.getCompleteServerSnap());else{var c=t.getServerCache().getNode();h.assert(c instanceof Yt,"serverChildren would be complete if leaf node"),u=i.calcCompleteEventChildren(c)}u=u,l=this.filter_.updateFullNode(a,u,r)}else{var d=e.getFront(),p=i.calcCompleteChild(d,t.getServerCache());null==p&&t.getServerCache().isCompleteForChild(d)&&(p=a.getImmediateChild(d)),(l=null!=p?this.filter_.updateChild(a,d,p,e.popFront(),s,r):t.getEventCache().getNode().hasChild(d)?this.filter_.updateChild(a,d,Yt.EMPTY_NODE,e.popFront(),s,r):a).isEmpty()&&t.getServerCache().isFullyInitialized()&&(o=i.calcCompleteEventCache(t.getCompleteServerSnap())).isLeafNode()&&(l=this.filter_.updateFullNode(l,o,r))}return o=t.getServerCache().isFullyInitialized()||null!=i.shadowingWrite(B.Empty),t.updateEventSnap(l,o,this.filter_.filtersNodes())},t}(),we=function(){function t(t){this.query_=t,this.index_=this.query_.getQueryParams().getIndex()}return t.prototype.generateEventsForChanges=function(t,e,i){var n=this,r=[],o=[];return t.forEach((function(t){t.type===pe.CHILD_CHANGED&&n.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&o.push(pe.childMovedChange(t.childName,t.snapshotNode))})),this.generateEventsForType_(r,pe.CHILD_REMOVED,t,i,e),this.generateEventsForType_(r,pe.CHILD_ADDED,t,i,e),this.generateEventsForType_(r,pe.CHILD_MOVED,o,i,e),this.generateEventsForType_(r,pe.CHILD_CHANGED,t,i,e),this.generateEventsForType_(r,pe.VALUE,t,i,e),r},t.prototype.generateEventsForType_=function(t,e,i,n,r){var o=this,s=i.filter((function(t){return t.type===e}));s.sort(this.compareChanges_.bind(this)),s.forEach((function(e){var i=o.materializeSingleChange_(e,r);n.forEach((function(n){n.respondsTo(e.type)&&t.push(n.createEvent(i,o.query_))}))}))},t.prototype.materializeSingleChange_=function(t,e){return"value"===t.type||"child_removed"===t.type?t:(t.prevName=e.getPredecessorChildName(t.childName,t.snapshotNode,this.index_),t)},t.prototype.compareChanges_=function(t,e){if(null==t.childName||null==e.childName)throw h.assertionError("Should only compare child_ events.");var i=new vt(t.childName,t.snapshotNode),n=new vt(e.childName,e.snapshotNode);return this.index_.compare(i,n)},t}(),be=function(){function t(t,e){this.query_=t,this.eventRegistrations_=[];var i=this.query_.getQueryParams(),n=new fe(i.getIndex()),r=i.getNodeFilter();this.processor_=new _e(r);var o=e.getServerCache(),s=e.getEventCache(),a=n.updateFullNode(Yt.EMPTY_NODE,o.getNode(),null),h=r.updateFullNode(Yt.EMPTY_NODE,s.getNode(),null),l=new ce(a,o.isFullyInitialized(),n.filtersNodes()),u=new ce(h,s.isFullyInitialized(),r.filtersNodes());this.viewCache_=new de(u,l),this.eventGenerator_=new we(this.query_)}return t.prototype.getQuery=function(){return this.query_},t.prototype.getServerCache=function(){return this.viewCache_.getServerCache().getNode()},t.prototype.getCompleteServerCache=function(t){var e=this.viewCache_.getCompleteServerSnap();return e&&(this.query_.getQueryParams().loadsAllData()||!t.isEmpty()&&!e.getImmediateChild(t.getFront()).isEmpty())?e.getChild(t):null},t.prototype.isEmpty=function(){return 0===this.eventRegistrations_.length},t.prototype.addEventRegistration=function(t){this.eventRegistrations_.push(t)},t.prototype.removeEventRegistration=function(t,e){var i=[];if(e){h.assert(null==t,"A cancel should cancel all event registrations.");var n=this.query_.path;this.eventRegistrations_.forEach((function(t){e=e;var r=t.createCancelEvent(e,n);r&&i.push(r)}))}if(t){for(var r=[],o=0;o<this.eventRegistrations_.length;++o){var s=this.eventRegistrations_[o];if(s.matches(t)){if(t.hasAnyCallback()){r=r.concat(this.eventRegistrations_.slice(o+1));break}}else r.push(s)}this.eventRegistrations_=r}else this.eventRegistrations_=[];return i},t.prototype.applyOperation=function(t,e,i){t.type===Vt.MERGE&&null!==t.source.queryId&&(h.assert(this.viewCache_.getCompleteServerSnap(),"We should always have a full cache before handling merges"),h.assert(this.viewCache_.getCompleteEventSnap(),"Missing event cache, even though we have a server cache"));var n=this.viewCache_,r=this.processor_.applyOperation(n,t,e,i);return this.processor_.assertIndexed(r.viewCache),h.assert(r.viewCache.getServerCache().isFullyInitialized()||!n.getServerCache().isFullyInitialized(),"Once a server snap is complete, it should never go back"),this.viewCache_=r.viewCache,this.generateEventsForChanges_(r.changes,r.viewCache.getEventCache().getNode(),null)},t.prototype.getInitialEvents=function(t){var e=this.viewCache_.getEventCache(),i=[];e.getNode().isLeafNode()||e.getNode().forEachChild(It,(function(t,e){i.push(pe.childAddedChange(t,e))}));return e.isFullyInitialized()&&i.push(pe.valueChange(e.getNode())),this.generateEventsForChanges_(i,e.getNode(),t)},t.prototype.generateEventsForChanges_=function(t,e,i){var n=i?[i]:this.eventRegistrations_;return this.eventGenerator_.generateEventsForChanges(t,e,n)},t}(),Se=function(){function t(){this.views=new Map}return Object.defineProperty(t,"__referenceConstructor",{get:function(){return h.assert(re,"Reference.ts has not been loaded"),re},set:function(t){h.assert(!re,"__referenceConstructor has already been defined"),re=t},enumerable:!0,configurable:!0}),t.prototype.isEmpty=function(){return 0===this.views.size},t.prototype.applyOperation=function(t,e,i){var n,r,o=t.source.queryId;if(null!==o){var s=this.views.get(o);return h.assert(null!=s,"SyncTree gave us an op for an invalid query."),s.applyOperation(t,e,i)}var l=[];try{for(var u=a.__values(this.views.values()),c=u.next();!c.done;c=u.next()){s=c.value;l=l.concat(s.applyOperation(t,e,i))}}catch(t){n={error:t}}finally{try{c&&!c.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}return l},t.prototype.addEventRegistration=function(t,e,i,n,r){var o=t.queryIdentifier(),s=this.views.get(o);if(!s){var a=i.calcCompleteEventCache(r?n:null),h=!1;a?h=!0:n instanceof Yt?(a=i.calcCompleteEventChildren(n),h=!1):(a=Yt.EMPTY_NODE,h=!1);var l=new de(new ce(a,h,!1),new ce(n,r,!1));s=new be(t,l),this.views.set(o,s)}return s.addEventRegistration(e),s.getInitialEvents(e)},t.prototype.removeEventRegistration=function(e,i,n){var r,o,s=e.queryIdentifier(),h=[],l=[],u=this.hasCompleteView();if("default"===s)try{for(var c=a.__values(this.views.entries()),d=c.next();!d.done;d=c.next()){var p=a.__read(d.value,2),f=p[0],y=p[1];l=l.concat(y.removeEventRegistration(i,n)),y.isEmpty()&&(this.views.delete(f),y.getQuery().getQueryParams().loadsAllData()||h.push(y.getQuery()))}}catch(t){r={error:t}}finally{try{d&&!d.done&&(o=c.return)&&o.call(c)}finally{if(r)throw r.error}}else(y=this.views.get(s))&&(l=l.concat(y.removeEventRegistration(i,n)),y.isEmpty()&&(this.views.delete(s),y.getQuery().getQueryParams().loadsAllData()||h.push(y.getQuery())));return u&&!this.hasCompleteView()&&h.push(new t.__referenceConstructor(e.repo,e.path)),{removed:h,events:l}},t.prototype.getQueryViews=function(){var t,e,i=[];try{for(var n=a.__values(this.views.values()),r=n.next();!r.done;r=n.next()){var o=r.value;o.getQuery().getQueryParams().loadsAllData()||i.push(o)}}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}return i},t.prototype.getCompleteServerCache=function(t){var e,i,n=null;try{for(var r=a.__values(this.views.values()),o=r.next();!o.done;o=r.next()){var s=o.value;n=n||s.getCompleteServerCache(t)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(i=r.return)&&i.call(r)}finally{if(e)throw e.error}}return n},t.prototype.viewForQuery=function(t){if(t.getQueryParams().loadsAllData())return this.getCompleteView();var e=t.queryIdentifier();return this.views.get(e)},t.prototype.viewExistsForQuery=function(t){return null!=this.viewForQuery(t)},t.prototype.hasCompleteView=function(){return null!=this.getCompleteView()},t.prototype.getCompleteView=function(){var t,e;try{for(var i=a.__values(this.views.values()),n=i.next();!n.done;n=i.next()){var r=n.value;if(r.getQuery().getQueryParams().loadsAllData())return r}}catch(e){t={error:e}}finally{try{n&&!n.done&&(e=i.return)&&e.call(i)}finally{if(t)throw t.error}}return null},t}(),Ce=function(){function t(t){this.writeTree_=t}return t.prototype.addWrite=function(e,i){if(e.isEmpty())return new t(new ae(i));var n=this.writeTree_.findRootMostValueAndPath(e);if(null!=n){var r=n.path,o=n.value,s=B.relativePath(r,e);return o=o.updateChild(s,i),new t(this.writeTree_.set(r,o))}var a=new ae(i);return new t(this.writeTree_.setTree(e,a))},t.prototype.addWrites=function(t,e){var i=this;return L(e,(function(e,n){i=i.addWrite(t.child(e),n)})),i},t.prototype.removeWrite=function(e){return e.isEmpty()?t.Empty:new t(this.writeTree_.setTree(e,ae.Empty))},t.prototype.hasCompleteWrite=function(t){return null!=this.getCompleteNode(t)},t.prototype.getCompleteNode=function(t){var e=this.writeTree_.findRootMostValueAndPath(t);return null!=e?this.writeTree_.get(e.path).getChild(B.relativePath(e.path,t)):null},t.prototype.getCompleteChildren=function(){var t=[],e=this.writeTree_.value;return null!=e?e.isLeafNode()||e.forEachChild(It,(function(e,i){t.push(new vt(e,i))})):this.writeTree_.children.inorderTraversal((function(e,i){null!=i.value&&t.push(new vt(e,i.value))})),t},t.prototype.childCompoundWrite=function(e){if(e.isEmpty())return this;var i=this.getCompleteNode(e);return new t(null!=i?new ae(i):this.writeTree_.subtree(e))},t.prototype.isEmpty=function(){return this.writeTree_.isEmpty()},t.prototype.apply=function(t){return function t(e,i,n){if(null!=i.value)return n.updateChild(e,i.value);var r=null;return i.children.inorderTraversal((function(i,o){".priority"===i?(h.assert(null!==o.value,"Priority writes must always be leaf nodes"),r=o.value):n=t(e.child(i),o,n)})),n.getChild(e).isEmpty()||null===r||(n=n.updateChild(e.child(".priority"),r)),n}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(B.Empty,this.writeTree_,t)},t.Empty=new t(new ae(null)),t}();
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ee=function(){function t(){this.visibleWrites_=Ce.Empty,this.allWrites_=[],this.lastWriteId_=-1}return t.prototype.childWrites=function(t){return new Te(t,this)},t.prototype.addOverwrite=function(t,e,i,n){h.assert(i>this.lastWriteId_,"Stacking an older write on top of newer ones"),void 0===n&&(n=!0),this.allWrites_.push({path:t,snap:e,writeId:i,visible:n}),n&&(this.visibleWrites_=this.visibleWrites_.addWrite(t,e)),this.lastWriteId_=i},t.prototype.addMerge=function(t,e,i){h.assert(i>this.lastWriteId_,"Stacking an older merge on top of newer ones"),this.allWrites_.push({path:t,children:e,writeId:i,visible:!0}),this.visibleWrites_=this.visibleWrites_.addWrites(t,e),this.lastWriteId_=i},t.prototype.getWrite=function(t){for(var e=0;e<this.allWrites_.length;e++){var i=this.allWrites_[e];if(i.writeId===t)return i}return null},t.prototype.removeWrite=function(t){var e=this,i=this.allWrites_.findIndex((function(e){return e.writeId===t}));h.assert(i>=0,"removeWrite called with nonexistent writeId.");var n=this.allWrites_[i];this.allWrites_.splice(i,1);for(var r=n.visible,o=!1,s=this.allWrites_.length-1;r&&s>=0;){var a=this.allWrites_[s];a.visible&&(s>=i&&this.recordContainsPath_(a,n.path)?r=!1:n.path.contains(a.path)&&(o=!0)),s--}if(r){if(o)return this.resetTree_(),!0;n.snap?this.visibleWrites_=this.visibleWrites_.removeWrite(n.path):L(n.children,(function(t){e.visibleWrites_=e.visibleWrites_.removeWrite(n.path.child(t))}));return!0}return!1},t.prototype.getCompleteWriteData=function(t){return this.visibleWrites_.getCompleteNode(t)},t.prototype.calcCompleteEventCache=function(e,i,n,r){if(n||r){var o=this.visibleWrites_.childCompoundWrite(e);if(!r&&o.isEmpty())return i;if(r||null!=i||o.hasCompleteWrite(B.Empty)){var s=t.layerTree_(this.allWrites_,(function(t){return(t.visible||r)&&(!n||!~n.indexOf(t.writeId))&&(t.path.contains(e)||e.contains(t.path))}),e);l=i||Yt.EMPTY_NODE;return s.apply(l)}return null}var a=this.visibleWrites_.getCompleteNode(e);if(null!=a)return a;var h=this.visibleWrites_.childCompoundWrite(e);if(h.isEmpty())return i;if(null!=i||h.hasCompleteWrite(B.Empty)){var l=i||Yt.EMPTY_NODE;return h.apply(l)}return null},t.prototype.calcCompleteEventChildren=function(t,e){var i=Yt.EMPTY_NODE,n=this.visibleWrites_.getCompleteNode(t);if(n)return n.isLeafNode()||n.forEachChild(It,(function(t,e){i=i.updateImmediateChild(t,e)})),i;if(e){var r=this.visibleWrites_.childCompoundWrite(t);return e.forEachChild(It,(function(t,e){var n=r.childCompoundWrite(new B(t)).apply(e);i=i.updateImmediateChild(t,n)})),r.getCompleteChildren().forEach((function(t){i=i.updateImmediateChild(t.name,t.node)})),i}return this.visibleWrites_.childCompoundWrite(t).getCompleteChildren().forEach((function(t){i=i.updateImmediateChild(t.name,t.node)})),i},t.prototype.calcEventCacheAfterServerOverwrite=function(t,e,i,n){h.assert(i||n,"Either existingEventSnap or existingServerSnap must exist");var r=t.child(e);if(this.visibleWrites_.hasCompleteWrite(r))return null;var o=this.visibleWrites_.childCompoundWrite(r);return o.isEmpty()?n.getChild(e):o.apply(n.getChild(e))},t.prototype.calcCompleteChild=function(t,e,i){var n=t.child(e),r=this.visibleWrites_.getCompleteNode(n);return null!=r?r:i.isCompleteForChild(e)?this.visibleWrites_.childCompoundWrite(n).apply(i.getNode().getImmediateChild(e)):null},t.prototype.shadowingWrite=function(t){return this.visibleWrites_.getCompleteNode(t)},t.prototype.calcIndexedSlice=function(t,e,i,n,r,o){var s,a=this.visibleWrites_.childCompoundWrite(t),h=a.getCompleteNode(B.Empty);if(null!=h)s=h;else{if(null==e)return[];s=a.apply(e)}if((s=s.withIndex(o)).isEmpty()||s.isLeafNode())return[];for(var l=[],u=o.getCompare(),c=r?s.getReverseIteratorFrom(i,o):s.getIteratorFrom(i,o),d=c.getNext();d&&l.length<n;)0!==u(d,i)&&l.push(d),d=c.getNext();return l},t.prototype.recordContainsPath_=function(t,e){if(t.snap)return t.path.contains(e);for(var i in t.children)if(t.children.hasOwnProperty(i)&&t.path.child(i).contains(e))return!0;return!1},t.prototype.resetTree_=function(){this.visibleWrites_=t.layerTree_(this.allWrites_,t.DefaultFilter_,B.Empty),this.allWrites_.length>0?this.lastWriteId_=this.allWrites_[this.allWrites_.length-1].writeId:this.lastWriteId_=-1},t.DefaultFilter_=function(t){return t.visible},t.layerTree_=function(t,e,i){for(var n=Ce.Empty,r=0;r<t.length;++r){var o=t[r];if(e(o)){var s=o.path,a=void 0;if(o.snap)i.contains(s)?(a=B.relativePath(i,s),n=n.addWrite(a,o.snap)):s.contains(i)&&(a=B.relativePath(s,i),n=n.addWrite(B.Empty,o.snap.getChild(a)));else{if(!o.children)throw h.assertionError("WriteRecord should have .snap or .children");if(i.contains(s))a=B.relativePath(i,s),n=n.addWrites(a,o.children);else if(s.contains(i))if((a=B.relativePath(s,i)).isEmpty())n=n.addWrites(B.Empty,o.children);else{var l=h.safeGet(o.children,a.getFront());if(l){var u=l.getChild(a.popFront());n=n.addWrite(B.Empty,u)}}}}}return n},t}(),Te=function(){function t(t,e){this.treePath_=t,this.writeTree_=e}return t.prototype.calcCompleteEventCache=function(t,e,i){return this.writeTree_.calcCompleteEventCache(this.treePath_,t,e,i)},t.prototype.calcCompleteEventChildren=function(t){return this.writeTree_.calcCompleteEventChildren(this.treePath_,t)},t.prototype.calcEventCacheAfterServerOverwrite=function(t,e,i){return this.writeTree_.calcEventCacheAfterServerOverwrite(this.treePath_,t,e,i)},t.prototype.shadowingWrite=function(t){return this.writeTree_.shadowingWrite(this.treePath_.child(t))},t.prototype.calcIndexedSlice=function(t,e,i,n,r){return this.writeTree_.calcIndexedSlice(this.treePath_,t,e,i,n,r)},t.prototype.calcCompleteChild=function(t,e){return this.writeTree_.calcCompleteChild(this.treePath_,t,e)},t.prototype.child=function(e){return new t(this.treePath_.child(e),this.writeTree_)},t}(),Pe=function(){function t(t){this.listenProvider_=t,this.syncPointTree_=ae.Empty,this.pendingWriteTree_=new Ee,this.tagToQueryMap=new Map,this.queryToTagMap=new Map}return t.prototype.applyUserOverwrite=function(t,e,i,n){return this.pendingWriteTree_.addOverwrite(t,e,i,n),n?this.applyOperationToSyncPoints_(new le(oe.User,t,e)):[]},t.prototype.applyUserMerge=function(t,e,i){this.pendingWriteTree_.addMerge(t,e,i);var n=ae.fromObject(e);return this.applyOperationToSyncPoints_(new ue(oe.User,t,n))},t.prototype.ackUserWrite=function(t,e){void 0===e&&(e=!1);var i=this.pendingWriteTree_.getWrite(t);if(this.pendingWriteTree_.removeWrite(t)){var n=ae.Empty;return null!=i.snap?n=n.set(B.Empty,!0):L(i.children,(function(t,e){n=n.set(new B(t),e)})),this.applyOperationToSyncPoints_(new se(i.path,n,e))}return[]},t.prototype.applyServerOverwrite=function(t,e){return this.applyOperationToSyncPoints_(new le(oe.Server,t,e))},t.prototype.applyServerMerge=function(t,e){var i=ae.fromObject(e);return this.applyOperationToSyncPoints_(new ue(oe.Server,t,i))},t.prototype.applyListenComplete=function(t){return this.applyOperationToSyncPoints_(new he(oe.Server,t))},t.prototype.applyTaggedQueryOverwrite=function(e,i,n){var r=this.queryKeyForTag_(n);if(null!=r){var o=t.parseQueryKey_(r),s=o.path,a=o.queryId,h=B.relativePath(s,e),l=new le(oe.forServerTaggedQuery(a),h,i);return this.applyTaggedOperation_(s,l)}return[]},t.prototype.applyTaggedQueryMerge=function(e,i,n){var r=this.queryKeyForTag_(n);if(r){var o=t.parseQueryKey_(r),s=o.path,a=o.queryId,h=B.relativePath(s,e),l=ae.fromObject(i),u=new ue(oe.forServerTaggedQuery(a),h,l);return this.applyTaggedOperation_(s,u)}return[]},t.prototype.applyTaggedListenComplete=function(e,i){var n=this.queryKeyForTag_(i);if(n){var r=t.parseQueryKey_(n),o=r.path,s=r.queryId,a=B.relativePath(o,e),h=new he(oe.forServerTaggedQuery(s),a);return this.applyTaggedOperation_(o,h)}return[]},t.prototype.addEventRegistration=function(e,i){var n=e.path,r=null,o=!1;this.syncPointTree_.foreachOnPath(n,(function(t,e){var i=B.relativePath(t,n);r=r||e.getCompleteServerCache(i),o=o||e.hasCompleteView()}));var s,a=this.syncPointTree_.get(n);(a?(o=o||a.hasCompleteView(),r=r||a.getCompleteServerCache(B.Empty)):(a=new Se,this.syncPointTree_=this.syncPointTree_.set(n,a)),null!=r)?s=!0:(s=!1,r=Yt.EMPTY_NODE,this.syncPointTree_.subtree(n).foreachChild((function(t,e){var i=e.getCompleteServerCache(B.Empty);i&&(r=r.updateImmediateChild(t,i))})));var l=a.viewExistsForQuery(e);if(!l&&!e.getQueryParams().loadsAllData()){var u=t.makeQueryKey_(e);h.assert(!this.queryToTagMap.has(u),"View does not exist, but we have a tag");var c=t.getNextQueryTag_();this.queryToTagMap.set(u,c),this.tagToQueryMap.set(c,u)}var d=this.pendingWriteTree_.childWrites(n),p=a.addEventRegistration(e,i,d,r,s);if(!l&&!o){var f=a.viewForQuery(e);p=p.concat(this.setupListener_(e,f))}return p},t.prototype.removeEventRegistration=function(e,i,n){var r=this,o=e.path,s=this.syncPointTree_.get(o),a=[];if(s&&("default"===e.queryIdentifier()||s.viewExistsForQuery(e))){var h=s.removeEventRegistration(e,i,n);s.isEmpty()&&(this.syncPointTree_=this.syncPointTree_.remove(o));var l=h.removed;a=h.events;var u=-1!==l.findIndex((function(t){return t.getQueryParams().loadsAllData()})),c=this.syncPointTree_.findOnPath(o,(function(t,e){return e.hasCompleteView()}));if(u&&!c){var d=this.syncPointTree_.subtree(o);if(!d.isEmpty())for(var p=this.collectDistinctViewsForSubTree_(d),f=0;f<p.length;++f){var y=p[f],m=y.getQuery(),v=this.createListenerForView_(y);this.listenProvider_.startListening(t.queryForListening_(m),this.tagForQuery_(m),v.hashFn,v.onComplete)}}if(!c&&l.length>0&&!n)if(u){this.listenProvider_.stopListening(t.queryForListening_(e),null)}else l.forEach((function(e){var i=r.queryToTagMap.get(t.makeQueryKey_(e));r.listenProvider_.stopListening(t.queryForListening_(e),i)}));this.removeTags_(l)}return a},t.prototype.calcCompleteEventCache=function(t,e){var i=this.pendingWriteTree_,n=this.syncPointTree_.findOnPath(t,(function(e,i){var n=B.relativePath(e,t),r=i.getCompleteServerCache(n);if(r)return r}));return i.calcCompleteEventCache(t,n,e,!0)},t.prototype.collectDistinctViewsForSubTree_=function(t){return t.fold((function(t,e,i){if(e&&e.hasCompleteView())return[e.getCompleteView()];var n=[];return e&&(n=e.getQueryViews()),L(i,(function(t,e){n=n.concat(e)})),n}))},t.prototype.removeTags_=function(e){for(var i=0;i<e.length;++i){var n=e[i];if(!n.getQueryParams().loadsAllData()){var r=t.makeQueryKey_(n),o=this.queryToTagMap.get(r);this.queryToTagMap.delete(r),this.tagToQueryMap.delete(o)}}},t.queryForListening_=function(t){return t.getQueryParams().loadsAllData()&&!t.getQueryParams().isDefault()?t.getRef():t},t.prototype.setupListener_=function(e,i){var n=e.path,r=this.tagForQuery_(e),o=this.createListenerForView_(i),s=this.listenProvider_.startListening(t.queryForListening_(e),r,o.hashFn,o.onComplete),a=this.syncPointTree_.subtree(n);if(r)h.assert(!a.value.hasCompleteView(),"If we're adding a query, it shouldn't be shadowed");else for(var l=a.fold((function(t,e,i){if(!t.isEmpty()&&e&&e.hasCompleteView())return[e.getCompleteView().getQuery()];var n=[];return e&&(n=n.concat(e.getQueryViews().map((function(t){return t.getQuery()})))),L(i,(function(t,e){n=n.concat(e)})),n})),u=0;u<l.length;++u){var c=l[u];this.listenProvider_.stopListening(t.queryForListening_(c),this.tagForQuery_(c))}return s},t.prototype.createListenerForView_=function(t){var e=this,i=t.getQuery(),n=this.tagForQuery_(i);return{hashFn:function(){return(t.getServerCache()||Yt.EMPTY_NODE).hash()},onComplete:function(t){if("ok"===t)return n?e.applyTaggedListenComplete(i.path,n):e.applyListenComplete(i.path);var r=function(t,e){var i="Unknown Error";"too_big"===t?i="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===t?i="Client doesn't have permission to access the desired data.":"unavailable"===t&&(i="The service is unavailable");var n=new Error(t+" at "+e.path.toString()+": "+i);return n.code=t.toUpperCase(),n}(t,i);return e.removeEventRegistration(i,null,r)}}},t.makeQueryKey_=function(t){return t.path.toString()+"$"+t.queryIdentifier()},t.parseQueryKey_=function(t){var e=t.indexOf("$");return h.assert(-1!==e&&e<t.length-1,"Bad queryKey."),{queryId:t.substr(e+1),path:new B(t.substr(0,e))}},t.prototype.queryKeyForTag_=function(t){return this.tagToQueryMap.get(t)},t.prototype.tagForQuery_=function(e){var i=t.makeQueryKey_(e);return this.queryToTagMap.get(i)},t.getNextQueryTag_=function(){return t.nextQueryTag_++},t.prototype.applyTaggedOperation_=function(t,e){var i=this.syncPointTree_.get(t);h.assert(i,"Missing sync point for query tag that we're tracking");var n=this.pendingWriteTree_.childWrites(t);return i.applyOperation(e,n,null)},t.prototype.applyOperationToSyncPoints_=function(t){return this.applyOperationHelper_(t,this.syncPointTree_,null,this.pendingWriteTree_.childWrites(B.Empty))},t.prototype.applyOperationHelper_=function(t,e,i,n){if(t.path.isEmpty())return this.applyOperationDescendantsHelper_(t,e,i,n);var r=e.get(B.Empty);null==i&&null!=r&&(i=r.getCompleteServerCache(B.Empty));var o=[],s=t.path.getFront(),a=t.operationForChild(s),h=e.children.get(s);if(h&&a){var l=i?i.getImmediateChild(s):null,u=n.child(s);o=o.concat(this.applyOperationHelper_(a,h,l,u))}return r&&(o=o.concat(r.applyOperation(t,n,i))),o},t.prototype.applyOperationDescendantsHelper_=function(t,e,i,n){var r=this,o=e.get(B.Empty);null==i&&null!=o&&(i=o.getCompleteServerCache(B.Empty));var s=[];return e.children.inorderTraversal((function(e,o){var a=i?i.getImmediateChild(e):null,h=n.child(e),l=t.operationForChild(e);l&&(s=s.concat(r.applyOperationDescendantsHelper_(l,o,a,h)))})),o&&(s=s.concat(o.applyOperation(t,n,i))),s},t.nextQueryTag_=1,t}(),ke=function(){function t(){this.rootNode_=Yt.EMPTY_NODE}return t.prototype.getNode=function(t){return this.rootNode_.getChild(t)},t.prototype.updateSnapshot=function(t,e){this.rootNode_=this.rootNode_.updateChild(t,e)},t}(),xe=function(){function t(t,e){var i=this;this.app_=t,this.authProvider_=e,this.auth_=null,this.auth_=e.getImmediate({optional:!0}),this.auth_||e.get().then((function(t){return i.auth_=t}))}return t.prototype.getToken=function(t){return this.auth_?this.auth_.getToken(t).catch((function(t){return t&&"auth/token-not-initialized"===t.code?(C("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)})):Promise.resolve(null)},t.prototype.addTokenChangeListener=function(t){this.auth_?this.auth_.addAuthTokenListener(t):(setTimeout((function(){return t(null)}),0),this.authProvider_.get().then((function(e){return e.addAuthTokenListener(t)})))},t.prototype.removeTokenChangeListener=function(t){this.authProvider_.get().then((function(e){return e.removeAuthTokenListener(t)}))},t.prototype.notifyForInvalidToken=function(){var t='Provided authentication credentials for the app named "'+this.app_.name+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.app_.options?t+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.app_.options?t+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':t+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',k(t)},t}(),Ie=function(){function t(){this.counters_={}}return t.prototype.incrementCounter=function(t,e){void 0===e&&(e=1),h.contains(this.counters_,t)||(this.counters_[t]=0),this.counters_[t]+=e},t.prototype.get=function(){return h.deepCopy(this.counters_)},t}(),Oe=function(){function t(){}return t.getCollection=function(t){var e=t.toString();return this.collections_[e]||(this.collections_[e]=new Ie),this.collections_[e]},t.getOrCreateReporter=function(t,e){var i=t.toString();return this.reporters_[i]||(this.reporters_[i]=e()),this.reporters_[i]},t.collections_={},t.reporters_={},t}(),Ne=function(){function t(t){this.collection_=t,this.last_=null}return t.prototype.get=function(){var t=this.collection_.get(),e=a.__assign({},t);return this.last_&&L(this.last_,(function(t,i){e[t]=e[t]-i})),this.last_=t,e},t}(),Re=function(){function t(t,e){this.server_=e,this.statsToReport_={},this.statsListener_=new Ne(t);var i=1e4+2e4*Math.random();Y(this.reportStats_.bind(this),Math.floor(i))}return t.prototype.includeStat=function(t){this.statsToReport_[t]=!0},t.prototype.reportStats_=function(){var t=this,e=this.statsListener_.get(),i={},n=!1;L(e,(function(e,r){r>0&&h.contains(t.statsToReport_,e)&&(i[e]=r,n=!0)})),n&&this.server_.reportStats(i),Y(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))},t}(),De=function(){function t(){this.eventLists_=[],this.recursionDepth_=0}return t.prototype.queueEvents=function(t){for(var e=null,i=0;i<t.length;i++){var n=t[i],r=n.getPath();null===e||r.equals(e.getPath())||(this.eventLists_.push(e),e=null),null===e&&(e=new Ae(r)),e.add(n)}e&&this.eventLists_.push(e)},t.prototype.raiseEventsAtPath=function(t,e){this.queueEvents(e),this.raiseQueuedEventsMatchingPredicate_((function(e){return e.equals(t)}))},t.prototype.raiseEventsForChangedPath=function(t,e){this.queueEvents(e),this.raiseQueuedEventsMatchingPredicate_((function(e){return e.contains(t)||t.contains(e)}))},t.prototype.raiseQueuedEventsMatchingPredicate_=function(t){this.recursionDepth_++;for(var e=!0,i=0;i<this.eventLists_.length;i++){var n=this.eventLists_[i];if(n)t(n.getPath())?(this.eventLists_[i].raise(),this.eventLists_[i]=null):e=!1}e&&(this.eventLists_=[]),this.recursionDepth_--},t}(),Ae=function(){function t(t){this.path_=t,this.events_=[]}return t.prototype.add=function(t){this.events_.push(t)},t.prototype.raise=function(){for(var t=0;t<this.events_.length;t++){var e=this.events_[t];if(null!==e){this.events_[t]=null;var i=e.getEventRunner();w&&C("event: "+e.toString()),H(i)}}},t.prototype.getPath=function(){return this.path_},t}(),Me=function(){function t(t){this.allowedEvents_=t,this.listeners_={},h.assert(Array.isArray(t)&&t.length>0,"Requires a non-empty array")}return t.prototype.trigger=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];if(Array.isArray(this.listeners_[t]))for(var n=a.__spread(this.listeners_[t]),r=0;r<n.length;r++)n[r].callback.apply(n[r].context,e)},t.prototype.on=function(t,e,i){this.validateEventType_(t),this.listeners_[t]=this.listeners_[t]||[],this.listeners_[t].push({callback:e,context:i});var n=this.getInitialEvent(t);n&&e.apply(i,n)},t.prototype.off=function(t,e,i){this.validateEventType_(t);for(var n=this.listeners_[t]||[],r=0;r<n.length;r++)if(n[r].callback===e&&(!i||i===n[r].context))return void n.splice(r,1)},t.prototype.validateEventType_=function(t){h.assert(this.allowedEvents_.find((function(e){return e===t})),"Unknown event: "+t)},t}(),Le=function(t){function e(){var e,i,n=t.call(this,["visible"])||this;return"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(i="visibilitychange",e="hidden"):void 0!==document.mozHidden?(i="mozvisibilitychange",e="mozHidden"):void 0!==document.msHidden?(i="msvisibilitychange",e="msHidden"):void 0!==document.webkitHidden&&(i="webkitvisibilitychange",e="webkitHidden")),n.visible_=!0,i&&document.addEventListener(i,(function(){var t=!document[e];t!==n.visible_&&(n.visible_=t,n.trigger("visible",t))}),!1),n}return a.__extends(e,t),e.getInstance=function(){return new e},e.prototype.getInitialEvent=function(t){return h.assert("visible"===t,"Unknown event type: "+t),[this.visible_]},e}(Me),Fe=function(t){function e(){var e=t.call(this,["online"])||this;return e.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||h.isMobileCordova()||(window.addEventListener("online",(function(){e.online_||(e.online_=!0,e.trigger("online",!0))}),!1),window.addEventListener("offline",(function(){e.online_&&(e.online_=!1,e.trigger("online",!1))}),!1)),e}return a.__extends(e,t),e.getInstance=function(){return new e},e.prototype.getInitialEvent=function(t){return h.assert("online"===t,"Unknown event type: "+t),[this.online_]},e.prototype.currentlyOnline=function(){return this.online_},e}(Me),je=function(){function t(t){this.onMessage_=t,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}return t.prototype.closeAfter=function(t,e){this.closeAfterResponse=t,this.onClose=e,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)},t.prototype.handleResponse=function(t,e){var i=this;this.pendingResponses[t]=e;for(var n=function(){var t=r.pendingResponses[r.currentResponseNum];delete r.pendingResponses[r.currentResponseNum];for(var e=function(e){t[e]&&H((function(){i.onMessage_(t[e])}))},n=0;n<t.length;++n)e(n);if(r.currentResponseNum===r.closeAfterResponse)return r.onClose&&(r.onClose(),r.onClose=null),"break";r.currentResponseNum++},r=this;this.pendingResponses[this.currentResponseNum];){if("break"===n())break}},t}(),We=function(){function t(t,e,i,n){this.connId=t,this.repoInfo=e,this.transportSessionId=i,this.lastSessionId=n,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=E(t),this.stats_=Oe.getCollection(e),this.urlFn=function(t){return e.connectionURL("long_polling",t)}}return t.prototype.open=function(t,e){var i=this;this.curSegmentNum=0,this.onDisconnect_=e,this.myPacketOrderer=new je(t),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout((function(){i.log_("Timed out trying to connect."),i.onClosed_(),i.connectTimeoutTimer_=null}),Math.floor(3e4)),function(t){if(h.isNodeSdk()||"complete"===document.readyState)t();else{var e=!1,i=function(){document.body?e||(e=!0,t()):setTimeout(i,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",i,!1),window.addEventListener("load",i,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",(function(){"complete"===document.readyState&&i()})),window.attachEvent("onload",i))}}((function(){if(!i.isClosed_){i.scriptTagHolder=new He((function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=a.__read(t,5),r=n[0],o=n[1],s=n[2];n[3],n[4];if(i.incrementIncomingBytes_(t),i.scriptTagHolder)if(i.connectTimeoutTimer_&&(clearTimeout(i.connectTimeoutTimer_),i.connectTimeoutTimer_=null),i.everConnected_=!0,"start"===r)i.id=o,i.password=s;else{if("close"!==r)throw new Error("Unrecognized command received: "+r);o?(i.scriptTagHolder.sendNewPolls=!1,i.myPacketOrderer.closeAfter(o,(function(){i.onClosed_()}))):i.onClosed_()}}),(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=a.__read(t,2),r=n[0],o=n[1];i.incrementIncomingBytes_(t),i.myPacketOrderer.handleResponse(r,o)}),(function(){i.onClosed_()}),i.urlFn);var t={start:"t"};t.ser=Math.floor(1e8*Math.random()),i.scriptTagHolder.uniqueCallbackIdentifier&&(t.cb=i.scriptTagHolder.uniqueCallbackIdentifier),t.v="5",i.transportSessionId&&(t.s=i.transportSessionId),i.lastSessionId&&(t.ls=i.lastSessionId),"undefined"!=typeof location&&location.href&&-1!==location.href.indexOf("firebaseio.com")&&(t.r="f");var e=i.urlFn(t);i.log_("Connecting via long-poll to "+e),i.scriptTagHolder.addTag(e,(function(){}))}}))},t.prototype.start=function(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)},t.forceAllow=function(){t.forceAllow_=!0},t.forceDisallow=function(){t.forceDisallow_=!0},t.isAvailable=function(){return!h.isNodeSdk()&&(!!t.forceAllow_||!(t.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI))},t.prototype.markConnectionHealthy=function(){},t.prototype.shutdown_=function(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)},t.prototype.onClosed_=function(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))},t.prototype.close=function(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())},t.prototype.send=function(t){var e=h.stringify(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);for(var i=h.base64Encode(e),n=M(i,1840),r=0;r<n.length;r++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,n.length,n[r]),this.curSegmentNum++},t.prototype.addDisconnectPingFrame=function(t,e){if(!h.isNodeSdk()){this.myDisconnFrame=document.createElement("iframe");var i={dframe:"t"};i.id=t,i.pw=e,this.myDisconnFrame.src=this.urlFn(i),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}},t.prototype.incrementIncomingBytes_=function(t){var e=h.stringify(t).length;this.bytesReceived+=e,this.stats_.incrementCounter("bytes_received",e)},t}(),He=function(){function t(e,i,n,r){if(this.onDisconnect=n,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,h.isNodeSdk())this.commandCB=e,this.onMessageCB=i;else{this.uniqueCallbackIdentifier=v(),window["pLPCommand"+this.uniqueCallbackIdentifier]=e,window["pRTLPCB"+this.uniqueCallbackIdentifier]=i,this.myIFrame=t.createIFrame_();var o="";if(this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length))o='<script>document.domain="'+document.domain+'";<\/script>';var s="<html><body>"+o+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(s),this.myIFrame.doc.close()}catch(t){C("frame writing exception"),t.stack&&C(t.stack),C(t)}}}return t.createIFrame_=function(){var t=document.createElement("iframe");if(t.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(t);try{t.contentWindow.document||C("No IE domain setting required")}catch(i){var e=document.domain;t.src="javascript:void((function(){document.open();document.domain='"+e+"';document.close();})())"}return t.contentDocument?t.doc=t.contentDocument:t.contentWindow?t.doc=t.contentWindow.document:t.document&&(t.doc=t.document),t},t.prototype.close=function(){var t=this;this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout((function(){null!==t.myIFrame&&(document.body.removeChild(t.myIFrame),t.myIFrame=null)}),Math.floor(0)));var e=this.onDisconnect;e&&(this.onDisconnect=null,e())},t.prototype.startLongPoll=function(t,e){for(this.myID=t,this.myPW=e,this.alive=!0;this.newRequest_(););},t.prototype.newRequest_=function(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;var t={};t.id=this.myID,t.pw=this.myPW,t.ser=this.currentSerial;for(var e=this.urlFn(t),i="",n=0;this.pendingSegs.length>0;){if(!(this.pendingSegs[0].d.length+30+i.length<=1870))break;var r=this.pendingSegs.shift();i=i+"&seg"+n+"="+r.seg+"&ts"+n+"="+r.ts+"&d"+n+"="+r.d,n++}return e+=i,this.addLongPollTag_(e,this.currentSerial),!0}return!1},t.prototype.enqueueSegment=function(t,e,i){this.pendingSegs.push({seg:t,ts:e,d:i}),this.alive&&this.newRequest_()},t.prototype.addLongPollTag_=function(t,e){var i=this;this.outstandingRequests.add(e);var n=function(){i.outstandingRequests.delete(e),i.newRequest_()},r=setTimeout(n,Math.floor(25e3));this.addTag(t,(function(){clearTimeout(r),n()}))},t.prototype.addTag=function(t,e){var i=this;h.isNodeSdk()?this.doNodeLongPoll(t,e):setTimeout((function(){try{if(!i.sendNewPolls)return;var n=i.myIFrame.doc.createElement("script");n.type="text/javascript",n.async=!0,n.src=t,n.onload=n.onreadystatechange=function(){var t=n.readyState;t&&"loaded"!==t&&"complete"!==t||(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),e())},n.onerror=function(){C("Long-poll script failed to load: "+t),i.sendNewPolls=!1,i.close()},i.myIFrame.doc.body.appendChild(n)}catch(t){}}),Math.floor(1))},t}(),Ye="";
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Be=null;"undefined"!=typeof MozWebSocket?Be=MozWebSocket:"undefined"!=typeof WebSocket&&(Be=WebSocket);var Ue=function(){function t(e,i,n,r){this.connId=e,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=E(this.connId),this.stats_=Oe.getCollection(i),this.connURL=t.connectionURL_(i,n,r)}return t.connectionURL_=function(t,e,i){var n={v:"5"};return!h.isNodeSdk()&&"undefined"!=typeof location&&location.href&&-1!==location.href.indexOf("firebaseio.com")&&(n.r="f"),e&&(n.s=e),i&&(n.ls=i),t.connectionURL("websocket",n)},t.prototype.open=function(t,e){var i=this;this.onDisconnect=e,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,f.set("previous_websocket_failure",!0);try{if(h.isNodeSdk()){var r=h.CONSTANTS.NODE_ADMIN?"AdminNode":"Node",o={headers:{"User-Agent":"Firebase/5/"+Ye+"/"+n.platform+"/"+r}},s=n.env,a=0===this.connURL.indexOf("wss://")?s.HTTPS_PROXY||s.https_proxy:s.HTTP_PROXY||s.http_proxy;a&&(o.proxy={origin:a}),this.mySock=new Be(this.connURL,[],o)}else this.mySock=new Be(this.connURL)}catch(t){this.log_("Error instantiating WebSocket.");var l=t.message||t.data;return l&&this.log_(l),void this.onClosed_()}this.mySock.onopen=function(){i.log_("Websocket connected."),i.everConnected_=!0},this.mySock.onclose=function(){i.log_("Websocket connection was disconnected."),i.mySock=null,i.onClosed_()},this.mySock.onmessage=function(t){i.handleIncomingFrame(t)},this.mySock.onerror=function(t){i.log_("WebSocket error.  Closing connection.");var e=t.message||t.data;e&&i.log_(e),i.onClosed_()}},t.prototype.start=function(){},t.forceDisallow=function(){t.forceDisallow_=!0},t.isAvailable=function(){var e=!1;if("undefined"!=typeof navigator&&navigator.userAgent){var i=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);i&&i.length>1&&parseFloat(i[1])<4.4&&(e=!0)}return!e&&null!==Be&&!t.forceDisallow_},t.previouslyFailed=function(){return f.isInMemoryStorage||!0===f.get("previous_websocket_failure")},t.prototype.markConnectionHealthy=function(){f.remove("previous_websocket_failure")},t.prototype.appendFrame_=function(t){if(this.frames.push(t),this.frames.length===this.totalFrames){var e=this.frames.join("");this.frames=null;var i=h.jsonEval(e);this.onMessage(i)}},t.prototype.handleNewFrameCount_=function(t){this.totalFrames=t,this.frames=[]},t.prototype.extractFrameCount_=function(t){if(h.assert(null===this.frames,"We already have a frame buffer"),t.length<=6){var e=Number(t);if(!isNaN(e))return this.handleNewFrameCount_(e),null}return this.handleNewFrameCount_(1),t},t.prototype.handleIncomingFrame=function(t){if(null!==this.mySock){var e=t.data;if(this.bytesReceived+=e.length,this.stats_.incrementCounter("bytes_received",e.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(e);else{var i=this.extractFrameCount_(e);null!==i&&this.appendFrame_(i)}}},t.prototype.send=function(t){this.resetKeepAlive();var e=h.stringify(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);var i=M(e,16384);i.length>1&&this.sendString_(String(i.length));for(var n=0;n<i.length;n++)this.sendString_(i[n])},t.prototype.shutdown_=function(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)},t.prototype.onClosed_=function(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))},t.prototype.close=function(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())},t.prototype.resetKeepAlive=function(){var t=this;clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval((function(){t.mySock&&t.sendString_("0"),t.resetKeepAlive()}),Math.floor(45e3))},t.prototype.sendString_=function(t){try{this.mySock.send(t)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}},t.responsesRequiredToBeHealthy=2,t.healthyTimeout=3e4,t}(),Xe=function(){function t(t){this.initTransports_(t)}return Object.defineProperty(t,"ALL_TRANSPORTS",{get:function(){return[We,Ue]},enumerable:!0,configurable:!0}),t.prototype.initTransports_=function(e){var i,n,r=Ue&&Ue.isAvailable(),o=r&&!Ue.previouslyFailed();if(e.webSocketOnly&&(r||k("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),o=!0),o)this.transports_=[Ue];else{var s=this.transports_=[];try{for(var h=a.__values(t.ALL_TRANSPORTS),l=h.next();!l.done;l=h.next()){var u=l.value;u&&u.isAvailable()&&s.push(u)}}catch(t){i={error:t}}finally{try{l&&!l.done&&(n=h.return)&&n.call(h)}finally{if(i)throw i.error}}}},t.prototype.initialTransport=function(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")},t.prototype.upgradeTransport=function(){return this.transports_.length>1?this.transports_[1]:null},t}(),Ve=function(){function t(t,e,i,n,r,o,s){this.id=t,this.repoInfo_=e,this.onMessage_=i,this.onReady_=n,this.onDisconnect_=r,this.onKill_=o,this.lastSessionId=s,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=E("c:"+this.id+":"),this.transportManager_=new Xe(e),this.log_("Connection created"),this.start_()}return t.prototype.start_=function(){var t=this,e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,void 0,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;var i=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout((function(){t.conn_&&t.conn_.open(i,n)}),Math.floor(0));var r=e.healthyTimeout||0;r>0&&(this.healthyTimeout_=Y((function(){t.healthyTimeout_=null,t.isHealthy_||(t.conn_&&t.conn_.bytesReceived>102400?(t.log_("Connection exceeded healthy timeout but has received "+t.conn_.bytesReceived+" bytes.  Marking connection healthy."),t.isHealthy_=!0,t.conn_.markConnectionHealthy()):t.conn_&&t.conn_.bytesSent>10240?t.log_("Connection exceeded healthy timeout but has sent "+t.conn_.bytesSent+" bytes.  Leaving connection alive."):(t.log_("Closing unhealthy connection after timeout."),t.close()))}),Math.floor(r)))},t.prototype.nextTransportId_=function(){return"c:"+this.id+":"+this.connectionCount++},t.prototype.disconnReceiver_=function(t){var e=this;return function(i){t===e.conn_?e.onConnectionLost_(i):t===e.secondaryConn_?(e.log_("Secondary connection lost."),e.onSecondaryConnectionLost_()):e.log_("closing an old connection")}},t.prototype.connReceiver_=function(t){var e=this;return function(i){2!==e.state_&&(t===e.rx_?e.onPrimaryMessageReceived_(i):t===e.secondaryConn_?e.onSecondaryMessageReceived_(i):e.log_("message on old connection"))}},t.prototype.sendRequest=function(t){var e={t:"d",d:t};this.sendData_(e)},t.prototype.tryCleanupConnection=function(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)},t.prototype.onSecondaryControl_=function(t){if("t"in t){var e=t.t;"a"===e?this.upgradeIfSecondaryHealthy_():"r"===e?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===e&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}},t.prototype.onSecondaryMessageReceived_=function(t){var e=D("t",t),i=D("d",t);if("c"===e)this.onSecondaryControl_(i);else{if("d"!==e)throw new Error("Unknown protocol layer: "+e);this.pendingDataMessages.push(i)}},t.prototype.upgradeIfSecondaryHealthy_=function(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))},t.prototype.proceedWithUpgrade_=function(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()},t.prototype.onPrimaryMessageReceived_=function(t){var e=D("t",t),i=D("d",t);"c"===e?this.onControl_(i):"d"===e&&this.onDataMessage_(i)},t.prototype.onDataMessage_=function(t){this.onPrimaryResponse_(),this.onMessage_(t)},t.prototype.onPrimaryResponse_=function(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))},t.prototype.onControl_=function(t){var e=D("t",t);if("d"in t){var i=t.d;if("h"===e)this.onHandshake_(i);else if("n"===e){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(var n=0;n<this.pendingDataMessages.length;++n)this.onDataMessage_(this.pendingDataMessages[n]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===e?this.onConnectionShutdown_(i):"r"===e?this.onReset_(i):"e"===e?T("Server Error: "+i):"o"===e?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):T("Unknown control packet command: "+e)}},t.prototype.onHandshake_=function(t){var e=t.ts,i=t.v,n=t.h;this.sessionId=t.s,this.repoInfo_.updateHost(n),0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,e),"5"!==i&&k("Protocol version mismatch detected"),this.tryStartUpgrade_())},t.prototype.tryStartUpgrade_=function(){var t=this.transportManager_.upgradeTransport();t&&this.startUpgrade_(t)},t.prototype.startUpgrade_=function(t){var e=this;this.secondaryConn_=new t(this.nextTransportId_(),this.repoInfo_,this.sessionId),this.secondaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;var i=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(i,n),Y((function(){e.secondaryConn_&&(e.log_("Timed out trying to upgrade."),e.secondaryConn_.close())}),Math.floor(6e4))},t.prototype.onReset_=function(t){this.log_("Reset packet received.  New host: "+t),this.repoInfo_.updateHost(t),1===this.state_?this.close():(this.closeConnections_(),this.start_())},t.prototype.onConnectionEstablished_=function(t,e){var i=this;this.log_("Realtime connection established."),this.conn_=t,this.state_=1,this.onReady_&&(this.onReady_(e,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Y((function(){i.sendPingOnPrimaryIfNecessary_()}),Math.floor(5e3))},t.prototype.sendPingOnPrimaryIfNecessary_=function(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))},t.prototype.onSecondaryConnectionLost_=function(){var t=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==t&&this.rx_!==t||this.close()},t.prototype.onConnectionLost_=function(t){this.conn_=null,t||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(f.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()},t.prototype.onConnectionShutdown_=function(t){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(t),this.onKill_=null),this.onDisconnect_=null,this.close()},t.prototype.sendData_=function(t){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(t)},t.prototype.close=function(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))},t.prototype.closeConnections_=function(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)},t}(),qe=function(){function t(){}return t.prototype.put=function(t,e,i,n){},t.prototype.merge=function(t,e,i,n){},t.prototype.refreshAuthToken=function(t){},t.prototype.onDisconnectPut=function(t,e,i){},t.prototype.onDisconnectMerge=function(t,e,i){},t.prototype.onDisconnectCancel=function(t,e){},t.prototype.reportStats=function(t){},t}(),ze=function(t){function e(i,n,r,o,s,a){var l=t.call(this)||this;if(l.repoInfo_=i,l.onDataUpdate_=n,l.onConnectStatus_=r,l.onServerInfoUpdate_=o,l.authTokenProvider_=s,l.authOverride_=a,l.id=e.nextPersistentConnectionId_++,l.log_=E("p:"+l.id+":"),l.interruptReasons_={},l.listens=new Map,l.outstandingPuts_=[],l.outstandingPutCount_=0,l.onDisconnectRequestQueue_=[],l.connected_=!1,l.reconnectDelay_=1e3,l.maxReconnectDelay_=3e5,l.securityDebugCallback_=null,l.lastSessionId=null,l.establishConnectionTimer_=null,l.visible_=!1,l.requestCBHash_={},l.requestNumber_=0,l.realtime_=null,l.authToken_=null,l.forceTokenRefresh_=!1,l.invalidAuthTokenCount_=0,l.firstConnection_=!0,l.lastConnectionAttemptTime_=null,l.lastConnectionEstablishedTime_=null,a&&!h.isNodeSdk())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");return l.scheduleConnect_(0),Le.getInstance().on("visible",l.onVisible_,l),-1===i.host.indexOf("fblocal")&&Fe.getInstance().on("online",l.onOnline_,l),l}return a.__extends(e,t),e.prototype.sendRequest=function(t,e,i){var n=++this.requestNumber_,r={r:n,a:t,b:e};this.log_(h.stringify(r)),h.assert(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(r),i&&(this.requestCBHash_[n]=i)},e.prototype.listen=function(t,e,i,n){var r=t.queryIdentifier(),o=t.path.toString();this.log_("Listen called for "+o+" "+r),this.listens.has(o)||this.listens.set(o,new Map),h.assert(t.getQueryParams().isDefault()||!t.getQueryParams().loadsAllData(),"listen() called for non-default but complete query"),h.assert(!this.listens.get(o).has(r),"listen() called twice for same path/queryId.");var s={onComplete:n,hashFn:e,query:t,tag:i};this.listens.get(o).set(r,s),this.connected_&&this.sendListen_(s)},e.prototype.sendListen_=function(t){var i=this,n=t.query,r=n.path.toString(),o=n.queryIdentifier();this.log_("Listen on "+r+" for "+o);var s={p:r};t.tag&&(s.q=n.queryObject(),s.t=t.tag),s.h=t.hashFn(),this.sendRequest("q",s,(function(s){var a=s.d,h=s.s;e.warnOnListenWarnings_(a,n),(i.listens.get(r)&&i.listens.get(r).get(o))===t&&(i.log_("listen response",s),"ok"!==h&&i.removeListen_(r,o),t.onComplete&&t.onComplete(h,a))}))},e.warnOnListenWarnings_=function(t,e){if(t&&"object"==typeof t&&h.contains(t,"w")){var i=h.safeGet(t,"w");if(Array.isArray(i)&&~i.indexOf("no_index")){var n='".indexOn": "'+e.getQueryParams().getIndex().toString()+'"',r=e.path.toString();k("Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding "+n+" at "+r+" to your security rules for better performance.")}}},e.prototype.refreshAuthToken=function(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},(function(){})),this.reduceReconnectDelayIfAdminCredential_(t)},e.prototype.reduceReconnectDelayIfAdminCredential_=function(t){(t&&40===t.length||h.isAdmin(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)},e.prototype.tryAuth=function(){var t=this;if(this.connected_&&this.authToken_){var e=this.authToken_,i=h.isValidFormat(e)?"auth":"gauth",n={cred:e};null===this.authOverride_?n.noauth=!0:"object"==typeof this.authOverride_&&(n.authvar=this.authOverride_),this.sendRequest(i,n,(function(i){var n=i.s,r=i.d||"error";t.authToken_===e&&("ok"===n?t.invalidAuthTokenCount_=0:t.onAuthRevoked_(n,r))}))}},e.prototype.unlisten=function(t,e){var i=t.path.toString(),n=t.queryIdentifier();this.log_("Unlisten called for "+i+" "+n),h.assert(t.getQueryParams().isDefault()||!t.getQueryParams().loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(i,n)&&this.connected_&&this.sendUnlisten_(i,n,t.queryObject(),e)},e.prototype.sendUnlisten_=function(t,e,i,n){this.log_("Unlisten on "+t+" for "+e);var r={p:t};n&&(r.q=i,r.t=n),this.sendRequest("n",r)},e.prototype.onDisconnectPut=function(t,e,i){this.connected_?this.sendOnDisconnect_("o",t,e,i):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:e,onComplete:i})},e.prototype.onDisconnectMerge=function(t,e,i){this.connected_?this.sendOnDisconnect_("om",t,e,i):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:e,onComplete:i})},e.prototype.onDisconnectCancel=function(t,e){this.connected_?this.sendOnDisconnect_("oc",t,null,e):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:e})},e.prototype.sendOnDisconnect_=function(t,e,i,n){var r={p:e,d:i};this.log_("onDisconnect "+t,r),this.sendRequest(t,r,(function(t){n&&setTimeout((function(){n(t.s,t.d)}),Math.floor(0))}))},e.prototype.put=function(t,e,i,n){this.putInternal("p",t,e,i,n)},e.prototype.merge=function(t,e,i,n){this.putInternal("m",t,e,i,n)},e.prototype.putInternal=function(t,e,i,n,r){var o={p:e,d:i};void 0!==r&&(o.h=r),this.outstandingPuts_.push({action:t,request:o,onComplete:n}),this.outstandingPutCount_++;var s=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(s):this.log_("Buffering put: "+e)},e.prototype.sendPut_=function(t){var e=this,i=this.outstandingPuts_[t].action,n=this.outstandingPuts_[t].request,r=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(i,n,(function(n){e.log_(i+" response",n),delete e.outstandingPuts_[t],e.outstandingPutCount_--,0===e.outstandingPutCount_&&(e.outstandingPuts_=[]),r&&r(n.s,n.d)}))},e.prototype.reportStats=function(t){var e=this;if(this.connected_){var i={c:t};this.log_("reportStats",i),this.sendRequest("s",i,(function(t){if("ok"!==t.s){var i=t.d;e.log_("reportStats","Error sending stats: "+i)}}))}},e.prototype.onDataMessage_=function(t){if("r"in t){this.log_("from server: "+h.stringify(t));var e=t.r,i=this.requestCBHash_[e];i&&(delete this.requestCBHash_[e],i(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}},e.prototype.onDataPush_=function(t,e){this.log_("handleServerMessage",t,e),"d"===t?this.onDataUpdate_(e.p,e.d,!1,e.t):"m"===t?this.onDataUpdate_(e.p,e.d,!0,e.t):"c"===t?this.onListenRevoked_(e.p,e.q):"ac"===t?this.onAuthRevoked_(e.s,e.d):"sd"===t?this.onSecurityDebugPacket_(e):T("Unrecognized action received from server: "+h.stringify(t)+"\nAre you using the latest client?")},e.prototype.onReady_=function(t,e){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(t),this.lastSessionId=e,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)},e.prototype.scheduleConnect_=function(t){var e=this;h.assert(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout((function(){e.establishConnectionTimer_=null,e.establishConnection_()}),Math.floor(t))},e.prototype.onVisible_=function(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)),this.visible_=t},e.prototype.onOnline_=function(t){t?(this.log_("Browser went online."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())},e.prototype.onRealtimeDisconnect_=function(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){if(this.visible_){if(this.lastConnectionEstablishedTime_){(new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=1e3),this.lastConnectionEstablishedTime_=null}}else this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime();var t=(new Date).getTime()-this.lastConnectionAttemptTime_,e=Math.max(0,this.reconnectDelay_-t);e=Math.random()*e,this.log_("Trying to reconnect in "+e+"ms"),this.scheduleConnect_(e),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)},e.prototype.establishConnection_=function(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;var t=this.onDataMessage_.bind(this),i=this.onReady_.bind(this),n=this.onRealtimeDisconnect_.bind(this),r=this.id+":"+e.nextConnectionId_++,o=this,s=this.lastSessionId,a=!1,l=null,u=function(){l?l.close():(a=!0,n())};this.realtime_={close:u,sendRequest:function(t){h.assert(l,"sendRequest call when we're not connected not allowed."),l.sendRequest(t)}};var c=this.forceTokenRefresh_;this.forceTokenRefresh_=!1,this.authTokenProvider_.getToken(c).then((function(e){a?C("getToken() completed but was canceled"):(C("getToken() completed. Creating connection."),o.authToken_=e&&e.accessToken,l=new Ve(r,o.repoInfo_,t,i,n,(function(t){k(t+" ("+o.repoInfo_.toString()+")"),o.interrupt("server_kill")}),s))})).then(null,(function(t){o.log_("Failed to get token: "+t),a||(h.CONSTANTS.NODE_ADMIN&&k(t),u())}))}},e.prototype.interrupt=function(t){C("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())},e.prototype.resume=function(t){C("Resuming connection for reason: "+t),delete this.interruptReasons_[t],h.isEmpty(this.interruptReasons_)&&(this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0))},e.prototype.handleTimestamp_=function(t){var e=t-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:e})},e.prototype.cancelSentTransactions_=function(){for(var t=0;t<this.outstandingPuts_.length;t++){var e=this.outstandingPuts_[t];e&&"h"in e.request&&e.queued&&(e.onComplete&&e.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])},e.prototype.onListenRevoked_=function(t,e){var i;i=e?e.map((function(t){return A(t)})).join("$"):"default";var n=this.removeListen_(t,i);n&&n.onComplete&&n.onComplete("permission_denied")},e.prototype.removeListen_=function(t,e){var i,n=new B(t).toString();if(this.listens.has(n)){var r=this.listens.get(n);i=r.get(e),r.delete(e),0===r.size&&this.listens.delete(n)}else i=void 0;return i},e.prototype.onAuthRevoked_=function(t,e){C("Auth token revoked: "+t+"/"+e),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==t&&"permission_denied"!==t||(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))},e.prototype.onSecurityDebugPacket_=function(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace("\n","\nFIREBASE: "))},e.prototype.restoreState_=function(){var t,e,i,n;this.tryAuth();try{for(var r=a.__values(this.listens.values()),o=r.next();!o.done;o=r.next()){var s=o.value;try{for(var h=(i=void 0,a.__values(s.values())),l=h.next();!l.done;l=h.next()){var u=l.value;this.sendListen_(u)}}catch(t){i={error:t}}finally{try{l&&!l.done&&(n=h.return)&&n.call(h)}finally{if(i)throw i.error}}}}catch(e){t={error:e}}finally{try{o&&!o.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}for(var c=0;c<this.outstandingPuts_.length;c++)this.outstandingPuts_[c]&&this.sendPut_(c);for(;this.onDisconnectRequestQueue_.length;){var d=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(d.action,d.pathString,d.data,d.onComplete)}},e.prototype.sendConnectStats_=function(){var t={},e="js";h.CONSTANTS.NODE_ADMIN?e="admin_node":h.CONSTANTS.NODE_CLIENT&&(e="node"),t["sdk."+e+"."+Ye.replace(/\./g,"-")]=1,h.isMobileCordova()?t["framework.cordova"]=1:h.isReactNative()&&(t["framework.reactnative"]=1),this.reportStats(t)},e.prototype.shouldReconnect_=function(){var t=Fe.getInstance().currentlyOnline();return h.isEmpty(this.interruptReasons_)&&t},e.nextPersistentConnectionId_=0,e.nextConnectionId_=0,e}(qe),Qe=function(t){function e(e,i,n){var r=t.call(this)||this;return r.repoInfo_=e,r.onDataUpdate_=i,r.authTokenProvider_=n,r.log_=E("p:rest:"),r.listens_={},r}return a.__extends(e,t),e.prototype.reportStats=function(t){throw new Error("Method not implemented.")},e.getListenId_=function(t,e){return void 0!==e?"tag$"+e:(h.assert(t.getQueryParams().isDefault(),"should have a tag if it's not a default query."),t.path.toString())},e.prototype.listen=function(t,i,n,r){var o=this,s=t.path.toString();this.log_("Listen called for "+s+" "+t.queryIdentifier());var a=e.getListenId_(t,n),l={};this.listens_[a]=l;var u=t.getQueryParams().toRestQueryStringParameters();this.restRequest_(s+".json",u,(function(t,e){var i=e;(404===t&&(i=null,t=null),null===t&&o.onDataUpdate_(s,i,!1,n),h.safeGet(o.listens_,a)===l)&&r(t?401===t?"permission_denied":"rest_error:"+t:"ok",null)}))},e.prototype.unlisten=function(t,i){var n=e.getListenId_(t,i);delete this.listens_[n]},e.prototype.refreshAuthToken=function(t){},e.prototype.restRequest_=function(t,e,i){var n=this;void 0===e&&(e={}),e.format="export",this.authTokenProvider_.getToken(!1).then((function(r){var o=r&&r.accessToken;o&&(e.auth=o);var s=(n.repoInfo_.secure?"https://":"http://")+n.repoInfo_.host+t+"?ns="+n.repoInfo_.namespace+h.querystring(e);n.log_("Sending REST request for "+s);var a=new XMLHttpRequest;a.onreadystatechange=function(){if(i&&4===a.readyState){n.log_("REST Response for "+s+" received. status:",a.status,"response:",a.responseText);var t=null;if(a.status>=200&&a.status<300){try{t=h.jsonEval(a.responseText)}catch(t){k("Failed to parse JSON response for "+s+": "+a.responseText)}i(null,t)}else 401!==a.status&&404!==a.status&&k("Got unsuccessful REST response for "+s+" Status: "+a.status),i(a.status);i=null}},a.open("GET",s,!0),a.send()}))},e}(qe),Ke=function(){function t(t,e,i,n){var r=this;this.repoInfo_=t,this.app=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new De,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=new te,this.persistentConnection_=null;var o=new xe(i,n);if(this.stats_=Oe.getCollection(t),e||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)this.server_=new Qe(this.repoInfo_,this.onDataUpdate_.bind(this),o),setTimeout(this.onConnectStatus_.bind(this,!0),0);else{var s=i.options.databaseAuthVariableOverride;if(null!=s){if("object"!=typeof s)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{h.stringify(s)}catch(t){throw new Error("Invalid authOverride provided: "+t)}}this.persistentConnection_=new ze(this.repoInfo_,this.onDataUpdate_.bind(this),this.onConnectStatus_.bind(this),this.onServerInfoUpdate_.bind(this),o,s),this.server_=this.persistentConnection_}o.addTokenChangeListener((function(t){r.server_.refreshAuthToken(t)})),this.statsReporter_=Oe.getOrCreateReporter(t,(function(){return new Re(r.stats_,r.server_)})),this.transactionsInit_(),this.infoData_=new ke,this.infoSyncTree_=new Pe({startListening:function(t,e,i,n){var o=[],s=r.infoData_.getNode(t.path);return s.isEmpty()||(o=r.infoSyncTree_.applyServerOverwrite(t.path,s),setTimeout((function(){n("ok")}),0)),o},stopListening:function(){}}),this.updateInfo_("connected",!1),this.serverSyncTree_=new Pe({startListening:function(t,e,i,n){return r.server_.listen(t,i,e,(function(e,i){var o=n(e,i);r.eventQueue_.raiseEventsForChangedPath(t.path,o)})),[]},stopListening:function(t,e){r.server_.unlisten(t,e)}})}return t.prototype.toString=function(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host},t.prototype.name=function(){return this.repoInfo_.namespace},t.prototype.serverTime=function(){var t=this.infoData_.getNode(new B(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t},t.prototype.generateServerValues=function(){return(t=(t={timestamp:this.serverTime()})||{}).timestamp=t.timestamp||(new Date).getTime(),t;var t},t.prototype.onDataUpdate_=function(t,e,i,n){this.dataUpdateCount++;var r=new B(t);e=this.interceptServerDataCallback_?this.interceptServerDataCallback_(t,e):e;var o=[];if(n)if(i){var s=h.map(e,(function(t){return Ut(t)}));o=this.serverSyncTree_.applyTaggedQueryMerge(r,s,n)}else{var a=Ut(e);o=this.serverSyncTree_.applyTaggedQueryOverwrite(r,a,n)}else if(i){var l=h.map(e,(function(t){return Ut(t)}));o=this.serverSyncTree_.applyServerMerge(r,l)}else{var u=Ut(e);o=this.serverSyncTree_.applyServerOverwrite(r,u)}var c=r;o.length>0&&(c=this.rerunTransactions_(r)),this.eventQueue_.raiseEventsForChangedPath(c,o)},t.prototype.interceptServerData_=function(t){this.interceptServerDataCallback_=t},t.prototype.onConnectStatus_=function(t){this.updateInfo_("connected",t),!1===t&&this.runOnDisconnectEvents_()},t.prototype.onServerInfoUpdate_=function(t){var e=this;L(t,(function(t,i){e.updateInfo_(t,i)}))},t.prototype.updateInfo_=function(t,e){var i=new B("/.info/"+t),n=Ut(e);this.infoData_.updateSnapshot(i,n);var r=this.infoSyncTree_.applyServerOverwrite(i,n);this.eventQueue_.raiseEventsForChangedPath(i,r)},t.prototype.getNextWriteId_=function(){return this.nextWriteId_++},t.prototype.setWithPriority=function(t,e,i,n){var r=this;this.log_("set",{path:t.toString(),value:e,priority:i});var o=this.generateServerValues(),s=Ut(e,i),a=ie(s,o),h=this.getNextWriteId_(),l=this.serverSyncTree_.applyUserOverwrite(t,a,h,!0);this.eventQueue_.queueEvents(l),this.server_.put(t.toString(),s.val(!0),(function(e,i){var o="ok"===e;o||k("set at "+t+" failed: "+e);var s=r.serverSyncTree_.ackUserWrite(h,!o);r.eventQueue_.raiseEventsForChangedPath(t,s),r.callOnCompleteCallback(n,e,i)}));var u=this.abortTransactions_(t);this.rerunTransactions_(u),this.eventQueue_.raiseEventsForChangedPath(u,[])},t.prototype.update=function(t,e,i){var n=this;this.log_("update",{path:t.toString(),value:e});var r=!0,o=this.generateServerValues(),s={};if(L(e,(function(t,e){r=!1;var i=Ut(e);s[t]=ie(i,o)})),r)C("update() called with empty data.  Don't do anything."),this.callOnCompleteCallback(i,"ok");else{var a=this.getNextWriteId_(),h=this.serverSyncTree_.applyUserMerge(t,s,a);this.eventQueue_.queueEvents(h),this.server_.merge(t.toString(),e,(function(e,r){var o="ok"===e;o||k("update at "+t+" failed: "+e);var s=n.serverSyncTree_.ackUserWrite(a,!o),h=s.length>0?n.rerunTransactions_(t):t;n.eventQueue_.raiseEventsForChangedPath(h,s),n.callOnCompleteCallback(i,e,r)})),L(e,(function(e){var i=n.abortTransactions_(t.child(e));n.rerunTransactions_(i)})),this.eventQueue_.raiseEventsForChangedPath(t,[])}},t.prototype.runOnDisconnectEvents_=function(){var t=this;this.log_("onDisconnectEvents");var e=this.generateServerValues(),i=function(t,e){var i=new te;return t.forEachTree(new B(""),(function(t,n){i.remember(t,ie(n,e))})),i}(this.onDisconnect_,e),n=[];i.forEachTree(B.Empty,(function(e,i){n=n.concat(t.serverSyncTree_.applyServerOverwrite(e,i));var r=t.abortTransactions_(e);t.rerunTransactions_(r)})),this.onDisconnect_=new te,this.eventQueue_.raiseEventsForChangedPath(B.Empty,n)},t.prototype.onDisconnectCancel=function(t,e){var i=this;this.server_.onDisconnectCancel(t.toString(),(function(n,r){"ok"===n&&i.onDisconnect_.forget(t),i.callOnCompleteCallback(e,n,r)}))},t.prototype.onDisconnectSet=function(t,e,i){var n=this,r=Ut(e);this.server_.onDisconnectPut(t.toString(),r.val(!0),(function(e,o){"ok"===e&&n.onDisconnect_.remember(t,r),n.callOnCompleteCallback(i,e,o)}))},t.prototype.onDisconnectSetWithPriority=function(t,e,i,n){var r=this,o=Ut(e,i);this.server_.onDisconnectPut(t.toString(),o.val(!0),(function(e,i){"ok"===e&&r.onDisconnect_.remember(t,o),r.callOnCompleteCallback(n,e,i)}))},t.prototype.onDisconnectUpdate=function(t,e,i){var n=this;if(h.isEmpty(e))return C("onDisconnect().update() called with empty data.  Don't do anything."),void this.callOnCompleteCallback(i,"ok");this.server_.onDisconnectMerge(t.toString(),e,(function(r,o){"ok"===r&&L(e,(function(e,i){var r=Ut(i);n.onDisconnect_.remember(t.child(e),r)})),n.callOnCompleteCallback(i,r,o)}))},t.prototype.addEventCallbackForQuery=function(t,e){var i;i=".info"===t.path.getFront()?this.infoSyncTree_.addEventRegistration(t,e):this.serverSyncTree_.addEventRegistration(t,e),this.eventQueue_.raiseEventsAtPath(t.path,i)},t.prototype.removeEventCallbackForQuery=function(t,e){var i;i=".info"===t.path.getFront()?this.infoSyncTree_.removeEventRegistration(t,e):this.serverSyncTree_.removeEventRegistration(t,e),this.eventQueue_.raiseEventsAtPath(t.path,i)},t.prototype.interrupt=function(){this.persistentConnection_&&this.persistentConnection_.interrupt("repo_interrupt")},t.prototype.resume=function(){this.persistentConnection_&&this.persistentConnection_.resume("repo_interrupt")},t.prototype.stats=function(t){if(void 0===t&&(t=!1),"undefined"!=typeof console){var e;t?(this.statsListener_||(this.statsListener_=new Ne(this.stats_)),e=this.statsListener_.get()):e=this.stats_.get();var i=Object.keys(e).reduce((function(t,e){return Math.max(e.length,t)}),0);L(e,(function(t,e){for(var n=t,r=t.length;r<i+2;r++)n+=" ";console.log(n+e)}))}},t.prototype.statsIncrementCounter=function(t){this.stats_.incrementCounter(t),this.statsReporter_.includeStat(t)},t.prototype.log_=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i="";this.persistentConnection_&&(i=this.persistentConnection_.id+":"),C.apply(void 0,a.__spread([i],t))},t.prototype.callOnCompleteCallback=function(t,e,i){t&&H((function(){if("ok"===e)t(null);else{var n=(e||"error").toUpperCase(),r=n;i&&(r+=": "+i);var o=new Error(r);o.code=n,t(o)}}))},Object.defineProperty(t.prototype,"database",{get:function(){return this.__database||(this.__database=new oi(this))},enumerable:!0,configurable:!0}),t}(),Ge=function(){function t(e){this.indexedFilter_=new fe(e.getIndex()),this.index_=e.getIndex(),this.startPost_=t.getStartPost_(e),this.endPost_=t.getEndPost_(e)}return t.prototype.getStartPost=function(){return this.startPost_},t.prototype.getEndPost=function(){return this.endPost_},t.prototype.matches=function(t){return this.index_.compare(this.getStartPost(),t)<=0&&this.index_.compare(t,this.getEndPost())<=0},t.prototype.updateChild=function(t,e,i,n,r,o){return this.matches(new vt(e,i))||(i=Yt.EMPTY_NODE),this.indexedFilter_.updateChild(t,e,i,n,r,o)},t.prototype.updateFullNode=function(t,e,i){e.isLeafNode()&&(e=Yt.EMPTY_NODE);var n=e.withIndex(this.index_);n=n.updatePriority(Yt.EMPTY_NODE);var r=this;return e.forEachChild(It,(function(t,e){r.matches(new vt(t,e))||(n=n.updateImmediateChild(t,Yt.EMPTY_NODE))})),this.indexedFilter_.updateFullNode(t,n,i)},t.prototype.updatePriority=function(t,e){return t},t.prototype.filtersNodes=function(){return!0},t.prototype.getIndexedFilter=function(){return this.indexedFilter_},t.prototype.getIndex=function(){return this.index_},t.getStartPost_=function(t){if(t.hasStart()){var e=t.getIndexStartName();return t.getIndex().makePost(t.getIndexStartValue(),e)}return t.getIndex().minPost()},t.getEndPost_=function(t){if(t.hasEnd()){var e=t.getIndexEndName();return t.getIndex().makePost(t.getIndexEndValue(),e)}return t.getIndex().maxPost()},t}(),$e=function(){function t(t){this.rangedFilter_=new Ge(t),this.index_=t.getIndex(),this.limit_=t.getLimit(),this.reverse_=!t.isViewFromLeft()}return t.prototype.updateChild=function(t,e,i,n,r,o){return this.rangedFilter_.matches(new vt(e,i))||(i=Yt.EMPTY_NODE),t.getImmediateChild(e).equals(i)?t:t.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(t,e,i,n,r,o):this.fullLimitUpdateChild_(t,e,i,r,o)},t.prototype.updateFullNode=function(t,e,i){var n;if(e.isLeafNode()||e.isEmpty())n=Yt.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<e.numChildren()&&e.isIndexed(this.index_)){n=Yt.EMPTY_NODE.withIndex(this.index_);var r=void 0;r=this.reverse_?e.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):e.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);for(var o=0;r.hasNext()&&o<this.limit_;){var s=r.getNext();if(!(this.reverse_?this.index_.compare(this.rangedFilter_.getStartPost(),s)<=0:this.index_.compare(s,this.rangedFilter_.getEndPost())<=0))break;n=n.updateImmediateChild(s.name,s.node),o++}}else{n=(n=e.withIndex(this.index_)).updatePriority(Yt.EMPTY_NODE);var a=void 0,h=void 0,l=void 0;r=void 0;if(this.reverse_){r=n.getReverseIterator(this.index_),a=this.rangedFilter_.getEndPost(),h=this.rangedFilter_.getStartPost();var u=this.index_.getCompare();l=function(t,e){return u(e,t)}}else r=n.getIterator(this.index_),a=this.rangedFilter_.getStartPost(),h=this.rangedFilter_.getEndPost(),l=this.index_.getCompare();o=0;for(var c=!1;r.hasNext();){s=r.getNext();!c&&l(a,s)<=0&&(c=!0),c&&o<this.limit_&&l(s,h)<=0?o++:n=n.updateImmediateChild(s.name,Yt.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(t,n,i)},t.prototype.updatePriority=function(t,e){return t},t.prototype.filtersNodes=function(){return!0},t.prototype.getIndexedFilter=function(){return this.rangedFilter_.getIndexedFilter()},t.prototype.getIndex=function(){return this.index_},t.prototype.fullLimitUpdateChild_=function(t,e,i,n,r){var o;if(this.reverse_){var s=this.index_.getCompare();o=function(t,e){return s(e,t)}}else o=this.index_.getCompare();var a=t;h.assert(a.numChildren()===this.limit_,"");var l=new vt(e,i),u=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),c=this.rangedFilter_.matches(l);if(a.hasChild(e)){for(var d=a.getImmediateChild(e),p=n.getChildAfterChild(this.index_,u,this.reverse_);null!=p&&(p.name===e||a.hasChild(p.name));)p=n.getChildAfterChild(this.index_,p,this.reverse_);var f=null==p?1:o(p,l);if(c&&!i.isEmpty()&&f>=0)return null!=r&&r.trackChildChange(pe.childChangedChange(e,i,d)),a.updateImmediateChild(e,i);null!=r&&r.trackChildChange(pe.childRemovedChange(e,d));var y=a.updateImmediateChild(e,Yt.EMPTY_NODE);return null!=p&&this.rangedFilter_.matches(p)?(null!=r&&r.trackChildChange(pe.childAddedChange(p.name,p.node)),y.updateImmediateChild(p.name,p.node)):y}return i.isEmpty()?t:c&&o(u,l)>=0?(null!=r&&(r.trackChildChange(pe.childRemovedChange(u.name,u.node)),r.trackChildChange(pe.childAddedChange(e,i))),a.updateImmediateChild(e,i).updateImmediateChild(u.name,Yt.EMPTY_NODE)):t},t}(),Je=function(){function t(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=It}return t.prototype.hasStart=function(){return this.startSet_},t.prototype.isViewFromLeft=function(){return""===this.viewFrom_?this.startSet_:this.viewFrom_===t.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT},t.prototype.getIndexStartValue=function(){return h.assert(this.startSet_,"Only valid if start has been set"),this.indexStartValue_},t.prototype.getIndexStartName=function(){return h.assert(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:I},t.prototype.hasEnd=function(){return this.endSet_},t.prototype.getIndexEndValue=function(){return h.assert(this.endSet_,"Only valid if end has been set"),this.indexEndValue_},t.prototype.getIndexEndName=function(){return h.assert(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:O},t.prototype.hasLimit=function(){return this.limitSet_},t.prototype.hasAnchoredLimit=function(){return this.limitSet_&&""!==this.viewFrom_},t.prototype.getLimit=function(){return h.assert(this.limitSet_,"Only valid if limit has been set"),this.limit_},t.prototype.getIndex=function(){return this.index_},t.prototype.copy_=function(){var e=new t;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e},t.prototype.limit=function(t){var e=this.copy_();return e.limitSet_=!0,e.limit_=t,e.viewFrom_="",e},t.prototype.limitToFirst=function(e){var i=this.copy_();return i.limitSet_=!0,i.limit_=e,i.viewFrom_=t.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT,i},t.prototype.limitToLast=function(e){var i=this.copy_();return i.limitSet_=!0,i.limit_=e,i.viewFrom_=t.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_RIGHT,i},t.prototype.startAt=function(t,e){var i=this.copy_();return i.startSet_=!0,void 0===t&&(t=null),i.indexStartValue_=t,null!=e?(i.startNameSet_=!0,i.indexStartName_=e):(i.startNameSet_=!1,i.indexStartName_=""),i},t.prototype.endAt=function(t,e){var i=this.copy_();return i.endSet_=!0,void 0===t&&(t=null),i.indexEndValue_=t,void 0!==e?(i.endNameSet_=!0,i.indexEndName_=e):(i.endNameSet_=!1,i.indexEndName_=""),i},t.prototype.orderBy=function(t){var e=this.copy_();return e.index_=t,e},t.prototype.getQueryObject=function(){var e=t.WIRE_PROTOCOL_CONSTANTS_,i={};if(this.startSet_&&(i[e.INDEX_START_VALUE]=this.indexStartValue_,this.startNameSet_&&(i[e.INDEX_START_NAME]=this.indexStartName_)),this.endSet_&&(i[e.INDEX_END_VALUE]=this.indexEndValue_,this.endNameSet_&&(i[e.INDEX_END_NAME]=this.indexEndName_)),this.limitSet_){i[e.LIMIT]=this.limit_;var n=this.viewFrom_;""===n&&(n=this.isViewFromLeft()?e.VIEW_FROM_LEFT:e.VIEW_FROM_RIGHT),i[e.VIEW_FROM]=n}return this.index_!==It&&(i[e.INDEX]=this.index_.toString()),i},t.prototype.loadsAllData=function(){return!(this.startSet_||this.endSet_||this.limitSet_)},t.prototype.isDefault=function(){return this.loadsAllData()&&this.index_===It},t.prototype.getNodeFilter=function(){return this.loadsAllData()?new fe(this.getIndex()):this.hasLimit()?new $e(this):new Ge(this)},t.prototype.toRestQueryStringParameters=function(){var e,i=t.REST_QUERY_CONSTANTS_,n={};return this.isDefault()?n:(this.index_===It?e=i.PRIORITY_INDEX:this.index_===qt?e=i.VALUE_INDEX:this.index_===wt?e=i.KEY_INDEX:(h.assert(this.index_ instanceof zt,"Unrecognized index type!"),e=this.index_.toString()),n[i.ORDER_BY]=h.stringify(e),this.startSet_&&(n[i.START_AT]=h.stringify(this.indexStartValue_),this.startNameSet_&&(n[i.START_AT]+=","+h.stringify(this.indexStartName_))),this.endSet_&&(n[i.END_AT]=h.stringify(this.indexEndValue_),this.endNameSet_&&(n[i.END_AT]+=","+h.stringify(this.indexEndName_))),this.limitSet_&&(this.isViewFromLeft()?n[i.LIMIT_TO_FIRST]=this.limit_:n[i.LIMIT_TO_LAST]=this.limit_),n)},t.WIRE_PROTOCOL_CONSTANTS_={INDEX_START_VALUE:"sp",INDEX_START_NAME:"sn",INDEX_END_VALUE:"ep",INDEX_END_NAME:"en",LIMIT:"l",VIEW_FROM:"vf",VIEW_FROM_LEFT:"l",VIEW_FROM_RIGHT:"r",INDEX:"i"},t.REST_QUERY_CONSTANTS_={ORDER_BY:"orderBy",PRIORITY_INDEX:"$priority",VALUE_INDEX:"$value",KEY_INDEX:"$key",START_AT:"startAt",END_AT:"endAt",LIMIT_TO_FIRST:"limitToFirst",LIMIT_TO_LAST:"limitToLast"},t.DEFAULT=new t,t}(),Ze=function(t){function e(e,i){if(!(e instanceof Ke))throw new Error("new Reference() no longer supported - use app.database().");return t.call(this,e,i,Je.DEFAULT,!1)||this}return a.__extends(e,t),e.prototype.getKey=function(){return h.validateArgCount("Reference.key",0,0,arguments.length),this.path.isEmpty()?null:this.path.getBack()},e.prototype.child=function(t){return h.validateArgCount("Reference.child",1,1,arguments.length),"number"==typeof t?t=String(t):t instanceof B||(null===this.path.getFront()?ut("Reference.child",1,t,!1):lt("Reference.child",1,t,!1)),new e(this.repo,this.path.child(t))},e.prototype.getParent=function(){h.validateArgCount("Reference.parent",0,0,arguments.length);var t=this.path.parent();return null===t?null:new e(this.repo,t)},e.prototype.getRoot=function(){h.validateArgCount("Reference.root",0,0,arguments.length);for(var t=this;null!==t.getParent();)t=t.getParent();return t},e.prototype.databaseProp=function(){return this.repo.database},e.prototype.set=function(t,e){h.validateArgCount("Reference.set",1,2,arguments.length),ct("Reference.set",this.path),nt("Reference.set",1,t,this.path,!1),h.validateCallback("Reference.set",2,e,!0);var i=new h.Deferred;return this.repo.setWithPriority(this.path,t,null,i.wrapCallback(e)),i.promise},e.prototype.update=function(t,e){if(h.validateArgCount("Reference.update",1,2,arguments.length),ct("Reference.update",this.path),Array.isArray(t)){for(var i={},n=0;n<t.length;++n)i[""+n]=t[n];t=i,k("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}ot("Reference.update",1,t,this.path,!1),h.validateCallback("Reference.update",2,e,!0);var r=new h.Deferred;return this.repo.update(this.path,t,r.wrapCallback(e)),r.promise},e.prototype.setWithPriority=function(t,e,i){if(h.validateArgCount("Reference.setWithPriority",2,3,arguments.length),ct("Reference.setWithPriority",this.path),nt("Reference.setWithPriority",1,t,this.path,!1),st("Reference.setWithPriority",2,e,!1),h.validateCallback("Reference.setWithPriority",3,i,!0),".length"===this.getKey()||".keys"===this.getKey())throw"Reference.setWithPriority failed: "+this.getKey()+" is a read-only object.";var n=new h.Deferred;return this.repo.setWithPriority(this.path,t,e,n.wrapCallback(i)),n.promise},e.prototype.remove=function(t){return h.validateArgCount("Reference.remove",0,1,arguments.length),ct("Reference.remove",this.path),h.validateCallback("Reference.remove",1,t,!0),this.set(null,t)},e.prototype.transaction=function(t,e,i){if(h.validateArgCount("Reference.transaction",1,3,arguments.length),ct("Reference.transaction",this.path),h.validateCallback("Reference.transaction",1,t,!1),h.validateCallback("Reference.transaction",2,e,!0),pt("Reference.transaction",3,i,!0),".length"===this.getKey()||".keys"===this.getKey())throw"Reference.transaction failed: "+this.getKey()+" is a read-only object.";void 0===i&&(i=!0);var n=new h.Deferred;"function"==typeof e&&n.promise.catch((function(){}));var r=function(t,i,r){t?n.reject(t):n.resolve(new yt(i,r)),"function"==typeof e&&e(t,i,r)};return this.repo.startTransaction(this.path,t,r,i),n.promise},e.prototype.setPriority=function(t,e){h.validateArgCount("Reference.setPriority",1,2,arguments.length),ct("Reference.setPriority",this.path),st("Reference.setPriority",1,t,!1),h.validateCallback("Reference.setPriority",2,e,!0);var i=new h.Deferred;return this.repo.setWithPriority(this.path.child(".priority"),t,null,i.wrapCallback(e)),i.promise},e.prototype.push=function(t,e){h.validateArgCount("Reference.push",0,2,arguments.length),ct("Reference.push",this.path),nt("Reference.push",1,t,this.path,!0),h.validateCallback("Reference.push",2,e,!0);var i,n=this.repo.serverTime(),r=mt(n),o=this.child(r),s=this.child(r);return i=null!=t?o.set(t,e).then((function(){return s})):Promise.resolve(s),o.then=i.then.bind(i),o.catch=i.then.bind(i,void 0),"function"==typeof e&&i.catch((function(){})),o},e.prototype.onDisconnect=function(){return ct("Reference.onDisconnect",this.path),new ft(this.repo,this.path)},Object.defineProperty(e.prototype,"database",{get:function(){return this.databaseProp()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"key",{get:function(){return this.getKey()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return this.getParent()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return this.getRoot()},enumerable:!0,configurable:!0}),e}(Zt);
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Zt.__referenceConstructor=Ze,Se.__referenceConstructor=Ze;
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var ti,ei=function(){this.children={},this.childCount=0,this.value=null},ii=function(){function t(t,e,i){void 0===t&&(t=""),void 0===e&&(e=null),void 0===i&&(i=new ei),this.name_=t,this.parent_=e,this.node_=i}return t.prototype.subTree=function(e){for(var i=e instanceof B?e:new B(e),n=this,r=i.getFront();null!==r;){n=new t(r,n,h.safeGet(n.node_.children,r)||new ei),r=(i=i.popFront()).getFront()}return n},t.prototype.getValue=function(){return this.node_.value},t.prototype.setValue=function(t){h.assert(void 0!==t,"Cannot set value to undefined"),this.node_.value=t,this.updateParents_()},t.prototype.clear=function(){this.node_.value=null,this.node_.children={},this.node_.childCount=0,this.updateParents_()},t.prototype.hasChildren=function(){return this.node_.childCount>0},t.prototype.isEmpty=function(){return null===this.getValue()&&!this.hasChildren()},t.prototype.forEachChild=function(e){var i=this;L(this.node_.children,(function(n,r){e(new t(n,i,r))}))},t.prototype.forEachDescendant=function(t,e,i){e&&!i&&t(this),this.forEachChild((function(e){e.forEachDescendant(t,!0,i)})),e&&i&&t(this)},t.prototype.forEachAncestor=function(t,e){for(var i=e?this:this.parent();null!==i;){if(t(i))return!0;i=i.parent()}return!1},t.prototype.forEachImmediateDescendantWithValue=function(t){this.forEachChild((function(e){null!==e.getValue()?t(e):e.forEachImmediateDescendantWithValue(t)}))},t.prototype.path=function(){return new B(null===this.parent_?this.name_:this.parent_.path()+"/"+this.name_)},t.prototype.name=function(){return this.name_},t.prototype.parent=function(){return this.parent_},t.prototype.updateParents_=function(){null!==this.parent_&&this.parent_.updateChild_(this.name_,this)},t.prototype.updateChild_=function(t,e){var i=e.isEmpty(),n=h.contains(this.node_.children,t);i&&n?(delete this.node_.children[t],this.node_.childCount--,this.updateParents_()):i||n||(this.node_.children[t]=e.node_,this.node_.childCount++,this.updateParents_())},t}();!function(t){t[t.RUN=0]="RUN",t[t.SENT=1]="SENT",t[t.COMPLETED=2]="COMPLETED",t[t.SENT_NEEDS_ABORT=3]="SENT_NEEDS_ABORT",t[t.NEEDS_ABORT=4]="NEEDS_ABORT"}(ti||(ti={})),Ke.MAX_TRANSACTION_RETRIES_=25,Ke.prototype.transactionsInit_=function(){this.transactionQueueTree_=new ii},Ke.prototype.startTransaction=function(t,e,i,n){this.log_("transaction on "+t);var r=function(){},o=new Ze(this,t);o.on("value",r);var s={path:t,update:e,onComplete:i,status:null,order:v(),applyLocally:n,retryCount:0,unwatcher:function(){o.off("value",r)},abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},a=this.getLatestState_(t);s.currentInputSnapshot=a;var l=s.update(a.val());if(void 0===l){if(s.unwatcher(),s.currentOutputSnapshotRaw=null,s.currentOutputSnapshotResolved=null,s.onComplete){var u=new Qt(s.currentInputSnapshot,new Ze(this,s.path),It);s.onComplete(null,!1,u)}}else{rt("transaction failed: Data returned ",l,s.path),s.status=ti.RUN;var c=this.transactionQueueTree_.subTree(t),d=c.getValue()||[];d.push(s),c.setValue(d);var p=void 0;if("object"==typeof l&&null!==l&&h.contains(l,".priority"))p=h.safeGet(l,".priority"),h.assert(it(p),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.");else p=(this.serverSyncTree_.calcCompleteEventCache(t)||Yt.EMPTY_NODE).getPriority().val();p=p;var f=this.generateServerValues(),y=Ut(l,p),m=ie(y,f);s.currentOutputSnapshotRaw=y,s.currentOutputSnapshotResolved=m,s.currentWriteId=this.getNextWriteId_();var g=this.serverSyncTree_.applyUserOverwrite(t,m,s.currentWriteId,s.applyLocally);this.eventQueue_.raiseEventsForChangedPath(t,g),this.sendReadyTransactions_()}},Ke.prototype.getLatestState_=function(t,e){return this.serverSyncTree_.calcCompleteEventCache(t,e)||Yt.EMPTY_NODE},Ke.prototype.sendReadyTransactions_=function(t){var e=this;if(void 0===t&&(t=this.transactionQueueTree_),t||this.pruneCompletedTransactionsBelowNode_(t),null!==t.getValue()){var i=this.buildTransactionQueue_(t);h.assert(i.length>0,"Sending zero length transaction queue"),i.every((function(t){return t.status===ti.RUN}))&&this.sendTransactionQueue_(t.path(),i)}else t.hasChildren()&&t.forEachChild((function(t){e.sendReadyTransactions_(t)}))},Ke.prototype.sendTransactionQueue_=function(t,e){for(var i=this,n=e.map((function(t){return t.currentWriteId})),r=this.getLatestState_(t,n),o=r,s=r.hash(),a=0;a<e.length;a++){var l=e[a];h.assert(l.status===ti.RUN,"tryToSendTransactionQueue_: items in queue should all be run."),l.status=ti.SENT,l.retryCount++;var u=B.relativePath(t,l.path);o=o.updateChild(u,l.currentOutputSnapshotRaw)}var c=o.val(!0),d=t;this.server_.put(d.toString(),c,(function(n){i.log_("transaction put response",{path:d.toString(),status:n});var r=[];if("ok"===n){for(var o=[],s=0;s<e.length;s++){if(e[s].status=ti.COMPLETED,r=r.concat(i.serverSyncTree_.ackUserWrite(e[s].currentWriteId)),e[s].onComplete){var a=e[s].currentOutputSnapshotResolved,h=new Ze(i,e[s].path),l=new Qt(a,h,It);o.push(e[s].onComplete.bind(null,null,!0,l))}e[s].unwatcher()}i.pruneCompletedTransactionsBelowNode_(i.transactionQueueTree_.subTree(t)),i.sendReadyTransactions_(),i.eventQueue_.raiseEventsForChangedPath(t,r);for(s=0;s<o.length;s++)H(o[s])}else{if("datastale"===n)for(s=0;s<e.length;s++)e[s].status===ti.SENT_NEEDS_ABORT?e[s].status=ti.NEEDS_ABORT:e[s].status=ti.RUN;else{k("transaction at "+d.toString()+" failed: "+n);for(s=0;s<e.length;s++)e[s].status=ti.NEEDS_ABORT,e[s].abortReason=n}i.rerunTransactions_(t)}}),s)},Ke.prototype.rerunTransactions_=function(t){var e=this.getAncestorTransactionNode_(t),i=e.path(),n=this.buildTransactionQueue_(e);return this.rerunTransactionQueue_(n,i),i},Ke.prototype.rerunTransactionQueue_=function(t,e){if(0!==t.length){for(var i,n=[],r=[],o=t.filter((function(t){return t.status===ti.RUN})).map((function(t){return t.currentWriteId})),s=0;s<t.length;s++){var a=t[s],l=B.relativePath(e,a.path),u=!1,c=void 0;if(h.assert(null!==l,"rerunTransactionsUnderNode_: relativePath should not be null."),a.status===ti.NEEDS_ABORT)u=!0,c=a.abortReason,r=r.concat(this.serverSyncTree_.ackUserWrite(a.currentWriteId,!0));else if(a.status===ti.RUN)if(a.retryCount>=Ke.MAX_TRANSACTION_RETRIES_)u=!0,c="maxretry",r=r.concat(this.serverSyncTree_.ackUserWrite(a.currentWriteId,!0));else{var d=this.getLatestState_(a.path,o);a.currentInputSnapshot=d;var p=t[s].update(d.val());if(void 0!==p){rt("transaction failed: Data returned ",p,a.path);var f=Ut(p);"object"==typeof p&&null!=p&&h.contains(p,".priority")||(f=f.updatePriority(d.getPriority()));var y=a.currentWriteId,m=this.generateServerValues(),v=ie(f,m);a.currentOutputSnapshotRaw=f,a.currentOutputSnapshotResolved=v,a.currentWriteId=this.getNextWriteId_(),o.splice(o.indexOf(y),1),r=(r=r.concat(this.serverSyncTree_.applyUserOverwrite(a.path,v,a.currentWriteId,a.applyLocally))).concat(this.serverSyncTree_.ackUserWrite(y,!0))}else u=!0,c="nodata",r=r.concat(this.serverSyncTree_.ackUserWrite(a.currentWriteId,!0))}if(this.eventQueue_.raiseEventsForChangedPath(e,r),r=[],u&&(t[s].status=ti.COMPLETED,i=t[s].unwatcher,setTimeout(i,Math.floor(0)),t[s].onComplete))if("nodata"===c){var g=new Ze(this,t[s].path),_=t[s].currentInputSnapshot,w=new Qt(_,g,It);n.push(t[s].onComplete.bind(null,null,!1,w))}else n.push(t[s].onComplete.bind(null,new Error(c),!1,null))}this.pruneCompletedTransactionsBelowNode_(this.transactionQueueTree_);for(s=0;s<n.length;s++)H(n[s]);this.sendReadyTransactions_()}},Ke.prototype.getAncestorTransactionNode_=function(t){var e,i=this.transactionQueueTree_;for(e=t.getFront();null!==e&&null===i.getValue();)i=i.subTree(e),e=(t=t.popFront()).getFront();return i},Ke.prototype.buildTransactionQueue_=function(t){var e=[];return this.aggregateTransactionQueuesForNode_(t,e),e.sort((function(t,e){return t.order-e.order})),e},Ke.prototype.aggregateTransactionQueuesForNode_=function(t,e){var i=this,n=t.getValue();if(null!==n)for(var r=0;r<n.length;r++)e.push(n[r]);t.forEachChild((function(t){i.aggregateTransactionQueuesForNode_(t,e)}))},Ke.prototype.pruneCompletedTransactionsBelowNode_=function(t){var e=this,i=t.getValue();if(i){for(var n=0,r=0;r<i.length;r++)i[r].status!==ti.COMPLETED&&(i[n]=i[r],n++);i.length=n,t.setValue(i.length>0?i:null)}t.forEachChild((function(t){e.pruneCompletedTransactionsBelowNode_(t)}))},Ke.prototype.abortTransactions_=function(t){var e=this,i=this.getAncestorTransactionNode_(t).path(),n=this.transactionQueueTree_.subTree(t);return n.forEachAncestor((function(t){e.abortTransactionsOnNode_(t)})),this.abortTransactionsOnNode_(n),n.forEachDescendant((function(t){e.abortTransactionsOnNode_(t)})),i},Ke.prototype.abortTransactionsOnNode_=function(t){var e=t.getValue();if(null!==e){for(var i=[],n=[],r=-1,o=0;o<e.length;o++)if(e[o].status===ti.SENT_NEEDS_ABORT);else if(e[o].status===ti.SENT)h.assert(r===o-1,"All SENT items should be at beginning of queue."),r=o,e[o].status=ti.SENT_NEEDS_ABORT,e[o].abortReason="set";else if(h.assert(e[o].status===ti.RUN,"Unexpected transaction status in abort"),e[o].unwatcher(),n=n.concat(this.serverSyncTree_.ackUserWrite(e[o].currentWriteId,!0)),e[o].onComplete){i.push(e[o].onComplete.bind(null,new Error("set"),!1,null))}-1===r?t.setValue(null):e.length=r+1,this.eventQueue_.raiseEventsForChangedPath(t.path(),n);for(o=0;o<i.length;o++)H(i[o])}};
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ni,ri=function(){function t(){this.repos_={},this.useRestClient_=!1}return t.getInstance=function(){return ni||(ni=new t),ni},t.prototype.interrupt=function(){var t,e,i,n;try{for(var r=a.__values(Object.keys(this.repos_)),o=r.next();!o.done;o=r.next()){var s=o.value;try{for(var h=(i=void 0,a.__values(Object.keys(this.repos_[s]))),l=h.next();!l.done;l=h.next()){var u=l.value;this.repos_[s][u].interrupt()}}catch(t){i={error:t}}finally{try{l&&!l.done&&(n=h.return)&&n.call(h)}finally{if(i)throw i.error}}}}catch(e){t={error:e}}finally{try{o&&!o.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}},t.prototype.resume=function(){var t,e,i,n;try{for(var r=a.__values(Object.keys(this.repos_)),o=r.next();!o.done;o=r.next()){var s=o.value;try{for(var h=(i=void 0,a.__values(Object.keys(this.repos_[s]))),l=h.next();!l.done;l=h.next()){var u=l.value;this.repos_[s][u].resume()}}catch(t){i={error:t}}finally{try{l&&!l.done&&(n=h.return)&&n.call(h)}finally{if(i)throw i.error}}}}catch(e){t={error:e}}finally{try{o&&!o.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}},t.prototype.databaseFromApp=function(t,e,i){var r=i||t.options.databaseURL;void 0===r&&P("Can't determine Firebase Database URL.  Be sure to include databaseURL option when calling firebase.initializeApp().");var o=G(r),s=o.repoInfo,a=void 0;return void 0!==n&&(a=n.env.FIREBASE_DATABASE_EMULATOR_HOST),a&&(r="http://"+a+"?ns="+s.namespace,s=(o=G(r)).repoInfo),dt("Invalid Firebase Database URL",1,o),o.path.isEmpty()||P("Database URL must point to the root of a Firebase Database (not including a child path)."),this.createRepo(s,t,e).database},t.prototype.deleteRepo=function(t){var e=h.safeGet(this.repos_,t.app.name);e&&h.safeGet(e,t.repoInfo_.toURLString())===t||P("Database "+t.app.name+"("+t.repoInfo_+") has already been deleted."),t.interrupt(),delete e[t.repoInfo_.toURLString()]},t.prototype.createRepo=function(t,e,i){var n=h.safeGet(this.repos_,e.name);n||(n={},this.repos_[e.name]=n);var r=h.safeGet(n,t.toURLString());return r&&P("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),r=new Ke(t,this.useRestClient_,e,i),n[t.toURLString()]=r,r},t.prototype.forceRestClient=function(t){this.useRestClient_=t},t}(),oi=function(){function t(t){this.repo_=t,t instanceof Ke||P("Don't call new Database() directly - please use firebase.database()."),this.root_=new Ze(t,B.Empty),this.INTERNAL=new si(this)}return Object.defineProperty(t.prototype,"app",{get:function(){return this.repo_.app},enumerable:!0,configurable:!0}),t.prototype.ref=function(t){return this.checkDeleted_("ref"),h.validateArgCount("database.ref",0,1,arguments.length),t instanceof Ze?this.refFromURL(t.toString()):void 0!==t?this.root_.child(t):this.root_},t.prototype.refFromURL=function(t){var e="database.refFromURL";this.checkDeleted_(e),h.validateArgCount(e,1,1,arguments.length);var i=G(t);dt(e,1,i);var n=i.repoInfo;return n.host!==this.repo_.repoInfo_.host&&P(e+": Host name does not match the current database: (found "+n.host+" but expected "+this.repo_.repoInfo_.host+")"),this.ref(i.path.toString())},t.prototype.checkDeleted_=function(t){null===this.repo_&&P("Cannot call "+t+" on a deleted database.")},t.prototype.goOffline=function(){h.validateArgCount("database.goOffline",0,0,arguments.length),this.checkDeleted_("goOffline"),this.repo_.interrupt()},t.prototype.goOnline=function(){h.validateArgCount("database.goOnline",0,0,arguments.length),this.checkDeleted_("goOnline"),this.repo_.resume()},t.ServerValue={TIMESTAMP:{".sv":"timestamp"}},t}(),si=function(){function t(t){this.database=t}return t.prototype.delete=function(){return a.__awaiter(this,void 0,void 0,(function(){return a.__generator(this,(function(t){return this.database.checkDeleted_("delete"),ri.getInstance().deleteRepo(this.database.repo_),this.database.repo_=null,this.database.root_=null,this.database.INTERNAL=null,this.database=null,[2]}))}))},t}(),ai=Object.freeze({__proto__:null,forceLongPolling:function(){Ue.forceDisallow(),We.forceAllow()},forceWebSockets:function(){We.forceDisallow()},isWebSocketsAvailable:function(){return Ue.isAvailable()},setSecurityDebugCallback:function(t,e){t.repo.persistentConnection_.securityDebugCallback_=e},stats:function(t,e){t.repo.stats(e)},statsIncrementCounter:function(t,e){t.repo.statsIncrementCounter(e)},dataUpdateCount:function(t){return t.repo.dataUpdateCount},interceptServerData:function(t,e){return t.repo.interceptServerData_(e)}}),hi=ze;ze.prototype.simpleListen=function(t,e){this.sendRequest("q",{p:t},e)},ze.prototype.echo=function(t,e){this.sendRequest("echo",{d:t},e)};var li=Ve,ui=X,ci=Object.freeze({__proto__:null,DataConnection:hi,RealTimeConnection:li,hijackHash:function(t){var e=ze.prototype.put;return ze.prototype.put=function(i,n,r,o){void 0!==o&&(o=t()),e.call(this,i,n,r,o)},function(){ze.prototype.put=e}},ConnectionTarget:ui,queryIdentifier:function(t){return t.queryIdentifier()},forceRestClient:function(t){ri.getInstance().forceRestClient(t)}}),di=oi.ServerValue;function pi(e){!function(t){Ye=t}(e.SDK_VERSION);var i=e.INTERNAL.registerComponent(new u.Component("database",(function(t,e){var i=t.getProvider("app").getImmediate(),n=t.getProvider("auth-internal");return ri.getInstance().databaseFromApp(i,n,e)}),"PUBLIC").setServiceProps({Reference:Ze,Query:Zt,Database:oi,DataSnapshot:Qt,enableLogging:S,INTERNAL:ai,ServerValue:di,TEST_ACCESS:ci}).setMultipleInstances(!0));e.registerVersion("@firebase/database","0.5.19"),h.isNodeSdk()&&(t.exports=i)}pi(s),e.DataSnapshot=Qt,e.Database=oi,e.OnDisconnect=ft,e.Query=Zt,e.Reference=Ze,e.ServerValue=di,e.enableLogging=S,e.registerDatabase=pi}).call(this,i(9))},function(t,e){var i,n,r=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(t){if(i===setTimeout)return setTimeout(t,0);if((i===o||!i)&&setTimeout)return i=setTimeout,setTimeout(t,0);try{return i(t,0)}catch(e){try{return i.call(null,t,0)}catch(e){return i.call(this,t,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:o}catch(t){i=o}try{n="function"==typeof clearTimeout?clearTimeout:s}catch(t){n=s}}();var h,l=[],u=!1,c=-1;function d(){u&&h&&(u=!1,h.length?l=h.concat(l):c=-1,l.length&&p())}function p(){if(!u){var t=a(d);u=!0;for(var e=l.length;e;){for(h=l,l=[];++c<e;)h&&h[c].run();c=-1,e=l.length}h=null,u=!1,function(t){if(n===clearTimeout)return clearTimeout(t);if((n===s||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(t);try{n(t)}catch(e){try{return n.call(null,t)}catch(e){return n.call(this,t)}}}(t)}}function f(t,e){this.fun=t,this.array=e}function y(){}r.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];l.push(new f(t,e)),1!==l.length||u||a(p)},f.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=y,r.addListener=y,r.once=y,r.off=y,r.removeListener=y,r.removeAllListeners=y,r.emit=y,r.prependListener=y,r.prependOnceListener=y,r.listeners=function(t){return[]},r.binding=function(t){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(t){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},function(t,e,i){"use strict";i.r(e);i(6);var n={apiKey:"AIzaSyBITgmlq4O_2oZTb0-g1BLMyvYU8KMI5jI",authDomain:"fire-girl-23804.firebaseapp.com",databaseURL:"https://fire-girl-23804.firebaseio.com",projectId:"fire-girl-23804",storageBucket:"fire-girl-23804.appspot.com",messagingSenderId:"170252837695",appId:"1:170252837695:web:5200d0ed2fb3956bfd298a",measurementId:"G-M4G62L8KW1"},r=i(1),o=i.n(r);i(8);function s(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var a=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.music=document.createElement("audio"),this.name=e.name||"",this.artist=e.artist||"",this.loop=e.loop||!0,this.music.src=e.src,this.music.volume=e.volume||1,this.music.id="theme",this.music.setAttribute("preload","auto"),this.music.setAttribute("controls","none"),this.music.setAttribute("loop","".concat(this.loop)),this.music.setAttribute("muted","false"),this.music.style.display="none",this.play=this.play.bind(this),this.pause=this.pause.bind(this),this.mute=this.mute.bind(this)}var e,i,n;return e=t,(i=[{key:"play",value:function(){this.music.play()}},{key:"pause",value:function(){this.music.pause()}},{key:"mute",value:function(){this.music.muted=!this.music.muted}}])&&s(e.prototype,i),n&&s(e,n),t}();function h(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var l=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.name=e.name,this.pos=e.pos,this.ctx=e.ctx,this.canvas=e.canvas,this.width=e.width,this.height=e.height,this.x=e.pos[0],this.y=e.pos[1],this.oldX=this.x,this.oldY=this.y,this.tileSize=60,this.rightSide=this.rightSide.bind(this),this.leftSide=this.leftSide.bind(this),this.topSide=this.topSide.bind(this),this.bottomSide=this.bottomSide.bind(this),this.getTopLeftPos=this.getTopLeftPos.bind(this),this.getTopRightPos=this.getTopRightPos.bind(this),this.getBottomLeftPos=this.getBottomLeftPos.bind(this),this.getBottomRightPos=this.getBottomRightPos.bind(this)}var e,i,n;return e=t,(i=[{key:"rightSide",value:function(){return this.x+this.width}},{key:"leftSide",value:function(){return this.x}},{key:"topSide",value:function(){return this.y}},{key:"bottomSide",value:function(){return this.y+this.height}},{key:"getTopLeftPos",value:function(){return[Math.floor(this.leftSide()/this.tileSize),Math.floor(this.topSide()/this.tileSize)]}},{key:"getTopRightPos",value:function(){return[Math.floor(this.rightSide()/this.tileSize),Math.floor(this.topSide()/this.tileSize)]}},{key:"getBottomLeftPos",value:function(){return[Math.floor(this.leftSide()/this.tileSize),Math.floor(this.bottomSide()/this.tileSize)]}},{key:"getBottomRightPos",value:function(){return[Math.floor(this.rightSide()/this.tileSize),Math.floor(this.bottomSide()/this.tileSize)]}}])&&h(e.prototype,i),n&&h(e,n),t}();function u(t){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function c(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function d(t,e){return!e||"object"!==u(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function p(t){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function f(t,e){return(f=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var y=function(t){function e(t){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(i=d(this,p(e).call(this,{name:t.name,pos:t.pos,ctx:t.ctx,width:t.width,height:t.height}))).vel=[0,0],i.health=200,i}var i,n,r;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&f(t,e)}(e,t),i=e,(n=[{key:"loadImage",value:function(){var t=new Image;return t.src="./assets/SeisaSpriteSheet.png",t}}])&&c(i.prototype,n),r&&c(i,r),e}(l);function m(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var v=1,g=function(){function t(e,i,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.ctx=e,this.canvas=i,this.character=new y({name:"Seisa",pos:n,ctx:this.ctx,canvas:this.canvas,width:42.5,height:82}),this.health=this.character.health,this.damageMeter=0,this.damageBoost=!1,this.shield=!1,this.superShield=!1,this.spriteMap=this.character.loadImage(),this.fireballs={},this.vel=this.character.vel,this.x=this.character.x,this.y=this.character.y,this.idleWidth=42.5,this.runWidth=57,this.oldX=this.x,this.oldY=this.y,this.width=this.character.width,this.height=this.character.height,this.velX=this.vel[0],this.velY=this.vel[1],this.onGround=!1,this.idle=!0,this.keydown=!1,this.jumpKey=!1,this.runningKeyDown=!1,this.isRunning=!1,this.crouch=!1,this.direction="right",this.jumpCount=2,this.canClimb=!1,this.climbing=!1,this.frameCount=0,this.attacking=!1,this.downKey=!1,this.aura=this.loadImage("./assets/aura.png"),this.shieldImg=this.loadImage("./assets/shield_aura.png"),this.superShieldImg=this.loadImage("./assets/shield_aura2.png"),this.upPressed=!1,this.attackAnimTimeout="",this.dashing=!1,this.isHit=!1,this.dying=!1,this.dead=!1,this.drawPlayer=this.drawPlayer.bind(this),this.jump=this.jump.bind(this),this.shootFire=this.shootFire.bind(this),this.blueFire=this.blueFire.bind(this),this.fire=this.fire.bind(this),this.drawAttack=this.drawAttack.bind(this),this.drawRunning=this.drawRunning.bind(this),this.drawIdle=this.drawIdle.bind(this),this.drawSprite=this.drawSprite.bind(this),this.drawJump=this.drawJump.bind(this),this.loadImage=this.loadImage.bind(this),this.setOldPos=this.setOldPos.bind(this),this.inAir=this.inAir.bind(this),this.isIdle=this.isIdle.bind(this),this.whichDirection=this.whichDirection.bind(this),this.setRunning=this.setRunning.bind(this),this.setHit=this.setHit.bind(this),this.setDamageMeter=this.setDamageMeter.bind(this),this.damageBoostCountdown=this.damageBoostCountdown.bind(this),this.setShieldTimeOut=this.setShieldTimeOut.bind(this),this.setShield=this.setShield.bind(this),this.setDying=this.setDying.bind(this),this.isClimbing=this.isClimbing.bind(this),this.rightSide=this.rightSide.bind(this),this.leftSide=this.leftSide.bind(this),this.topSide=this.topSide.bind(this),this.bottomSide=this.bottomSide.bind(this),this.midX=this.midX.bind(this),this.setCrouch=this.setCrouch.bind(this),this.getDirX=this.getDirX.bind(this),this.getDirY=this.getDirY.bind(this)}var e,i,n;return e=t,(i=[{key:"loadImage",value:function(t){var e=new Image;return e.src=t,e}},{key:"rightSide",value:function(){return this.x+this.width}},{key:"leftSide",value:function(){return this.x}},{key:"topSide",value:function(){return this.crouch?this.y+32.5:this.y}},{key:"bottomSide",value:function(){return this.y+this.height}},{key:"midX",value:function(){return this.x+this.width/2}},{key:"drawPlayer",value:function(t){this.setDying(),this.isHit&&t%3==0||(this.climbing?this.ctx.drawImage(this.spriteMap,Math.floor(t/5)%2*85+355,932,85,198,this.x,this.y-this.height/9,this.width,this.height):0===this.velX?"right"===this.direction?this.ctx.drawImage(this.spriteMap,0,529,89,175,this.x,this.y,this.width,this.height):(this.ctx.scale(-1,1),this.ctx.drawImage(this.spriteMap,0,529,89,175,-this.x-this.width,this.y,this.width,this.height),this.ctx.scale(-1,1)):this.velX>0?this.ctx.drawImage(this.spriteMap,Math.floor(t/2)%12*126.25+1,0,126.25,175,this.x,this.y,this.width+5,this.height):this.velX<0&&(this.ctx.scale(-1,1),this.ctx.drawImage(this.spriteMap,Math.floor(t/2)%12*126.25+1,0,126.25,175,-this.x-this.width,this.y,this.width+5,this.height),this.ctx.scale(-1,1)))}},{key:"drawRunning",value:function(t){"right"===this.direction?this.ctx.drawImage(this.spriteMap,Math.floor(t/2)%12*126.4+1,0,126.4,175,this.x,this.y,this.width+5,this.height):(this.ctx.scale(-1,1),this.ctx.drawImage(this.spriteMap,Math.floor(t/2)%12*126.4+1,0,126.4,175,-this.x-this.width,this.y,this.width+5,this.height),this.ctx.scale(-1,1))}},{key:"drawAttack",value:function(t,e){switch(e){case"jumping":this.downKey&&0!==this.velY?"right"===this.direction?this.ctx.drawImage(this.spriteMap,Math.floor(t/2)%3*123,1701,123,172,this.x,this.y,this.width+7,this.height):(this.ctx.scale(-1,1),this.ctx.drawImage(this.spriteMap,Math.floor(t/2)%3*123,1701,123,172,-this.x-this.width,this.y,this.width+7,this.height),this.ctx.scale(-1,1)):this.velY<0?"right"===this.direction?this.ctx.drawImage(this.spriteMap,Math.floor(t/2)%3*108,1145,108,172,this.x,this.y,this.width+5,this.height):(this.ctx.scale(-1,1),this.ctx.drawImage(this.spriteMap,Math.floor(t/2)%3*108,1145,108,172,-this.x-this.width,this.y,this.width+5,this.height),this.ctx.scale(-1,1)):this.velY>0&&("right"===this.direction?this.ctx.drawImage(this.spriteMap,Math.floor(t/2)%3*108,1510,108,175,this.x,this.y,this.width,this.height):(this.ctx.scale(-1,1),this.ctx.drawImage(this.spriteMap,Math.floor(t/2)%3*108,1510,108,175,-this.x-this.width,this.y,this.width,this.height),this.ctx.scale(-1,1)));break;case"running":"right"===this.direction?this.upPressed?this.ctx.drawImage(this.spriteMap,Math.floor(t/2)%12*125,1915,125,195,this.x,this.y-this.height/10,this.width,1.1*this.height):this.ctx.drawImage(this.spriteMap,Math.floor(t/2)%12*160,176,160,175,this.x,this.y,this.width+this.width/3,this.height):"left"===this.direction&&(this.ctx.scale(-1,1),this.upPressed?this.ctx.drawImage(this.spriteMap,Math.floor(t/2)%12*125,1915,125,195,-this.x-this.width,this.y-this.height/10,this.width,1.1*this.height):this.ctx.drawImage(this.spriteMap,Math.floor(t/2)%12*160,176,160,175,-this.x-this.width,this.y,this.width+this.width/3,this.height),this.ctx.scale(-1,1));break;default:"right"===this.direction?this.upPressed?this.ctx.drawImage(this.spriteMap,Math.floor(t/2)%4*89,730,89,195,this.x,this.y-this.height/10,this.width,1.1*this.height):this.ctx.drawImage(this.spriteMap,Math.floor(t/2)%4*125.1,353,123.25,175,this.x,this.y,this.width+this.width/2.5,this.height):"left"===this.direction&&(this.ctx.scale(-1,1),this.upPressed?this.ctx.drawImage(this.spriteMap,Math.floor(t/2)%4*89,730,89,195,-this.x-this.width,this.y-this.height/10,this.width,1.1*this.height):this.ctx.drawImage(this.spriteMap,Math.floor(t/2)%4*125.1,353,123.25,175,-this.x-this.width,this.y,this.width+this.width/2.5,this.height),this.ctx.scale(-1,1))}}},{key:"drawJump",value:function(t){!this.onGround&&this.velY<0?"right"===this.direction?this.ctx.drawImage(this.spriteMap,Math.floor(t/2)%3*94,959,94,176,this.x,this.y,this.width-this.width/8,this.height):(this.ctx.scale(-1,1),this.ctx.drawImage(this.spriteMap,Math.floor(t/2)%3*94,959,94,176,-this.x-this.width,this.y,this.width-this.width/8,this.height),this.ctx.scale(-1,1)):!this.onGround&&this.velY>8?"right"===this.direction?this.ctx.drawImage(this.spriteMap,Math.floor(t/2)%2*98,1325,98,175,this.x,this.y,this.width,this.height):(this.ctx.scale(-1,1),this.ctx.drawImage(this.spriteMap,Math.floor(t/2)%2*98,1325,98,175,-this.x-this.width,this.y,this.width,this.height),this.ctx.scale(-1,1)):!this.onGround&&this.velY>=0&&this.velY<=8&&this.drawRunning(t)}},{key:"drawIdle",value:function(t){this.crouch?"right"===this.direction?this.ctx.drawImage(this.spriteMap,535,352,112,175,this.x,this.y,this.width+7,this.height):(this.ctx.scale(-1,1),this.ctx.drawImage(this.spriteMap,535,352,112,175,-this.x-this.width,this.y,this.width+7,this.height),this.ctx.scale(-1,1)):"right"===this.direction?this.ctx.drawImage(this.spriteMap,0,529,89,175,this.x,this.y,this.width,this.height):(this.ctx.scale(-1,1),this.ctx.drawImage(this.spriteMap,0,529,89,175,-this.x-this.width,this.y,this.width,this.height),this.ctx.scale(-1,1))}},{key:"drawSprite",value:function(t){if(this.setDying(),this.damageBoost&&this.ctx.drawImage(this.aura,Math.floor(t/3)%4*82,0,82,93,this.x-28,this.y-42,100,130),!this.isHit||t%3!=0)if(this.climbing){var e=0!==this.velY?Math.floor(t/5)%2*85:0;this.ctx.drawImage(this.spriteMap,e+355,932,85,198,this.x,this.y-this.height/9,.95*this.width,this.height)}else if(this.velY>=0&&this.velY<=1?this.isRunning?this.attacking?this.drawAttack(t,"running"):this.drawRunning(t):this.attacking?this.drawAttack(t,null):this.drawIdle(t):this.onGround||(this.attacking?this.drawAttack(t,"jumping"):this.drawJump(t)),this.damageBoost&&this.ctx.drawImage(this.aura,Math.floor(t/3)%4*82,0,82,93,this.x-28,this.y-42,100,130),this.shield||this.superShield){var i=this.superShield?this.superShieldImg:this.shieldImg,n=Math.floor(t/3)%11;this.ctx.drawImage(i,145.75*n+46.5*n+22,0,145.75,143,this.x-12,this.y-10,85,100)}}},{key:"shootFire",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.damageBoost?this.blueFire(t):this.fire(t)}},{key:"blueFire",value:function(){for(var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=null,n=1;n<=Object.keys(this.fireballs).length;n++)if(!this.fireballs[n]){i=n;break}i=i||Object.keys(this.fireballs).length+1,clearTimeout(this.attackAnimTimeout),this.attacking=!0,this.attackAnimTimeout=setTimeout((function(){t.attacking=!1,t.downKey=!1}),200),"right"===this.direction?"up"===e?this.fireballs[i]=new I(I.blueFireballVert([this.rightSide()-this.width/2,this.y+this.height],0,-30,e)):"down"===e?(this.fireballs[i]=new I(I.blueFireballVert([this.rightSide()-this.width/2,this.bottomSide()-this.height],0,30,e)),this.velY=-2):this.fireballs[i]=new I(I.blueFireball([this.rightSide()-this.width/10,this.topSide()+this.height/5],30,0,"right")):"left"===this.direction&&("up"===e?this.fireballs[i]=new I(I.blueFireballVert([this.rightSide()-.75*this.width,this.y+this.height],0,-30,e)):"down"===e?(this.fireballs[i]=new I(I.blueFireballVert([this.rightSide()-this.width/2,this.bottomSide()-this.height],0,30,e)),this.velY-=10,this.jumpCount-=1):this.fireballs[i]=new I(I.blueFireball([this.leftSide()-(this.width+this.width/2),this.topSide()+this.height/5],-30,0,"left"))),this.fireballs[i].launchSound.play()}},{key:"fire",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(3!==Object.keys(this.fireballs).length){for(var i,n=1;n<=3;n++)if(!this.fireballs[n]){i=n,clearTimeout(this.attackAnimTimeout),this.attacking=!0,this.attackAnimTimeout=setTimeout((function(){t.attacking=!1,t.downKey=!1}),200);break}"right"===this.direction?"up"===e?this.fireballs[i]=new I(I.fireballVert([this.rightSide()-this.width/2,this.y+this.height],0,-20,e)):"down"===e?(this.fireballs[i]=new I(I.fireballVert([this.rightSide()-this.width/2,this.bottomSide()-this.height],0,20,e)),this.velY=-2):this.fireballs[i]=new I(I.fireball([this.rightSide()-this.width/10,this.topSide()+this.height/5],20,0,"right")):"left"===this.direction&&("up"===e?this.fireballs[i]=new I(I.fireballVert([this.rightSide()-.75*this.width,this.y+this.height],0,-20,e)):"down"===e?(this.fireballs[i]=new I(I.fireballVert([this.rightSide()-this.width/2,this.bottomSide()-this.height],0,20,e)),this.velY-=10,this.jumpCount-=1):this.fireballs[i]=new I(I.fireball([this.leftSide()-(this.width+this.width/2),this.topSide()+this.height/5],-20,0,"left"))),this.fireballs[i].launchSound.play()}else this.attacking=!1}},{key:"setHit",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;this.shield||this.superShield||this.isHit||(this.isHit=!0,this.hitCooldown=setTimeout((function(){t.isHit=!1}),2e3),this.health-=e,this.setDamageMeter(e))}},{key:"setDamageMeter",value:function(t){this.damageBoost||(this.damageMeter+=t/2,this.damageMeter>=100&&(this.damageMeter=100,this.damageBoost=!0,this.damageBoostCountdown()))}},{key:"damageBoostCountdown",value:function(){var t=this;this.damageMeterInterval=setInterval((function(){t.damageMeter-=1,t.damageMeter<=0&&(t.damageMeter=0,clearInterval(t.damageMeterInterval),t.damageBoost=!1)}),100)}},{key:"setShield",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e4,e=arguments.length>1?arguments[1]:void 0;e?this.superShield=!0:this.shield=!0,this.setShieldTimeOut(t)}},{key:"setShieldTimeOut",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e4;this.shieldTimeOut=setTimeout((function(){t.shield=!1}),e)}},{key:"setDying",value:function(){var t=this;this.health<=0&&(this.health=0,this.dying=!0,this.damage=0,this.velX=0,this.velY=0,setTimeout((function(){t.dead=!0}),1e3))}},{key:"rightSide",value:function(){return this.x+this.width}},{key:"leftSide",value:function(){return this.x}},{key:"topSide",value:function(){return this.y}},{key:"bottomSide",value:function(){return this.y+this.height}},{key:"setOldPos",value:function(){this.oldX=this.x,this.oldY=this.y}},{key:"getDirX",value:function(){return this.x+this.velX}},{key:"getDirY",value:function(){return this.y+this.velY}},{key:"isIdle",value:function(){0===this.velX&&0===this.velY?this.idle=!0:this.idle=!1}},{key:"inAir",value:function(){this.onGround?this.velY=0:(this.y+=this.velY,this.velY+v>25?this.velY=25:this.velY+=v)}},{key:"isClimbing",value:function(){this.climbing&&this.canClimb&&this.keydown?this.y+=this.velY:this.velY=0}},{key:"jump",value:function(){2===this.jumpCount?(this.climbing=!1,this.onGround=!1,this.velY=-15,this.jumpCount=1):1===this.jumpCount&&(this.velY=-15,this.jumpCount=0)}},{key:"climb",value:function(){this.climbing=!this.climbing}},{key:"setCrouch",value:function(){this.crouch?(this.crouch=!1,this.velY=0,this.y=this.bottomSide()+82.01,this.velY=0,this.height=82,this.velY=0):(this.crouch=!0,this.velY=0,this.height=59.5,this.velY=0,this.y=this.topSide()-32.5,this.velY=0)}},{key:"setRunning",value:function(){0!==this.velX?(this.isRunning=!0,this.width=this.runWidth):(this.isRunning=!1,this.width=this.idleWidth)}},{key:"whichDirection",value:function(){this.direction=this.velX>=0?"right":"left"}}])&&m(e.prototype,i),n&&m(e,n),t}();function _(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var w=function(){function t(){var e=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.collidePlayer=this.collidePlayer.bind(this),this.collidePlatform=this.collidePlatform.bind(this),this.collidePlatTop=this.collidePlatTop.bind(this),this.collidePlatBottom=this.collidePlatBottom.bind(this),this.collidePlatLeft=this.collidePlatLeft.bind(this),this.collidePlatRight=this.collidePlatRight.bind(this),this.collideSlopeFortyFiveRight=this.collideSlopeFortyFiveRight.bind(this),this.collideSlopeFortyFiveRightBottom=this.collideSlopeFortyFiveRightBottom.bind(this),this.collideSlopeFortyFiveLeft=this.collideSlopeFortyFiveLeft.bind(this),this.collideSlopeFortyFiveLeftBottom=this.collideSlopeFortyFiveLeftBottom.bind(this),this.collideSlopeTwentyLeft=this.collideSlopeTwentyLeft.bind(this),this.collideSlopeTwentyLeftBottom=this.collideSlopeTwentyLeftBottom.bind(this),this.collideSlopeTwentyRight=this.collideSlopeTwentyRight.bind(this),this.collideSlopeTwentyRightBottom=this.collideSlopeTwentyRightBottom.bind(this),this.climbable=this.climbable.bind(this),this.collideEnemy=this.collideEnemy.bind(this),this.collisionPlatformKeys={1:function(t,i,n,r,o){e.collidePlatTop(t,n)},2:function(t,i,n,r,o){t.velY>0&&e.collidePlatTop(t,n)},3:function(t,i,n,r,o){e.collidePlatBottom(t,n+o)},4:function(t,i,n,r,o){e.collidePlatLeft(t,i)},5:function(t,i,n,r,o){e.collidePlatRight(t,i+o)},6:function(t,i,n,r,o){e.collidePlatTop(t,n)||e.collidePlatLeft(t,i)},7:function(t,i,n,r,o){e.collidePlatTop(t,n)||e.collidePlatRight(t,i+o)},8:function(t,i,n,r,o){e.collidePlatBottom(t,n+o)||e.collidePlatLeft(t,i)},9:function(t,i,n,r,o){e.collidePlatBottom(t,n+o)||e.collidePlatRight(t,i)},10:function(t,i,n,r,o){e.collidePlatTop(t,n)||e.collidePlatBottom(t,n+o)},11:function(t,i,n,r,o){if(t.velY>0){if(e.collidePlatTop(t,n))return;if(e.collidePlatBottom(t,n+o))return;e.collidePlatLeft(t,i)}},12:function(t,i,n,r,o){e.collidePlatTop(t,n)||e.collidePlatRight(t,i+o)||e.collidePlatLeft(t,i)},13:function(t,i,n,r,o){e.collidePlatTop(t,n)||e.collidePlatBottom(t,n+o)||e.collidePlatRight(t,i+o)},14:function(t,i,n,r,o){e.collidePlatBottom(t,n+o)||e.collidePlatRight(t,i+o)||e.collidePlatLeft(t,i)},15:function(t,i,n,r,o){t.velY>0&&e.collidePlatTop(t,n+o/2)},16:function(t,i,n,r,o){e.collidePlatBottom(t,n+o/2)},17:function(t,i,n,r,o){e.collidePlatLeft(t,i+o/2)},18:function(t,i,n,r,o){e.collidePlatRight(t,i+o/2)},19:function(t,i,n,r,o){e.collidePlatTop(t,n+o/2)||e.collidePlatLeft(t,i)},20:function(t,i,n,r,o){e.collidePlatTop(t,n+o/2)||e.collidePlatRight(t,i+o)},21:function(t,i,n,r,o){e.collidePlatBottom(t,n+o/2)||e.collidePlatLeft(t,i)},22:function(t,i,n,r,o){e.collidePlatBottom(t,n+o/2)||e.collidePlatRight(t,i+o)},23:function(t,i,n,r,o){e.collidePlatLeft(t,i+o/2)||t.x+t.width>i+o/2&&e.collidePlatTop(t,n)},24:function(t,i,n,r,o){e.collidePlatRight(t,i+o/2)||(t.x<i+o/2||t.x+e.width>i)&&e.collidePlatTop(t,n)},25:function(t,i,n,r,o){e.collidePlatLeft(t,i+o/2)||t.x+t.width>i+o/2&&e.collidePlatBottom(t,n+o)},26:function(t,i,n,r,o){e.collidePlatRight(t,i+o/2)||t.x<i+o/2&&e.collidePlatBottom(t,n+o)},27:function(t,i,n,r,o){if(t.x+t.width>i){if(e.collidePlatLeft(t,i+o/2))return;if(e.collidePlatBottom(t,n+o))return;e.collidePlatTop(t,n)}},28:function(t,i,n,r,o){if(t.x<i+o){if(e.collidePlatRight(t,i+o/2))return;if(e.collidePlatBottom(t,n+o))return;e.collidePlatTop(t,n)}},29:function(t,i,n,r,o){if(t.x+t.width>i&&t.y+t.height>n){if(e.collidePlatTop(t,n+o/2))return;e.collidePlatLeft(t,i+o/2)}},30:function(t,i,n,r,o){if(t.x<i+o/2&&t.y+t.height>n+o/2){if(e.collidePlatTop(t,n+o/2))return;e.collidePlatRight(t,i+o/2)}},31:function(t,i,n,r,o){if(t.x>i&&t.y<n+o){if(e.collidePlatBottom(t,n+o/2))return;e.collidePlatLeft(t,i+o/2)}},32:function(t,i,n,r,o){if(t.x<i+o&&t.y<n+o){if(e.collidePlatBottom(t,n+o/2))return;e.collidePlatRight(t,i+o/2)}},33:function(t,i,n,r,o){e.collidePlatTop(t,n+.8*o)},34:function(t,i,n,r,o){e.collidePlatBottom(t,n+o)||e.collideSlopeFortyFiveLeft(t,i+o,n+o)},35:function(t,i,n,r,o){e.collideSlopeFortyFiveRight(t,i,n+o)},36:function(t,i,n,r,o){e.collideSlopeTwentyLeft(t,i+o,n+o)},37:function(t,i,n,r,o){e.collideSlopeTwentyRight(t,i,n+o)},38:function(t,i,n,r,o){e.collideSlopeTwentyLeft(t,i,n+o,30)},39:function(t,i,n,r,o){e.collideSlopeTwentyRight(t,i,n+o,o/2)},40:function(t,i,n,r,o){e.collideSlopeFortyFiveRightBottom(t,i,n+o)},41:function(t,i,n,r,o){e.collideSlopeFortyFiveLeftBottom(t,i+o,n+o)},42:function(t,i,n,r,o){e.collideSlopeTwentyLeftBottom(t,i+o,n+o)},43:function(t,i,n,r,o){e.collideSlopeTwentyRightBottom(t,i,n+o)},44:function(t,i,n,r,o){e.collideSlopeTwentyLeftBottom(t,i+o,n+o,o/2)},45:function(t,i,n,r,o){e.collideSlopeTwentyRightBottom(t,i,n+o,o/2)},46:function(t,i,n,r,o){e.collidePlatTop(t,n)||e.collideSlopeFortyFiveLeftBottom(t,i,n+o)},47:function(t,i,n,r,o){t.velY>0&&e.collidePlatTop(t,n)||e.collideSlopeFortyFiveRightBottom(t,i,n+o)},48:function(t,i,n,r,o){e.collidePlatLeft(t,i)||e.collideSlopeFortyFiveLeft(t,i,n+o)},49:function(t,i,n,r,o){e.collidePlatRight(t,i+o)||e.collideSlopeTwentyRight(t,i,n+o,o/2)},50:function(t,i,n,r,o){e.collidePlatLeft(t,i)||e.collideSlopeTwentyLeft(t,i,n+o,o/2)},51:function(t,i,n,r,o){e.collidePlatRight(t,i+o)||e.collideSlopeTwentyRight(t,i,n+o,o/2)},53:function(t,i,n,r,o){e.collidePlatTop(t,n)||e.collidePlatBottom(t,n+o)||e.collidePlatRight(t,i+o)||e.collidePlatLeft(t,i)},54:function(t,i,n,r,o){e.collidePlatTop(t,n)||e.collidePlatBottom(t,n+o/4)},55:function(t,i,n,r,o){e.collidePlatTop(t,n)||e.collidePlatBottom(t,n+o/4)||t.y<n+o/4&&e.collidePlatLeft(t,i)},56:function(t,i,n,r,o){e.collidePlatTop(t,n)||e.collidePlatBottom(t,n+o/4)||t.y<n+o/4&&e.collidePlatRight(t,i+o)},57:function(t,i,n,r,o){e.collidePlatRight(t,i+o)||e.collidePlatLeft(t,i)},58:function(t,i,n,r,o){t.crouch?e.climbable(t,i+.35*o,i+.7*o,n,o):e.collidePlatTop(t,n)},59:function(t,i,n,r,o){e.climbable(t,i+.35*o,i+.7*o,n,o)},63:function(t,i,n,r,o){e.collidePlatLeft(t,i)?t instanceof g&&t.setHit(5):e.collidePlatBottom(t,n+o/6)?t instanceof g&&t.setHit(5):(e.collidePlatRight(t,i+o),t instanceof g&&t.setHit(5))},67:function(t,i,n,r,o){e.collidePlatBottom(t,n+o/6),t instanceof g&&t.setHit(5)}}}var e,i,n;return e=t,(i=[{key:"collidePlayer",value:function(t,e,i){t.x<0?(t.x=.01,t.velX=0):t.x+t.width>e.width&&!i&&(t.x=e.width-t.width,t.velX=0),t.y>e.height&&(t.y=0,t.setHit(50))}},{key:"climbable",value:function(t,e,i,n,r){return t.x+t.width/2>e&&t.x+t.width/2<i?(t.canClimb=!0,!0):(t.canClimb=!1,t.climbing=!1,t.onGround=!1,!1)}},{key:"collideProjectile",value:function(t,e){var i=e.hitBox();return t.x<i.right&&t.x+t.width>i.left&&t.topSide()<i.bottom&&t.bottomSide()>i.top&&(t.velY=-t.velY/3,t.velX=-t.velX/3,t.setHit(e.damage),e.setHit(),!0)}},{key:"collideEnemy",value:function(t,e){return!e.dying&&!e.dead&&t.x<e.x+e.width&&t.x+t.width>e.x&&t.topSide()<e.y+e.height&&t.bottomSide()>e.y&&(t instanceof g&&!t.isHit?(t.velY=-t.velY/3,t.velX=-t.velX/3,t.setHit(e.damage),!0):t instanceof I?(e.setHit(t.damage),e.health<=0&&"down"===t.dir&&(e.points*=2,e.trickShot=!0),setTimeout((function(){t.setHit()}),10),!0):void 0)}},{key:"collideSlopeFortyFiveRight",value:function(t,e,i){var n=i-(t.rightSide()-e);if(t instanceof g)if(t.onGround){if(t.bottomSide()>i&&t.oldY+t.height<i)return t.velY=0,t.y=i-t.height-.2,t.onGround=!0,void(t.jumpCount=2);t.y=n-t.height-.2}else t.onGround||t.rightSide()>e&&t.bottomSide()>n&&t.oldY+t.height<n&&(t.vlY=0,t.onGround=!0,t.jumpCount=2,t.y=n-t.height-.2);if(t instanceof I)return setTimeout((function(){t.setHit()}),100),!0}},{key:"collideSlopeFortyFiveRightBottom",value:function(t,e,i){var n=i-(t.rightSide()-e);if(t.rightSide()>e&&t.topSide()<n&&t.oldY>n){if(t instanceof I)return setTimeout((function(){t.setHit()}),100),!0;t.y=n+.05}}},{key:"collideSlopeFortyFiveLeft",value:function(t,e,i){var n=i-(e-t.leftSide());if(t instanceof g)if(t.onGround){if(t.bottomSide()>i&&t.oldY+t.height<i)return t.velY=0,t.y=i-t.height-.02,t.onGround=!0,void(t.jumpCount=2);t.y=n-t.height-.02}else t.onGround||t.leftSide()<e&&t.bottomSide()>n&&t.oldY+t.height<n&&(t.velY=0,t.onGround=!0,t.jumpCount=2,t.y=n-t.height-.02);if(t instanceof I)return setTimeout((function(){t.setHit()}),100),!0}},{key:"collideSlopeFortyFiveLeftBottom",value:function(t,e,i){var n=i-(e-t.leftSide());if(t.leftSide()<e&&t.topSide()<n&&t.oldY>n){if(t instanceof I)return setTimeout((function(){t.setHit()}),100),!0;t.y=n+.05}}},{key:"collideSlopeTwentyRight",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=i-(n+(t.rightSide()-e)/2);if(t instanceof g)if(t.onGround){if(t.bottomSide()>i&&t.oldY+t.height<i)return t.y=i-t.height-.05,t.onGround=!0,void(t.jumpCount=2);t.y=r-t.height-.05}else t.onGround||t.rightSide()>e&&t.bottomSide()>r&&t.oldY+t.height<r&&(t.velY=0,t.onGround=!0,t.jumpCount=2,t.y=r-t.height-.05);if(t instanceof I)return setTimeout((function(){t.setHit()}),100),!0}},{key:"collideSlopeTwentyRightBottom",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=i-(n+(t.rightSide()-e)/2);if(t.rightSide()>e&&t.topSide()<r&&t.oldY>r){if(t instanceof I)return setTimeout((function(){t.setHit()}),100),!0;t.y=r+.05}}},{key:"collideSlopeTwentyLeft",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=i-(n+(e-t.leftSide())/2);if(t instanceof g)if(t.onGround){if(t.bottomSide()>i&&t.oldY+t.height<i)return t.velY=0,t.y=i-t.height-.05,t.onGround=!0,void(t.jumpCount=2);t.y=r-t.height-.05}else t.onGround||t.leftSide()<e&&t.bottomSide()>r&&t.oldY+t.height<r&&(t.velY=0,t.onGround=!0,t.jumpCount=2,t.y=r-t.height-.05);if(t instanceof I)return setTimeout((function(){t.setHit()}),100),!0}},{key:"collideSlopeTwentyLeftBottom",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=i-(n+(e-t.leftSide())/2);if(t.leftSide()<e&&t.topSide()<r&&t.oldY>r){if(t instanceof I)return setTimeout((function(){t.setHit()}),100),!0;t.y=r+.05}}},{key:"collidePlatTop",value:function(t,e){return t.bottomSide()>e&&t.oldY+.95*t.height<e?t instanceof I?(t.setHit(),!0):(t.velY=0,t.y=e-t.height-.1,t instanceof g&&(t.onGround=!0,t.jumpCount=2),!0):(t instanceof g&&(t.onGround=!1),!1)}},{key:"collidePlatBottom",value:function(t,e){return t.topSide()<e&&t.oldY+t.height>e&&(t instanceof I?(t.setHit(),!0):(t.y=e+.1,t.velY=0,!0))}},{key:"collidePlatRight",value:function(t,e){return t.leftSide()<e&&t.oldX+t.width>e&&(t instanceof I?(t.setHit(),!0):(t.x=e+.1,!0))}},{key:"collidePlatLeft",value:function(t,e){return t.rightSide()>e&&t.oldX<e&&(t instanceof I?(t.setHit(),!0):(t.x=e-t.width-.1,!0))}},{key:"collidePlatform",value:function(t,e,i,n,r){n&&this.collisionPlatformKeys[n]&&this.collisionPlatformKeys[n](t,e,i,n,r)}}])&&_(e.prototype,i),n&&_(e,n),t}();function b(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var S=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.sound=document.createElement("audio"),this.sound.src=e.src,this.sound.id=e.idName,this.sound.classList.add(e.idName),this.sound.setAttribute("preload","auto"),this.sound.setAttribute("controls","none"),this.sound.setAttribute("muted","false"),this.sound.volume=e.volume||.2,this.sound.style.display="none",this.play=this.play.bind(this),this.pause=this.pause.bind(this),this.mute=this.mute.bind(this)}var e,i,n;return e=t,n=[{key:"fire",value:function(){return{src:"./assets/Sound/fireSound.mp3",idName:"fire"}}},{key:"shock",value:function(){return{src:"./assets/Sound/shock.mp3",idName:"shock"}}},{key:"whoosh",value:function(){return{src:"./assets/Sound/swoosh2.mp3",idName:"whoosh",volume:.8}}},{key:"healItem",value:function(){return{src:"./assets/Sound/heal.mp3",idName:"healItem"}}},{key:"shieldItem",value:function(){return{src:"./assets/Sound/shieldItem.wav",idName:"shieldItem"}}},{key:"superShield",value:function(){return{src:"./assets/Sound/hylian.mp3",idName:"superShield",volume:.2}}},{key:"crystal",value:function(){return{src:"./assets/Sound/crystal.mp3",idName:"crystal",volume:.8}}}],(i=[{key:"play",value:function(){this.sound.play()}},{key:"pause",value:function(){this.sound.pause()}},{key:"mute",value:function(){this.sound.muted=!this.sound.muted}}])&&b(e.prototype,i),n&&b(e,n),t}();function C(t){return(C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function E(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if(!(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)))return;var i=[],n=!0,r=!1,o=void 0;try{for(var s,a=t[Symbol.iterator]();!(n=(s=a.next()).done)&&(i.push(s.value),!e||i.length!==e);n=!0);}catch(t){r=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}return i}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function T(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function P(t){return(P=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function k(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function x(t,e){return(x=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var I=function(t){function e(t){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(i=function(t,e){return!e||"object"!==C(e)&&"function"!=typeof e?k(t):e}(this,P(e).call(this,t))).proj=i.loadImage(t.image),i.velX=t.velX,i.velY=t.velY,i.oldX=i.x,i.oldY=i.y,i.dir=t.dir||"right",i.damage=t.damage,i.impacted=!1,i.impactTimeout=t.impactTimeout||0,i.impactSrc=t.impact,i.frameStartX=t.frameStartX,i.frameStartY=t.frameStartY,i.frameWidth=t.frameWidth,i.frameHeight=t.frameHeight,i.frameNum=t.frameNum,i.impactWidth=t.impactWidth,i.impactHeight=t.impactHeight,i.impactFrameWidth=t.impactFrameWidth||i.frameStartX,i.impactFrameHeight=t.impactFrameHeight||i.frameStartY,i.impactStartX=t.impactStartX||145,i.impactStartY=t.impactStartY||150,i.hitTimeout=t.hitTimeout||2e3,i.tileSize=60,i.collider=new w,i.isHit=!1,i.launchSound=new S(S.fire()),i.loadImage=i.loadImage.bind(k(i)),i.getTopLeftPos=i.getTopLeftPos.bind(k(i)),i.getTopRightPos=i.getTopRightPos.bind(k(i)),i.getBottomLeftPos=i.getBottomLeftPos.bind(k(i)),i.getBottomRightPos=i.getBottomRightPos.bind(k(i)),i.setHit=i.setHit.bind(k(i)),i.timeOutHit=i.timeOutHit.bind(k(i)),i.updateProjectile=i.updateProjectile.bind(k(i)),i.drawProjectile=i.drawProjectile.bind(k(i)),i.drawImpact=i.drawImpact.bind(k(i)),i.timeOutHit(),i}var i,n,r;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&x(t,e)}(e,t),i=e,r=[{key:"fireball",value:function(t,e,i,n){return{pos:t,width:35,height:18,velX:e,velY:i,dir:n,frameStartX:10,frameStartY:277,frameWidth:65,frameHeight:18,frameNum:8,image:"./assets/fireball.png",impact:"./assets/burst.png",impactWidth:60,impactHeight:60,impactStartX:145,impactStartY:150,impactFrameWidth:90,impactFrameHeight:90,damage:25}}},{key:"fireballVert",value:function(t,e,i,n){return{pos:t,width:18,height:35,velX:e,velY:i,dir:n,impact:"./assets/burst.png",frameStartX:10,frameStartY:400,frameWidth:22,frameHeight:35,frameNum:8,image:"./assets/fireball.png",impactFrameWidth:90,impactFrameHeight:90,impactWidth:60,impactHeight:60,impactStartX:145,impactStartY:150,damage:25}}},{key:"blueFireball",value:function(t,e,i,n){return{pos:t,width:70,height:36,velX:e,velY:i,dir:n,frameStartX:10,frameStartY:277,frameWidth:65,frameHeight:18,frameNum:8,image:"./assets/blue_fireball.png",impact:"./assets/blue_burst.png",impactWidth:60,impactHeight:60,impactStartX:145,impactStartY:150,impactFrameWidth:90,impactFrameHeight:90,damage:50}}},{key:"blueFireballVert",value:function(t,e,i,n){return{pos:t,width:36,height:70,velX:e,velY:i,dir:n,impact:"./assets/blue_burst.png",frameStartX:10,frameStartY:400,frameWidth:22,frameHeight:35,frameNum:8,image:"./assets/blue_fireball.png",impactFrameWidth:90,impactFrameHeight:90,impactWidth:60,impactHeight:60,impactStartX:145,impactStartY:150,damage:50}}},{key:"helibullet",value:function(t,e,i,n){return{pos:t,width:25,height:25,velX:e,velY:i,dir:n,frameStartX:420,frameStartY:330,frameWidth:15,frameHeight:15,frameNum:1,image:"./assets/footEn.png",impact:"./assets/burst.png",damage:10}}},{key:"pteraBall",value:function(t,e,i,n){return{pos:t,width:25,height:25,velX:e,velY:i,dir:n,frameStartX:420,frameStartY:330,frameWidth:15,frameHeight:15,frameNum:1,image:"./assets/footEn.png",impact:"./assets/burst.png",damage:15}}},{key:"electricBall",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return arguments.length>3&&void 0!==arguments[3]&&arguments[3],{pos:t,width:78.5,height:86,velX:e,velY:i,dir:"up",frameStartX:0,frameStartY:435,frameWidth:180,frameHeight:145,frameNum:4,image:"./assets/electric_ball.png",impact:"./assets/electric_ball.png",impactTimeout:6e3,impactWidth:180,impactHeight:145,impactFrameWidth:180,impactFrameHeight:145,hitTimeout:6e3,damage:20}}}],(n=[{key:"hitBox",value:function(){return{left:this.x,right:this.x+this.width,top:this.y,bottom:this.y+this.height}}},{key:"loadImage",value:function(t){var e=new Image;return e.src=t,e}},{key:"getTopLeftPos",value:function(){return[Math.floor(this.leftSide()/this.tileSize),Math.floor(this.topSide()/this.tileSize)]}},{key:"getTopRightPos",value:function(){return[Math.floor(this.rightSide()/this.tileSize),Math.floor(this.topSide()/this.tileSize)]}},{key:"getBottomLeftPos",value:function(){return[Math.floor(this.leftSide()/this.tileSize),Math.floor(this.bottomSide()/this.tileSize)]}},{key:"getBottomRightPos",value:function(){return[Math.floor(this.rightSide()/this.tileSize),Math.floor(this.bottomSide()/this.tileSize)]}},{key:"setHit",value:function(t){var e=this;this.proj.src=this.impactSrc,this.impacted=!0,this.velX=0,this.velY=0,this.hitTimeout=setTimeout((function(){e.isHit=!0}),100)}},{key:"timeOutHit",value:function(){var t=this;this.hitTimeout=setTimeout((function(){t.isHit=!0}),2e3)}},{key:"platformCheck",value:function(){var t,e,i,n,r;if("left"===this.dir){var o=E(this.getTopLeftPos(),2);r=o[0],e=o[1],t=this.physicalMap[15*e+r],this.collider.collidePlatform(this,r*this.tileSize,e*this.tileSize,t);var s=E(this.getBottomLeftPos(),2);r=s[0],i=s[1],t=this.physicalMap[15*i+r],this.collider.collidePlatform(this,r*this.tileSize,i*this.tileSize,t)}if("right"===this.dir){var a=E(this.getTopRightPos(),2);n=a[0],e=a[1],t=this.physicalMap[15*e+n],this.collider.collidePlatform(this.player,n*this.tileSize,e*this.tileSize,t);var h=E(this.getBottomRightPos(),2);n=h[0],i=h[1],t=this.physicalMap[15*i+n],this.collider.collidePlatform(this.player,n*this.tileSize,i*this.tileSize,t)}}},{key:"updateProjectile",value:function(){this.oldX=this.x,this.oldY=this.y,this.x+=this.velX,this.y+=this.velY}},{key:"drawProjectile",value:function(t,e){this.hit||(this.impacted?this.drawImpact(t,e):(this.updateProjectile(),"up"===this.dir?(t.scale(1,-1),t.drawImage(this.proj,e%this.frameNum*43+21*(e%this.frameNum+1),this.frameStartY,this.frameWidth,this.frameHeight,this.x,-this.y+this.height,this.width,this.height),t.scale(1,-1)):"down"===this.dir?t.drawImage(this.proj,e%this.frameNum*43+21*(e%this.frameNum+1),this.frameStartY,this.frameWidth,this.frameHeight,this.x,this.y,this.width,this.height):"right"===this.dir?t.drawImage(this.proj,e%this.frameNum*this.frameWidth+this.frameStartX,this.frameStartY,this.frameWidth,this.frameHeight,this.x,this.y,this.width,this.height):(t.scale(-1,1),t.drawImage(this.proj,e%this.frameNum*this.frameWidth+this.frameStartX,this.frameStartY,this.frameWidth,this.frameHeight,-this.x-this.frameWidth,this.y,this.width,this.height),t.scale(-1,1))))}},{key:"drawImpact",value:function(t,e){"up"===this.dir?t.drawImage(this.proj,this.impactStartX,this.impactStartY,this.impactFrameWidth,this.impactFrameHeight,this.x-this.impactFrameWidth/3,this.y-this.impactFrameHeight/2,this.impactWidth,this.impactHeight):"down"===this.dir?t.drawImage(this.proj,this.impactStartX,this.impactStartY,this.impactFrameWidth,this.impactFrameHeight,this.x-this.impactFrameWidth/2,this.y+this.height-this.impactFrameHeight/2,this.impactWidth,this.impactHeight):(this.dir,t.drawImage(this.proj,this.impactStartX,this.impactStartY,this.impactFrameWidth,this.impactFrameHeight,this.x-this.width/3,this.y-this.impactFrameHeight/3,this.impactWidth,this.impactHeight))}}])&&T(i.prototype,n),r&&T(i,r),e}(l);function O(t){return(O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function N(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function R(t){return(R=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function D(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function A(t,e){return(A=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var M=function(t){function e(t){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(i=function(t,e){return!e||"object"!==O(e)&&"function"!=typeof e?D(t):e}(this,R(e).call(this,t))).velX=t.velX?t.velX:0,i.velY=t.velY?t.velY:0,i.enemy=i.loadImage(t.image),i.frameNum=t.frameNum,i.dir=t.dir||"right",i.frameStartX=68,i.frameStartY=290,i.frameWidth=116,i.frameHeight=80,i.projectiles={},i.dying=!1,i.dead=!1,i.health=t.health,i.damage=t.damage,i.isHit=!1,i.trickShot=!1,i.setHit=i.setHit.bind(D(i)),i.setDying=i.setDying.bind(D(i)),i.getMidX=i.getMidX.bind(D(i)),i.getMidY=i.getMidY.bind(D(i)),i.loadImage=i.loadImage.bind(D(i)),i.drawEnemy=i.drawEnemy.bind(D(i)),i.shootProj=i.shootProj.bind(D(i)),i.callAttack=i.callAttack.bind(D(i)),i}var i,n,r;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&A(t,e)}(e,t),i=e,r=[{key:"helicopter",value:function(t){return{name:"helicopter",image:"./assets/footEn.png",frameNum:3,pos:t,width:200,height:125,velX:3,dir:"right",health:100,damage:10}}}],(n=[{key:"getMidX",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.x;return t+this.width/2}},{key:"getMidY",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.y;return t+this.height/2}},{key:"loadImage",value:function(t){var e=new Image;return e.src=t,e}},{key:"setHit",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;this.isHit||(this.isHit=!0,this.hitCooldown=setTimeout((function(){t.isHit=!1}),500),this.health-=e)}},{key:"setDying",value:function(){var t=this;this.health<=0&&(this.dying=!0,this.damage=0,this.velX=0,this.velY=0,setTimeout((function(){t.dead=!0}),1e3))}},{key:"drawEnemy",value:function(t,e){this.setDying(),(this.isHit||this.dying)&&e%3==0||("left"===this.dir?t.drawImage(this.enemy,e%this.frameNum*this.frameWidth+this.frameStartX,this.frameStartY,this.frameWidth,this.frameHeight,this.x,this.y,this.width,this.height):(t.scale(-1,1),t.drawImage(this.enemy,e%this.frameNum*this.frameWidth+this.frameStartX,this.frameStartY,this.frameWidth,this.frameHeight,-this.x-this.width,this.y,this.width,this.height),t.scale(-1,1)))}},{key:"shootProj",value:function(){if(3!==Object.keys(this.projectiles).length){for(var t,e=1;e<=3;e++)if(!this.projectiles[e]){t=e;break}"left"===this.dir?this.projectiles[t]=new I(I.helibullet([this.leftSide()+30,this.bottomSide()-23],-9,7,"left")):this.projectiles[t]=new I(I.helibullet([this.rightSide()-40,this.bottomSide()-23],9,7,"right"))}}},{key:"callAttack",value:function(){var t=this;this.attackInterval=setInterval((function(){t.shootProj()}),200)}},{key:"move",value:function(t){this.oldX=this.x,this.x+=this.velX,(this.x+this.width/2<0||this.x+this.width/2>t.width)&&(this.velX*=-1,this.dir="right"===this.dir?"left":"right")}},{key:"hitBox",value:function(t,e){if(t.y<e.y+e.height&&t.y>e.y+e.height/2){if("right"===e.dir&&t.x<e.x+e.width&&t.x+t.width>e.x+e.width/3||"left"===e.dir&&t.x<e.x+e.width*(2/3)&&t.x+t.width>e.x)return!0}else if((t.y<e.height/2&&t.y>e.y||t.y+t.height>e.y)&&t.x<e.x+e.width&&t.x+t.width>e.x)return!0;return!1}}])&&N(i.prototype,n),r&&N(i,r),e}(l);function L(t){return(L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function F(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function j(t){return(j=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function W(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function H(t,e){return(H=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Y=function(t){function e(t){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(i=function(t,e){return!e||"object"!==L(e)&&"function"!=typeof e?W(t):e}(this,j(e).call(this,t))).velX=t.velX||3,i.velY=0,i.image=t.image||"./assets/pterahawk.png",i.enemy=i.loadImage(i.image),i.frameNum=t.frameNum||8,i.frameStartX=t.frameStartX||0,i.frameStartY=t.frameStartY||0,i.frameWidth=t.frameWidth||242,i.frameHeight=t.frameHeight||231,i.projectiles={},i.bounds=t.bounds,i.sizeRatio=t.sizeRatio||1,i.points=Math.floor(5*t.multiplier),i.loadImage=i.loadImage.bind(W(i)),i.drawEnemy=i.drawEnemy.bind(W(i)),i.shootProj=i.shootProj.bind(W(i)),i.callAttack=i.callAttack.bind(W(i)),i.callAttack(),i}var i,n,r;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&H(t,e)}(e,t),i=e,r=[{key:"pter1",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"right",n=arguments.length>3?arguments[3]:void 0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;return{name:"Pterahawk",image:"./assets/pterahawk.png",frameNum:8,pos:t,width:220,height:58,health:160,velX:"left"===i?-3:3,velY:n||0,dir:i,damage:20,bounds:e,multiplier:r}}},{key:"pter2",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"right",n=arguments.length>3?arguments[3]:void 0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.6;return{name:"Pterahawk",image:"./assets/pterahawk.png",frameNum:8,pos:t,width:154,height:40.6,health:100,velX:"left"===i?-4:4,velY:n||0,dir:i,damage:20,sizeRatio:.7,bounds:e,multiplier:r}}},{key:"pter4",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"right",n=arguments.length>3?arguments[3]:void 0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.4;return{name:"Pterahawk",image:"./assets/pterahawk.png",frameNum:8,pos:t,width:110,height:29,health:70,velX:"left"===i?-5:5,velY:n||0,dir:i,damage:20,sizeRatio:.5,bounds:e,multiplier:r}}}],(n=[{key:"drawEnemy",value:function(t,e){this.setDying(),(this.isHit||this.dying)&&e%3==0||("left"===this.dir?t.drawImage(this.enemy,Math.floor(e/4)%this.frameNum*this.frameWidth+this.frameStartX,this.frameStartY,this.frameWidth,this.frameHeight,this.x-.031*this.width,this.y-1.88*this.height,this.frameWidth*this.sizeRatio,this.frameHeight*this.sizeRatio):(t.scale(-1,1),t.drawImage(this.enemy,Math.floor(e/4)%this.frameNum*this.frameWidth+this.frameStartX,this.frameStartY,this.frameWidth,this.frameHeight,-this.x-this.width-.031*this.width,this.y-1.88*this.height,this.frameWidth*this.sizeRatio,this.frameHeight*this.sizeRatio),t.scale(-1,1)))}},{key:"shootProj",value:function(){if(3!==Object.keys(this.projectiles).length){for(var t,e=1;e<=3;e++)if(!this.projectiles[e]){t=e;break}"left"===this.dir?this.projectiles[t]=new I(I.pteraBall([this.leftSide()+.15*this.width,this.bottomSide()-.4*this.height],-11,9,"left")):this.projectiles[t]=new I(I.pteraBall([this.rightSide()-.2*this.width,this.bottomSide()-.5*this.height],11,9,"right"))}}},{key:"setDying",value:function(){var t=this;this.health<=0&&(this.dying=!0,this.damage=0,this.velX=0,this.velY=0,clearInterval(this.attackInterval),setTimeout((function(){t.dead=!0}),300))}},{key:"callAttack",value:function(){var t=this;this.attackInterval=setInterval((function(){t.shootProj()}),1e3)}},{key:"move",value:function(t){this.oldX=this.x,this.x+=this.velX,this.bounds?(this.x+this.width/2<this.bounds[0]||this.x+this.width/2>this.bounds[1])&&(this.velX*=-1,this.dir="right"===this.dir?"left":"right"):(this.x+this.width/2<0||this.x+this.width/2>t.width)&&(this.velX*=-1,this.dir="right"===this.dir?"left":"right")}}])&&F(i.prototype,n),r&&F(i,r),e}(M);function B(t){return(B="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function U(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function X(t){return(X=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function V(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function q(t,e){return(q=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var z=function(t){function e(t){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(i=function(t,e){return!e||"object"!==B(e)&&"function"!=typeof e?V(t):e}(this,X(e).call(this,t))).velX=t.velX||0,i.velY=t.velY||1,i.image=t.image,i.enemy=i.loadImage(i.image),i.frameNum=t.frameNum||4,i.frameStartX=0,i.frameStartY=0,i.frameWidth=t.frameWidth||92.5,i.frameHeight=t.frameHeight||102,i.frameCount=0,i.bounds=t.bounds,i.damage=t.damage,i.points=Math.floor(3*t.multiplier),i.projectiles={},i.drawEnemy=i.drawEnemy.bind(V(i)),i.shootProj=i.shootProj.bind(V(i)),i.callAttack=i.callAttack.bind(V(i)),i.startFrameCount=i.startFrameCount.bind(V(i)),i}var i,n,r;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&q(t,e)}(e,t),i=e,r=[{key:"spider1",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return{name:"spider",image:"./assets/spider.png",frameNum:15,pos:t,width:93,height:102,health:110,velX:0,velY:3,damage:25,bounds:e,multiplier:i}}},{key:"spider2",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.6;return{name:"spider",image:"./assets/spider.png",frameNum:15,pos:t,width:60.5,height:76,health:70,velX:0,velY:1.5,damage:30,bounds:e,multiplier:i}}},{key:"spider3",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.3;return{name:"spider",image:"./assets/spider.png",frameNum:15,pos:t,width:46.5,height:56,health:70,velX:0,velY:2.5,bounds:e,damage:50,multiplier:i}}}],(n=[{key:"startFrameCount",value:function(){var t=this;this.enemyInterval=setInterval((function(){t.frameCount++}),1e3/30)}},{key:"drawEnemy",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.frameCount;if(this.setDying(),t.beginPath(),t.moveTo(this.getMidX(this.pos[0]),this.pos[1]),t.lineTo(this.getMidX(this.pos[0]),this.getMidY(this.y)),t.lineWidth=2,t.strokeStyle="rgba(255, 255, 255, 0.5)",t.stroke(),t.closePath(),!this.isHit&&!this.dying||e%3!=0){var i=Math.floor(e/3)%this.frameNum;t.scale(1,-1),t.drawImage(this.enemy,i%this.frameNum*this.frameWidth,this.frameStartY,this.frameWidth,this.frameHeight,this.x,-this.y-this.height,this.width,this.height),t.scale(1,-1)}}},{key:"setDying",value:function(){var t=this;this.health<=0&&(this.dying=!0,this.damage=0,this.velX=0,this.velY=0,clearInterval(this.attackInterval),setTimeout((function(){t.dead=!0}),300))}},{key:"move",value:function(t){this.oldY=this.y,this.y+=this.velY,this.bounds?(this.y+this.height<this.bounds[0]||this.y+this.height>this.bounds[1])&&(this.velY*=-1):(this.y+this.height<0||this.y+this.height>t.height)&&(this.velY*=-1)}}])&&U(i.prototype,n),r&&U(i,r),e}(M);function Q(t){return(Q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function K(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function G(t){return(G=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function $(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function J(t,e){return(J=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Z=function(t){function e(t){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(i=function(t,e){return!e||"object"!==Q(e)&&"function"!=typeof e?$(t):e}(this,G(e).call(this,t))).player=t.player,i.velX=t.velX||0,i.velY=0,i.image=t.image||"./assets/vinehead.png",i.enemy=i.loadImage(i.image),i.frameNum=t.frameNum||8,i.frameStartX=0,i.frameStartY=0,i.frameWidth=t.frameWidth||57,i.frameHeight=t.frameHeight||87,i.active=!0,i.opening=!1,i.projectiles={},i.playerCheckTimeout="",i.damage=20,i.points=Math.floor(5*t.multiplier),i.drawEnemy=i.drawEnemy.bind($(i)),i.shootProj=i.shootProj.bind($(i)),i.checkPlayerPos=i.checkPlayerPos.bind($(i)),i.callAttack=i.callAttack.bind($(i)),i}var i,n,r;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&J(t,e)}(e,t),i=e,r=[{key:"vine1",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"right",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.6;return{name:"vinehead",image:"./assets/vinehead.png",frameNum:8,pos:t,width:65,height:95,health:75,velX:1,dir:i,player:e,multiplier:n}}},{key:"vine2",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"right",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return{name:"vinehead",image:"./assets/vinehead.png",frameNum:8,pos:t,width:100,height:145,health:120,velX:1,dir:i,player:e,multiplier:n}}},{key:"vine3",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"right",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.25;return{name:"vinehead",image:"./assets/vinehead.png",frameNum:8,pos:t,width:35,height:45,health:50,velX:1,dir:i,player:e,multiplier:n}}}],(n=[{key:"checkPlayerPos",value:function(t,e,i){var n=this;e>this.y?this.velY=1:this.velY=-1,e>this.y&&e<this.y+this.height&&(t>this.x||t<this.x)?this.velX="left"===this.dir?-5:5:this.velX="left"===this.dir?-1:1,t>this.x&&"left"===this.dir?this.playerCheckTimeout=setTimeout((function(){n.velX=1,n.dir="right"}),1e3):t<this.x&&"right"===this.dir?this.playerCheckTimeout=setTimeout((function(){n.velX=-1,n.dir="left"}),1e3):(t>this.x&&"right"===this.dir||t<this.x&&"left"===this.dir)&&clearTimeout(this.playerCheckTimeout)}},{key:"setPlayerCheckInterval",value:function(t){var e=this;this.playerCheckInterval=setInterval((function(){e.checkPlayerPos(t)}),2)}},{key:"drawEnemy",value:function(t,e){this.setDying(),(this.isHit||this.dying)&&e%3==0||("right"===this.dir?t.drawImage(this.enemy,Math.floor(e/1.5)%this.frameNum*this.frameWidth,this.frameStartY,this.frameWidth,this.frameHeight,this.x,this.y,this.width,this.height):(t.scale(-1,1),t.drawImage(this.enemy,e%this.frameNum*this.frameWidth+this.frameStartX,this.frameStartY,this.frameWidth,this.frameHeight,-this.x-this.width,this.y,this.width,this.height),t.scale(-1,1)))}},{key:"shootProj",value:function(){if(3!==Object.keys(this.projectiles).length){for(var t,e=1;e<=3;e++)if(!this.projectiles[e]){t=e;break}"left"===this.dir?this.projectiles[t]=new I(I.helibullet([this.leftSide()+30,this.bottomSide()-23],-9,7,"left")):this.projectiles[t]=new I(I.helibullet([this.rightSide()-40,this.bottomSide()-23],9,7,"right"))}}},{key:"setDying",value:function(){var t=this;this.health<=0&&(this.dying=!0,this.damage=0,this.velX=0,this.velY=0,clearInterval(this.attackInterval),setTimeout((function(){t.dead=!0}),300))}},{key:"move",value:function(t,e){this.oldY=this.y,this.oldX=this.x,this.x+=this.velX,this.y+=this.velY,this.checkPlayerPos(e.x,e.y)}}])&&K(i.prototype,n),r&&K(i,r),e}(M);function tt(t){return(tt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function et(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if(!(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)))return;var i=[],n=!0,r=!1,o=void 0;try{for(var s,a=t[Symbol.iterator]();!(n=(s=a.next()).done)&&(i.push(s.value),!e||i.length!==e);n=!0);}catch(t){r=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}return i}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function it(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function nt(t){return(nt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function rt(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ot(t,e){return(ot=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var st=function(t){function e(t){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(i=function(t,e){return!e||"object"!==tt(e)&&"function"!=typeof e?rt(t):e}(this,nt(e).call(this,t))).proj=i.loadImage(),i.width=90,i.height=72.5,i.velX=0,i.velY=1,i.oldX=i.x,i.oldY=i.y,i.damage=t.damage,i.impacted=!1,i.impactTimeout=6e3,i.impactSrc="./assets/electric_ball.png",i.frameStartX=0,i.frameStartY=435,i.frameWidth=180,i.frameHeight=145,i.frameNum=4,i.impactWidth=180,i.impactHeight=145,i.impactStartX=145,i.impactStartY=150,i.hitTimeout=6e3,i.tileSize=60,i.collider=new w,i.isHit=!1,i.loadImage=i.loadImage.bind(rt(i)),i.getTopLeftPos=i.getTopLeftPos.bind(rt(i)),i.getTopRightPos=i.getTopRightPos.bind(rt(i)),i.getBottomLeftPos=i.getBottomLeftPos.bind(rt(i)),i.getBottomRightPos=i.getBottomRightPos.bind(rt(i)),i.setHit=i.setHit.bind(rt(i)),i.timeOutHit=i.timeOutHit.bind(rt(i)),i.updateProjectile=i.updateProjectile.bind(rt(i)),i.drawProjectile=i.drawProjectile.bind(rt(i)),i.drawImpact=i.drawImpact.bind(rt(i)),i.hitBox=i.hitBox.bind(rt(i)),i.impactSound=new S(S.shock()),i.timeOutHit(),i}var i,n,r;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ot(t,e)}(e,t),i=e,r=[{key:"electricBall",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return arguments.length>3&&void 0!==arguments[3]&&arguments[3],{pos:t,width:78.5,height:86,velX:e,velY:i,dir:"up",frameStartX:0,frameStartY:435,frameWidth:180,frameHeight:145,frameNum:4,image:"./assets/electric_ball.png",impact:"./assets/electric_ball.png",impactTimeout:6e3,impactWidth:180,impactHeight:145,impactFrameWidth:180,impactFrameHeight:145,hitTimeout:6e3,damage:20}}}],(n=[{key:"hitBox",value:function(){return{left:this.x+this.width/5,right:this.x+.8*this.width,top:this.y+this.height/5,bottom:this.y+.8*this.height}}},{key:"loadImage",value:function(){var t=new Image;return t.src="./assets/electric_ball.png",t}},{key:"getTopLeftPos",value:function(){return[Math.floor((this.leftSide()+this.width/5)/this.tileSize),Math.floor((this.topSide()+this.height/5)/this.tileSize)]}},{key:"getTopRightPos",value:function(){return[Math.floor((this.rightSide()-this.width/5)/this.tileSize),Math.floor((this.topSide()+this.height/5)/this.tileSize)]}},{key:"getBottomLeftPos",value:function(){return[Math.floor((this.leftSide()+this.width/5)/this.tileSize),Math.floor((this.bottomSide()-this.height/5)/this.tileSize)]}},{key:"getBottomRightPos",value:function(){return[Math.floor(this.rightSide()/this.tileSize),Math.floor((this.bottomSide()-this.height/5)/this.tileSize)]}},{key:"setHit",value:function(){var t=this;this.impacted=!0,this.impactSound.play(),this.proj.src=this.impactSrc,this.width*=1.7,this.height*=1.7,this.velX=0,this.velY=0,setTimeout((function(){t.impactSound.pause(),t.isHit=!0}),3e3)}},{key:"timeOutHit",value:function(){var t=this;this.hitTimeout=setTimeout((function(){t.isHit=!0}),7e3)}},{key:"platformCheck",value:function(){var t,e,i,n,r;if("left"===this.dir){var o=et(this.getTopLeftPos(),2);r=o[0],e=o[1],t=this.physicalMap[15*e+r],this.collider.collidePlatform(this,r*this.tileSize,e*this.tileSize,t);var s=et(this.getBottomLeftPos(),2);r=s[0],i=s[1],t=this.physicalMap[15*i+r],this.collider.collidePlatform(this,r*this.tileSize,i*this.tileSize,t)}if("right"===this.dir){var a=et(this.getTopRightPos(),2);n=a[0],e=a[1],t=this.physicalMap[15*e+n],this.collider.collidePlatform(this.player,n*this.tileSize,e*this.tileSize,t);var h=et(this.getBottomRightPos(),2);n=h[0],i=h[1],t=this.physicalMap[15*i+n],this.collider.collidePlatform(this.player,n*this.tileSize,i*this.tileSize,t)}}},{key:"updateProjectile",value:function(){this.oldX=this.x,this.oldY=this.y,this.x+=this.velX,this.y+=this.velY}},{key:"drawProjectile",value:function(t,e){this.isHit||(this.impacted?this.drawImpact(t,e):(this.updateProjectile(),t.drawImage(this.proj,e%this.frameNum*this.frameWidth,this.frameStartY,this.frameWidth,this.frameHeight,this.x,this.y,this.width,this.height)))}},{key:"drawImpact",value:function(t,e){t.drawImage(this.proj,e%this.frameNum*this.frameWidth,this.frameStartY,180,145,this.x-45,this.y-36.25,180,145)}}])&&it(i.prototype,n),r&&it(i,r),e}(I);function at(t){return(at="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ht(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function lt(t){return(lt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function ut(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ct(t,e){return(ct=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var dt=function(t){function e(t){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(i=function(t,e){return!e||"object"!==at(e)&&"function"!=typeof e?ut(t):e}(this,lt(e).call(this,t))).player=t.player,i.velX=t.velX||0,i.velY=0,i.image=t.image||"./assets/jellyfish.png",i.enemy=i.loadImage(i.image),i.frameNum=t.frameNum||8,i.frameStartX=4,i.frameStartY=130,i.frameWidth=t.frameWidth||58,i.frameHeight=t.frameHeight||64,i.active=!0,i.opening=!1,i.projectiles={},i.playerCheckTimeout="",i.damage=t.damage,i.points=Math.floor(5*t.multiplier),i.drawEnemy=i.drawEnemy.bind(ut(i)),i.shootProj=i.shootProj.bind(ut(i)),i.setPlayerCheckInterval=i.setPlayerCheckInterval.bind(),i.checkPlayerPos=i.checkPlayerPos.bind(ut(i)),i.setAttackInterval=i.setAttackInterval.bind(ut(i)),i.setAttackInterval(),i}var i,n,r;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ct(t,e)}(e,t),i=e,r=[{key:"jell1",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"right";return arguments.length>3&&void 0!==arguments[3]&&arguments[3],{name:"Jellyfish",image:"./assets/jellyfish.png",frameNum:8,pos:t,width:90,height:100,health:130,velX:1,dir:i,player:e,multiplier:1}}},{key:"jell2",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"right";return arguments.length>3&&void 0!==arguments[3]&&arguments[3],{name:"Jellyfish",image:"./assets/jellyfish.png",frameNum:8,pos:t,width:60,height:66,health:90,velX:1,dir:i,player:e,multiplier:.5}}},{key:"jell3",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"right";return arguments.length>3&&void 0!==arguments[3]&&arguments[3],{name:"Jellyfish",image:"./assets/jellyfish.png",frameNum:8,pos:t,width:35,height:45,health:50,velX:1,dir:i,player:e,multiplier:.5}}}],(n=[{key:"setAttackInterval",value:function(){var t=this;setTimeout((function(){t.attackInterval=setInterval((function(){t.shootProj()}),4e3)}),2e3)}},{key:"checkPlayerPos",value:function(t,e){var i=this;e>this.y?this.velY=2:this.velY=-2,t>this.x&&"left"===this.dir?this.playerCheckTimeout=setTimeout((function(){i.velX=2,i.dir="right"}),1e3):t<this.x&&"right"===this.dir?this.playerCheckTimeout=setTimeout((function(){i.velX=-2,i.dir="left"}),1e3):(t>this.x&&"right"===this.dir||t<this.x&&"left"===this.dir)&&clearTimeout(this.playerCheckTimeout)}},{key:"setPlayerCheckInterval",value:function(t){var e=this;this.playerCheckInterval=setInterval((function(){e.checkPlayerPos(t)}),2e3)}},{key:"drawEnemy",value:function(t,e){if(this.setDying(),!this.isHit&&!this.dying||e%3!=0){var i=Math.floor(e/2.5)%this.frameNum;"left"===this.dir?t.drawImage(this.enemy,i*this.frameWidth+(this.frameStartX*i+2*i),this.frameStartY,this.frameWidth,this.frameHeight,this.x,this.y,this.width,this.height):(t.scale(-1,1),t.drawImage(this.enemy,i*this.frameWidth+(this.frameStartX*i+2*i),this.frameStartY,this.frameWidth,this.frameHeight,-this.x-this.width,this.y,this.width,this.height),t.scale(-1,1))}}},{key:"shootProj",value:function(){if(10!==Object.keys(this.projectiles).length){for(var t,e=1;e<=10;e++)if(!this.projectiles[e]){t=e;break}this.projectiles[t]=new st({pos:[this.leftSide()+this.width/2,this.bottomSide()-this.height/2]})}}},{key:"setDying",value:function(){var t=this;this.health<=0&&(this.dying=!0,this.damage=0,this.velX=0,this.velY=0,clearInterval(this.attackInterval),setTimeout((function(){t.dead=!0}),300))}},{key:"move",value:function(t,e){this.oldY=this.y,this.oldX=this.x,this.x+=this.velX,this.y+=this.velY,this.checkPlayerPos(e.x,e.y-2*e.height)}}])&&ht(i.prototype,n),r&&ht(i,r),e}(M);function pt(t){return(pt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ft(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function yt(t){return(yt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function mt(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function vt(t,e){return(vt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var gt=function(t){function e(t){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(i=function(t,e){return!e||"object"!==pt(e)&&"function"!=typeof e?mt(t):e}(this,yt(e).call(this,t))).impact=i.loadImage(t.image),i.frameStartX=t.frameStartX,i.frameStartY=t.frameStartY,i.frameWidth=t.frameWidth,i.frameHeight=t.frameHeight,i.frameNum=t.frameNum,i.done=!1,i.frameCountOffset=t.frameCountOffset,i.launchSound=new S(S.fire()),i.frameCount=0,i.loadImage=i.loadImage.bind(mt(i)),i.drawImpact=i.drawImpact.bind(mt(i)),setTimeout((function(){i.done=!0}),350),i}var i,n,r;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&vt(t,e)}(e,t),i=e,r=[{key:"explosion",value:function(t){return{name:"explosion",pos:t,width:160,height:160,frameStartX:0,frameStartY:0,frameWidth:75,frameHeight:75,frameNum:9,volume:1.3,image:"./assets/burst2.png"}}}],(n=[{key:"loadImage",value:function(t){var e=new Image;return e.src=t,e}},{key:"drawImpact",value:function(t,e){this.done||(0===this.frameCount&&this.launchSound.play(),this.frameCount++,t.drawImage(this.impact,Math.floor(this.frameCount/2.5)%9*this.frameWidth,this.frameStartY,this.frameWidth,this.frameHeight,this.x-this.width/2,this.y+this.height-this.height/2,this.width,this.height))}}])&&ft(i.prototype,n),r&&ft(i,r),e}(l);function _t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var wt=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.boss=e.boss||{},this.vine=this.loadImage(),this.attacking=!1,this.charging=!1,this.frameNum=7,this.velX=0,this.velY=e.velY,this.x=e.pos[0],this.y=e.pos[1],this.startX=this.x,this.redVine=new Image,this.redVine.src="./assets/vine_red.png",this.boundsY=e.boundsY,this.damage=e.damage||10,this.frameCountOffset=e.frameCountOffset,this.attack=this.attack.bind(this),this.loadImage=this.loadImage.bind(this),this.backUp=this.backUp.bind(this),this.charge=this.charge.bind(this),this.drawVines=this.drawVines.bind(this),this.playerCheck=this.playerCheck.bind(this),this.move=this.move.bind(this),this.impactSound=new S(S.whoosh())}var e,i,n;return e=t,n=[{key:"vines1",value:function(t,e){return{boss:t,pos:e,velY:Math.floor(10*Math.random())<=5?-1:1,boundsY:[e[1]-100,e[1]+100],frameCountOffset:Math.floor(7*Math.random())}}},{key:"vines2",value:function(t,e){return{boss:t,pos:e,velY:Math.floor(10*Math.random())<=5?-.3:.3,boundsY:[e[1]-10,e[1]+10],frameCountOffset:Math.floor(7*Math.random())}}}],(i=[{key:"loadImage",value:function(){var t=new Image;return t.src="./assets/vines.png",t}},{key:"attack",value:function(t){var e=this;this.attacking=!0,this.chargeTimeout=setTimeout((function(){e.charge()}),t)}},{key:"backUp",value:function(){var t=this;this.vineTimeout=setTimeout((function(){t.charging=!1,t.velX=10}),300)}},{key:"charge",value:function(){this.charging=!0,this.velX=-20,this.impactSound.play()}},{key:"drawVines",value:function(t,e){if(!this.boss.dying||e%3!=0){var i=this.charging?0:this.attacking?(e+this.frameCountOffset)%this.frameNum:(Math.floor(e/2.5)+this.frameCountOffset)%this.frameNum,n=this.attacking?1e3:400;"left"===this.boss.dir?t.drawImage(this.vine,2,94*i,n,94,this.x,this.y,n,60):(t.scale(-1,1),t.drawImage(this.vine,2,94*i,n,94,-this.x-n,this.y,n,60),t.scale(-1,1))}}},{key:"playerCheck",value:function(t){this.boss.dying||t.x>this.x&&t.y+t.height>this.y+10&&t.y<this.y+50&&t.setHit(this.damage)}},{key:"move",value:function(t,e,i){this.oldX=this.x,this.x+=this.velX,this.attacking||(this.y+=this.velY),this.playerCheck(i),this.x<-20?(this.x=-20,this.backUp()):this.x>this.startX&&(this.velX=0,this.attacking=!1,this.x=this.startX),(this.y<this.boundsY[0]||this.y>this.boundsY[1])&&(this.velY*=-1),this.drawVines(t,e)}}])&&_t(e.prototype,i),n&&_t(e,n),t}();function bt(t){return(bt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function St(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Ct(t){return(Ct=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Et(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Tt(t,e){return(Tt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Pt=function(t){function e(t){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(i=function(t,e){return!e||"object"!==bt(e)&&"function"!=typeof e?Et(t):e}(this,Ct(e).call(this,t))).player=t.player,i.velX=t.velX||0,i.velY=0,i.image=t.image||"./assets/vinehead.png",i.enemy=i.loadImage(i.image),i.lowHealth=i.loadImage("./assets/vinehead_red.png"),i.vineNum=5,i.frameNum=t.frameNum||8,i.frameStartX=0,i.frameStartY=0,i.frameWidth=t.frameWidth||57,i.frameHeight=t.frameHeight||87,i.active=!0,i.opening=!1,i.impact=[],i.playerCheckTimeout="",i.damage=50,i.attacking=!1,i.charging=!1,i.frameCount=0,i.points=50,i.impactIdx=0,i.vines=[new wt(wt.vines1(Et(i),[680,165])),new wt(wt.vines1(Et(i),[710,220])),new wt(wt.vines1(Et(i),[680,435])),new wt(wt.vines1(Et(i),[740,275])),new wt(wt.vines1(Et(i),[740,325])),new wt(wt.vines1(Et(i),[710,380]))],i.vines2=[new wt(wt.vines2(Et(i),[200,0])),new wt(wt.vines2(Et(i),[250,20])),new wt(wt.vines2(Et(i),[270,510]))],i.drawEnemy=i.drawEnemy.bind(Et(i)),i.callAttack=i.callAttack.bind(Et(i)),i.charge=i.charge.bind(Et(i)),i.startFrameCount=i.startFrameCount.bind(Et(i)),i.shuffleVines=i.shuffleVines.bind(Et(i)),i.renderVines=i.renderVines.bind(Et(i)),i.attackVines=i.attackVines.bind(Et(i)),i.startAttack=i.startAttack.bind(Et(i)),i.renderExplosion=i.renderExplosion.bind(Et(i)),i.startFrameCount(),i.startAttack(),i}var i,n,r;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Tt(t,e)}(e,t),i=e,r=[{key:"boss1",value:function(t,e){return arguments.length>2&&void 0!==arguments[2]&&arguments[2],{name:"vinehead",image:"./assets/vinehead.png",frameNum:8,pos:t,width:245,height:340,health:1800,velX:0,dir:"left",player:e}}}],(n=[{key:"startFrameCount",value:function(){var t=this;this.bossInterval=setInterval((function(){t.frameCount++}),1e3/30)}},{key:"startAttack",value:function(){var t=this;this.attackTimeout=setTimeout((function(){t.attack()}),1e3),this.vineInterval=setInterval((function(){t.attackVines()}),1e4)}},{key:"attack",value:function(){var t=this;this.attacking=!0,this.chargeTimeout=setTimeout((function(){t.charge()}),2500)}},{key:"charge",value:function(){this.charging=!0,this.velX=this.health>500?-10:-20}},{key:"shuffleVines",value:function(t){for(var e=t.length-1;e>0;e--){var i=Math.floor(Math.random()*(e+1)),n=[t[i],t[e]];t[e]=n[0],t[i]=n[1]}return t}},{key:"renderVines",value:function(t,e){var i=this;this.vines.forEach((function(n,r){n.move(t,i.frameCount,e)}))}},{key:"renderVines2",value:function(t,e){var i=this;this.vines2.forEach((function(n,r){n.move(t,i.frameCount,e)}))}},{key:"attackVines",value:function(){var t=this;this.dead?clearInterval(this.vineInterval):(this.vines.forEach((function(t,e){t.attack(1500+500*e)})),setTimeout((function(){t.vines=t.shuffleVines(t.vines)}),5e3))}},{key:"drawEnemy",value:function(t,e){if(this.setDying(),!this.isHit&&!this.dying||e%3!=0){var i=this.health<500&&e%2==0?this.lowHealth:this.enemy,n=this.attacking&&(this.frameCount%3==0||this.frameCount%3==1)||this.charging?87:this.frameStartY;"right"===this.dir?(Math.floor(e/2.5),this.frameNum,t.drawImage(i,Math.floor(this.frameCount/1.5)%this.frameNum*this.frameWidth,n,this.frameWidth,this.frameHeight,this.x,this.y,this.width,this.height)):(t.scale(-1,1),t.drawImage(i,this.frameCount%this.frameNum*this.frameWidth+this.frameStartX,n,this.frameWidth,this.frameHeight,-this.x-this.width,this.y-30,this.width,this.height+30),t.scale(-1,1)),this.dying&&this.renderExplosion(t,e)}else this.renderExplosion(t,e)}},{key:"renderExplosion",value:function(t,e){if(0!==this.impact.length&&(this.impact[0].drawImpact(t,e),this.impact[0].done)){var i=Math.random()*this.width+this.x+this.width/10,n=Math.random()*this.height+this.y-this.height/2;this.impact[0]=new gt(gt.explosion([i,n]))}}},{key:"setDying",value:function(){var t=this;if(this.health<=0){this.dying=!0;var e=Math.random()*this.width+this.x-10,i=Math.random()*this.height+this.y-40;this.impact.push(new gt(gt.explosion([e,i]))),this.vines.forEach((function(t){clearTimeout(t.chargeTimeout),clearTimeout(t.vineTimeout)})),this.damage=0,this.velX=0,this.velY=0,clearInterval(this.attackInterval),clearInterval(this.vineInterval),setTimeout((function(){t.dead=!0,clearInterval(t.startFrameCount)}),5e3)}}},{key:"backUp",value:function(){this.charging=!1,this.velX=2}},{key:"move",value:function(t,e,i){var n=this;this.oldX=this.x,this.x+=this.velX,this.x<160?(this.x=160,this.backUp()):this.x>650&&(this.velX=0,this.attacking=!1,this.x=650,this.attackTimeout=setTimeout((function(){n.attack()}),7e3)),this.renderVines(i,e)}}])&&St(i.prototype,n),r&&St(i,r),e}(M);function kt(t){return(kt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function xt(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function It(t){return(It=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Ot(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Nt(t,e){return(Nt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Rt=function(t){function e(t){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(i=function(t,e){return!e||"object"!==kt(e)&&"function"!=typeof e?Ot(t):e}(this,It(e).call(this,t))).item=i.loadImage(),i.width=t.width,i.height=t.height,i.velY=t.velY||0,i.frameStartX=t.frameStartX,i.frameStartY=t.frameStartY,i.frameWidth=t.frameWidth,i.frameHeight=t.frameHeight,i.frameNum=t.frameNum,i.disappear=t.disappear,i.collectedSound=new S(t.soundSrc),i.fading=!1,i.collected=!1,i.loadImage=i.loadImage.bind(Ot(i)),i.drawItem=i.drawItem.bind(Ot(i)),i.timeOutCollected=i.timeOutCollected.bind(Ot(i)),i.timeOutCollected(),i}var i,n,r;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Nt(t,e)}(e,t),i=e,r=[{key:"shield",value:function(t,e){return{name:"Shield",pos:t,width:39,height:51,frameStartX:1,frameStartY:0,frameWidth:93,frameHeight:118,frameNum:1,soundSrc:S.shieldItem(),disappear:e}}},{key:"hylianShield",value:function(t,e){return{name:"Hylian Shield",pos:t,width:39,height:51,velY:e?.4:0,frameStartX:100,frameStartY:0,frameWidth:110,frameHeight:123,frameNum:1,soundSrc:S.superShield(),disappear:e}}},{key:"health",value:function(t,e){return{name:"Blue Health",pos:t,width:46.5,height:50.5,velY:e?.4:0,frameStartX:0,frameStartY:125,frameWidth:95,frameHeight:101,frameNum:2,soundSrc:S.healItem(),disappear:e}}},{key:"blueHealth",value:function(t,e){return{name:"Blue Health",pos:t,width:46.5,height:50.5,velY:e?.4:0,frameStartX:0,frameStartY:232,frameWidth:95,frameHeight:101,frameNum:2,soundSrc:S.healItem(),disappear:e}}},{key:"blueCrystal",value:function(t,e){return{name:"Blue Crystal",pos:t,width:27.5,height:50.5,velY:e?.4:0,volume:.8,frameStartX:0,frameStartY:335,frameWidth:45,frameHeight:118,frameNum:4,soundSrc:S.crystal(),disappear:e}}}],(n=[{key:"timeOutCollected",value:function(){var t=this;this.disappear&&(this.fadeTimeOut=setTimeout((function(){t.fading=!0}),7e3),this.collectedTimeOut=setTimeout((function(){t.collected=!0}),1e4))}},{key:"loadImage",value:function(){var t=new Image;return t.src="./assets/items.png",t}},{key:"checkCollected",value:function(t){if(this.x+this.width/4<t.x+t.width&&this.x+.75*this.width>t.x&&this.y+this.height/4<t.y+t.height&&this.y+.75*this.height>t.y)switch(this.collected=!0,this.collectedSound.play(),this.name){case"Shield":return void t.setShield();case"Hylian Shield":return void t.setShield(6e4,!0);case"Health":return void(t.health<200&&(t.health+=30,t.health>200&&(t.health=200)));case"Blue Health":return void(t.health<200&&(t.health+=60,t.health>200&&(t.health=200)));case"Blue Crystal":return void t.setDamageMeter(80);default:return}}},{key:"drawItem",value:function(t,e){this.collected||(this.y+=this.velY,this.fading&&e%2==0||t.drawImage(this.item,Math.floor(e/4)%this.frameNum*this.frameWidth+this.frameStartX,this.frameStartY,this.frameWidth,this.frameHeight,this.x,this.y,this.width,this.height))}}])&&xt(i.prototype,n),r&&xt(i,r),e}(l);function Dt(t){return(Dt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function At(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Mt(t){return(Mt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Lt(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Ft(t,e){return(Ft=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var jt=function(t){function e(t){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(i=function(t,e){return!e||"object"!==Dt(e)&&"function"!=typeof e?Lt(t):e}(this,Mt(e).call(this,t))).velX=t.velX||0,i.velY=0,i.image1=i.loadImage("./assets/grad1.png"),i.image2=i.loadImage("./assets/grad2.png"),i.isHit=!1,i.active=!1,i.projectiles={},i.damage=0,i.points=1e3,i.health=t.health,i.move=i.move.bind(Lt(i)),i.setHit=i.setHit.bind(Lt(i)),i.setDying=i.setDying.bind(Lt(i)),i.loadImage=i.loadImage.bind(Lt(i)),i.drawEnemy=i.drawEnemy.bind(Lt(i)),i}var i,n,r;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ft(t,e)}(e,t),i=e,r=[{key:"egg1",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"right";return{name:"egg",frameNum:3,pos:t,width:400,height:300,health:100,velX:0,dir:e}}}],(n=[{key:"loadImage",value:function(t){var e=new Image;return e.src=t,e}},{key:"setHit",value:function(t){var e=this;this.health-=1,clearTimeout(this.changeTimeout),this.changeTimeout=setTimeout((function(){e.isHit=!e.isHit}),25)}},{key:"drawEnemy",value:function(t,e){this.setDying(),this.dying&&e%3==0||(this.isHit?t.drawImage(this.image2,0,0,431,361,this.x-15.5,this.y-20,431,361):t.drawImage(this.image1,0,0,431,361,this.x-15.5,this.y-20,431,361))}},{key:"setDying",value:function(){var t=this;this.health<=0&&(this.dying=!0,this.damage=0,this.velX=0,this.velY=0,clearInterval(this.attackInterval),setTimeout((function(){t.dead=!0}),300))}},{key:"move",value:function(t){this.oldX=this.x,this.x+=this.velX,(this.x+this.width/2<0||this.x+this.width/2>t.width)&&(this.velX*=-1,this.dir="right"===this.dir?"left":"right")}}])&&At(i.prototype,n),r&&At(i,r),e}(l);function Wt(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var Ht=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.ctx=e.ctx,this.player=e.player,this.mapKeys=e.mapKeys,this.screen=Object.keys(this.mapKeys)[0],this.lastScreen=Object.keys(this.mapKeys)[Object.keys(this.mapKeys).length-1],this.renderMap=e.renderMap||this.mapKeys[this.screen].renderMap,this.physicalMap=e.physicalMap||this.mapKeys[this.screen].physicalMap,this.nextScreen=this.mapKeys[this.screen].nextScreen,this.cols=15,this.rows=10,this.tileSize=e.tileSize,this.tileMap=this.loadImage(),this.mapTileSize=this.tileMap.width/this.rows,this.enemies=this.mapKeys[this.screen].enemies(),this.enemyCount=1,this.theme=new a(this.mapKeys[this.screen].theme),this.levelLayers=this.loadImages(this.mapKeys[this.screen].levelLayers),this.items=this.mapKeys[this.screen].items(),this.spawnTier=this.mapKeys[this.screen].spawnTier||null,this.rushLevel=0,this.spawnTierGroup=2,this.rushInterval="",this.enemyRushSpawn=this.enemyRushSpawn.bind(this),this.enemyRushInterval=this.enemyRushInterval.bind(this),this.getTile=this.getTile.bind(this),this.getLeft=this.getLeft.bind(this),this.getRight=this.getRight.bind(this),this.getTop=this.getTop.bind(this),this.getBottom=this.getBottom.bind(this),this.drawLevel=this.drawLevel.bind(this),this.loadImage=this.loadImage.bind(this),this.loadLevel=this.loadLevel.bind(this),this.enemiesInterval=this.enemiesInterval.bind(this),this.spawnEnemies=this.spawnEnemies.bind(this),this.enemyRush=this.enemyRush.bind(this),this.lastScreenCleared=!1,this.loadImages=this.loadImages.bind(this),this.renderBackground=this.renderBackground.bind(this),this.renderMid=this.renderMid.bind(this),this.renderFront=this.renderFront.bind(this),this.enemiesInterval()}var e,i,n;return e=t,n=[{key:"level2",value:function(){var t=this;return{survivalMode:{renderMap:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,29,29,29,0,0,0,0,0,0,0,0,0,0,0,0,3,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,29,29,29,0,0,0,29,29,29,0,0,0,0,0,0,3,1,2,0,0,0,3,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],physicalMap:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,2,0,0,0,2,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,2,2,2,2,2,2,2,2,1,1,1,1],enemies:function(){return{1:new z(z.spider1([600,0],[20,359])),2:new z(z.spider1([420,0],[20,179])),3:new z(z.spider1([240,0],[20,359])),4:new z(z.spider1([780,0],[20,479])),5:new z(z.spider1([60,0],[20,479]))}},spawnTier:{1:{0:function(){return new z(z.spider1([600,0],[20,359]))},1:function(){return new z(z.spider1([420,0],[20,179]))},2:function(){return new z(z.spider1([240,0],[20,359]))}},2:{0:function(){return new Y(Y.pter4([800,125],[-50,950],"left"))},1:function(){return new Y(Y.pter4([0,125],[-50,950],"right"))},2:function(){return new Y(Y.pter4([800,300],[-50,950],"left"))},3:function(){return new Y(Y.pter4([0,300],[-50,950],"right"))},4:function(){return new Y(Y.pter2([800,100],[-50,950],"left"))},5:function(){return new Y(Y.pter2([0,100],[-50,950],"right"))},6:function(){return new Y(Y.pter1([800,80],[-50,950],"left"))},7:function(){return new Y(Y.pter1([0,80],[-50,950],"right"))}},3:{0:function(){var e=Math.floor(600*Math.random()),i=e%2==0?1:839;return new dt(dt.jell2([i,e],t.player))},1:function(){var e=Math.floor(600*Math.random()),i=e%2==0?1:809;return new dt(dt.jell1([i,e],t.player))}},4:{0:function(){var e=Math.floor(600*Math.random()),i=e%2==0?1:890;return new Z(Z.vine1([i,e],t.player))},1:function(){var e=Math.floor(600*Math.random()),i=e%2==0?1:890;return new Z(Z.vine2([i,e],t.player))}}},theme:{src:"./assets/Sound/dk3_boss_boogie.mp3",name:"Boss Boogie",artist:"Eveline Fischer and David Wise",volume:.3},levelLayers:{background:"./assets/Level1/sMode_back.png",front:"./assets/Level1/sMode_front.png"},items:function(){return{}},nextScreen:function(t,e,i){return t.x+t.width/2>e.width?(t.x=e.width-t.width/2,t.velX=0,!0):t.x+t.width/2<0&&(t.x=.01-t.width/2,t.velX=0,!0)}}}}},{key:"level1",value:function(){var t=this;return{0:{renderMap:[],physicalMap:[0,0,0,18,0,0,0,0,0,0,0,0,0,0,0,0,0,0,18,0,0,0,0,0,0,0,0,0,0,0,3,3,3,40,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,23,2,2,2,24,0,0,0,1,2,34,0,0,0,0,17,0,0,0,18,0,0,0,0,0,1,34,0,0,0,17,0,0,0,18,0,0,0,1,1,1,1,2,2,1,1,1,1,1,1,1,1,1],enemies:function(){return{1:new Y(Y.pter4([800,30],[300,950],"left")),2:new Y(Y.pter2([800,120],[300,950],"right"))}},theme:{src:"./assets/Sound/ff9_stirring_forest.mp3",name:"Stirring the Forest",artist:"Nobuo Uematsu",volume:.6},levelLayers:{background:"./assets/Level1/lv1_back.png",mid:"./assets/Level1/lv1_mid.png",front:"./assets/Level1/lv1_front.png"},items:function(){return{}},nextScreen:function(t,e,i,n){return t.x+t.width/2>e.width?n?(i(2),t.x=0-t.width/2,t.y=t.y,!0):(t.x=e.width-t.width/2,void(t.velX=0)):t.x+t.width/2<0?(i(1),t.x=e.width-t.width/2,t.y=t.y,!0):t.y>e.height&&(t.y=0,t.setHit(50),!1)}},1:{renderMap:[],physicalMap:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,37,39,2,2,0,0,0,0,0,0,0,0,0,37,39,0,0,0,0,2,2,2,2,2,2,2,2,2,0,0,0,0,0,0],enemies:function(){return{1:new jt(jt.egg1([150,50]))}},levelLayers:{background:"./assets/Level1/lvl0_back.png",front:"./assets/Level1/lvl0_front.png"},items:function(){return{}},nextScreen:function(t,e,i,n){return t.x+t.width/2>e.width?(i(0),t.x=0-t.width/2,t.y=t.y,!0):t.x+t.width/2<0?(t.x=.01-t.width/2,t.velX=0,!0):t.y>e.height&&(t.y=0,t.setHit(50),!1)}},2:{renderMap:[],physicalMap:[0,0,0,0,0,0,0,0,0,0,0,0,0,17,0,0,0,0,0,0,0,0,0,0,0,0,0,0,17,0,0,0,0,0,0,0,0,12,39,0,0,0,0,17,0,0,0,0,0,0,0,0,4,18,0,0,0,0,17,0,0,0,19,20,0,0,0,4,18,30,0,0,0,17,0,0,0,4,5,0,0,37,4,40,0,0,0,0,31,16,0,0,9,8,0,0,4,5,0,0,0,0,0,0,0,0,0,0,0,0,0,4,5,0,0,0,31,15,15,15,0,0,0,0,0,35,0,5,0,0,0,0,4,0,0,1,1,1,1,2,0,0,5,0,0,0,0,4,0,0],levelLayers:{background:"./assets/Level1/lvl2_back.png",mid:"./assets/Level1/lvl2_mid.png",front:"./assets/Level1/lvl2_front.png"},enemies:function(){return{1:new Y(Y.pter2([10,35],[0,700])),2:new Y(Y.pter4([200,10],[0,700])),3:new Y(Y.pter4([10,140],[0,335],"left")),4:new z(z.spider1([700,0],[0,380])),5:new z(z.spider2([600,0],[20,440])),6:new z(z.spider3([150,0],[20,250]))}},items:function(){return{}},nextScreen:function(t,e,i,n){return t.x+t.width/2>=e.width?n?(i(3),t.x=0-t.width/2,t.y=t.y,!0):(t.x=e.width-t.width/2,void(t.velX=0)):t.x+t.width/2<0?(i(0),t.x=e.width-t.width/2,t.y=t.y,!0):t.y>e.height&&(t.y=0,t.setHit(50),!1)}},3:{renderMap:[],physicalMap:[0,18,59,0,0,0,0,0,0,0,0,0,0,0,0,0,18,59,0,0,0,0,0,0,0,0,0,0,0,0,0,18,59,0,0,0,0,0,0,0,0,0,0,0,0,0,18,59,0,0,0,0,0,0,0,0,0,0,37,15,0,18,0,0,0,0,47,34,0,0,0,37,39,0,0,16,8,0,0,0,0,0,0,0,0,0,4,1,1,1,0,0,0,0,0,0,33,33,33,0,0,44,16,42,3,15,36,0,0,0,0,16,16,45,0,0,0,0,0,0,5,0,2,24,0,0,0,0,0,0,0,0,0,0,0,5,5,0,0,15,15,15,15,15,20,0,33,33,33,33],enemies:function(){return{3:new dt(dt.jell2([500,550])),4:new dt(dt.jell1([700,50])),5:new Z(Z.vine1([500,100],t.player)),6:new Z(Z.vine3([800,20],t.player))}},levelLayers:{background:"./assets/Level1/lvl3_back.png",mid:"./assets/Level1/lvl3_mid.png",front:"./assets/Level1/lvl3_front.png"},items:function(){return{1:new Rt(Rt.health([360,130],!1))}},nextScreen:function(t,e,i,n){return t.x+t.width/2>=e.width?n?(i(4),t.x=0-t.width/2,t.y=t.y,!0):(t.x=e.width-t.width/2,void(t.velX=0)):t.x+t.width/2<0?(i(2),t.x=e.width-t.width/2,t.y=t.y,!0):t.x+t.width/2<180&&t.x+t.width/2>120&&t.y+t.height/2<0&&t.climbing?(i(6),t.x=t.x,t.y=e.height-t.height/2,t.climbing=!0,!0):t.y>e.height&&(t.y=0,t.setHit(50),!1)}},4:{renderMap:[],physicalMap:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,36,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,7,0,0,0,37,39,2,58,2,2,2,38,36,0,2,5,15,15,39,0,0,0,59,0,0,0,0,0,0,0,0,0,0,5,0,0,0,59,0,0,0,0,0,3,3,3,3,0,40,0,0,0,59,0,0,0,0,0,0,0,0,5,5,0,0,0,0,59,0,0,0,0,0,0,0,0,5,0,0,0,0,0,0,0,0,0,0,0,33,33,33,33,33,33,6,2,2,2,2,2,34,0,0],enemies:function(){return{1:new Y(Y.pter2([500,20])),4:new Z(Z.vine3([500,100],t.player)),5:new Z(Z.vine3([300,450],t.player)),6:new Z(Z.vine3([850,500],t.player)),7:new Z(Z.vine1([800,-20],t.player))}},levelLayers:{background:"./assets/Level1/lvl4_back.png",mid:"./assets/Level1/lvl4_mid.png",front:"./assets/Level1/lvl4_front.png"},items:function(){return{1:new Rt(Rt.shield([80,460],!1))}},nextScreen:function(t,e,i,n){return t.x+t.width/2>=e.width?n?(i(5),t.x=0-t.width/2,t.y=t.y,!0):(t.x=e.width-t.width/2,void(t.velX=0)):t.x+t.width/2<0?(i(3),t.x=e.width-t.width/2,t.y=t.y,!0):t.y>e.height&&(t.y=0,t.setHit(50),!1)}},5:{renderMap:[],physicalMap:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,35,54,54,54,56,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,12,54,56,0,0,55,54,54,55,0,0,0,2,34,0,57,0,0,0,0,0,0,0,0,0,0,0,0,0,0,57,0,0,0,0,0,0,0,0,0,0,0,0,55,54,54,54,54,54,54,54,56,0,0,55,54,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,0,0,0,35,34,0,0,0,0,0,0,0,0,0,6,0,29,54,54,54,56,0,0,55,54,54,54,54,54,54],enemies:function(){return{1:new Z(Z.vine3([10,530],t.player)),2:new Z(Z.vine1([830,80],t.player,"left")),3:new Z(Z.vine2([600,180],t.player)),4:new Z(Z.vine1([360,540],t.player,"left")),5:new Z(Z.vine1([120,420],t.player)),6:new Z(Z.vine1([850,500],t.player)),7:new Z(Z.vine1([890,220],t.player,"left"))}},levelLayers:{background:"./assets/Level1/lvl5_back.png",front:"./assets/Level1/lvl5_front.png"},items:function(){return{1:new Rt(Rt.blueCrystal([525,100],!1))}},nextScreen:function(t,e,i,n){return t.x+t.width/2>=e.width?n?(i(12),t.x=0-t.width/2,t.y=t.y,!0):(t.x=e.width-t.width/2,void(t.velX=0)):t.x+t.width/2<0?(i(4),t.x=e.width-t.width/2,t.y=t.y,!0):t.x+t.width/2<180&&t.x+t.width/2>120&&t.y+t.height/2<0&&t.oldY+t.height/2>0&&t.climbing?(i(0),t.x=t.x,t.y=e.height-t.height/2,t.climbing=!0,!0):t.y>e.height&&(t.y=0,t.setHit(50),!1)}},6:{renderMap:[0,0,0,0,0,0,0,65,0,0,0,0,0,0,0,0,0,0,0,0,0,0,65,0,0,0,0,0,0,0,0,0,0,0,0,0,0,65,0,0,0,0,0,0,0,0,0,0,0,0,0,0,65,0,0,0,0,0,0,0,0,0,0,0,0,0,0,65,0,0,0,0,0,0,0,0,0,0,0,0,0,0,65,0,0,0,0,0,0,0,0,0,0,0,0,0,0,65,0,0,0,0,0,0,0,0,0,0,0,0,0,0,65,0,0,0,0,0,0,0,66,66,71,66,66,66,0,65,0,0,0,0,0,0,0,0,0,65,0,0,0,0,0,0,0,0,0,0,0,0],physicalMap:[5,0,0,0,0,0,0,59,0,0,0,0,0,0,0,5,0,0,0,0,0,0,59,0,0,0,0,0,0,0,5,0,0,0,0,0,0,59,0,0,0,0,0,0,0,5,0,0,0,0,0,0,59,0,0,0,0,0,0,0,5,0,0,0,0,0,0,59,0,0,0,0,58,0,0,5,8,0,0,0,0,0,59,0,0,0,0,59,0,0,5,0,0,0,0,0,0,59,0,0,0,0,59,0,0,5,0,0,0,0,0,0,59,0,0,0,0,59,0,0,5,2,58,2,2,2,0,59,0,0,0,0,59,0,0,5,0,59,0,0,0,0,0,0,0,0,0,59,0,0],enemies:function(){return{}},levelLayers:{background:"./assets/Level1/lv1_back.png"},items:function(){return{}},nextScreen:function(t,e,i,n){return t.x+t.width/2>=e.width?(t.x=e.width-t.width/2,t.velX=0,!0):t.x+t.width/2<0?(t.x=0-t.width/2,t.velX=0,!0):t.x+t.width/2>400&&t.x+t.width/2<480&&t.y+t.height/2<0&&t.climbing?(i(7),t.x=t.x,t.y=e.height-t.height/2,t.climbing=!0,!0):t.y+t.height/2>e.height&&(i(3),t.x=t.x,t.y=0-t.height/2,!0)}},7:{renderMap:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,66,66,66,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,66,66,66,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,66,66,66,66,66,66,66,71,66,66,66,66,0,0,0,0,0,0,0,0,0,0,65,0,0,0,0,0,0,0,0,0,0,0,0,0,0,65,0,0,0,0,0,0,0,0,0,0,0,0,0,0,65,0,0,0,0,0,0,0],physicalMap:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,2,2,2,2,2,58,2,2,2,2,0,0,0,0,0,0,0,0,0,0,59,0,0,0,0,0,0,0,0,0,0,0,0,0,0,59,0,0,0,0,0,0,0,0,0,0,0,0,0,0,59,0,0,0,0,0,0,0],enemies:function(){return{}},levelLayers:{background:"./assets/Level1/lv1_back.png"},items:function(){return{}},nextScreen:function(t,e,i,n){return t.x+t.width/2>=e.width?n?(i(9),t.x=0-t.width/2,t.y=t.y,!0):(t.x=e.width-t.width/2,void(t.velX=0)):t.x+t.width/2<0?(t.x=0-t.width/2,t.velX=0,!0):t.y+t.height/2>e.height&&(i(6),t.x=t.x,t.y=0-t.height/2,!0)}},9:{renderMap:[0,0,0,0,0,67,0,0,0,0,0,0,0,0,0,0,0,0,0,0,75,66,66,66,66,0,0,0,69,66,0,0,0,0,0,0,0,0,0,0,0,69,66,77,0,66,67,0,0,0,0,0,0,0,0,69,77,0,0,0,0,75,67,0,0,69,0,0,0,0,0,0,0,0,0,0,0,75,66,66,77,0,0,0,0,0,0,0,0,0,0,0,0,68,0,0,0,69,66,67,0,0,0,0,0,0,0,0,68,0,0,69,77,0,75,4,0,0,0,0,0,0,0,68,0,69,77,0,0,0,4,0,0,0,0,0,0,0,68,0,0,0,0,0,0,0,0,0,0,0],physicalMap:[0,0,0,0,0,34,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,2,2,0,0,0,35,2,0,0,0,0,0,0,0,0,0,0,0,35,2,2,0,2,34,0,0,0,0,0,0,0,0,35,2,0,0,0,0,2,34,0,0,35,0,0,0,0,2,0,0,0,0,0,0,2,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,35,2,34,0,0,0,0,0,0,0,0,0,0,0,35,0,0,2,0,0,0,0,0,0,0,0,0,0,35,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],enemies:function(){return{}},levelLayers:{background:"./assets/Level1/lv1_back.png"},items:function(){return{1:new Rt(Rt.hylianShield([500,10],!1)),2:new Rt(Rt.blueCrystal([450,10],!1))}},nextScreen:function(t,e,i,n){return t.x+t.width/2>=e.width?(t.x=e.width-t.width/2,t.velX=0,!0):t.x+t.width/2<0?(i(7),t.x=e.width-t.width/2,!0):t.y+t.height/2>e.height&&(i(5),t.x=t.x,t.y=0-t.height/2,t.velY=0,!0)}},12:{renderMap:[0,0,0,0,0,0,0,13,5,5,5,49,5,5,5,0,0,0,0,0,0,0,0,16,16,16,16,16,16,16,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,28,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,1,2,0,0,0,0,0,0,0,0,0,0,0,0,28,9,0,0,0,0,0,0,0,0,0,0,0,0,0,5,29,29,29,0,29,29,0,47,47,47,47,47,47,47,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],physicalMap:[0,0,0,0,0,40,3,3,3,3,3,3,3,3,3,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,35,2,0,0,0,0,0,0,0,0,0,0,0,37,39,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],enemies:function(){return{1:new Pt(Pt.boss1([650,160],t.player))}},theme:{src:"./assets/Sound/dk3_boss_boogie.mp3",name:"Boss Boogie",artist:"Eveline Fischer and David Wise",volume:.5},levelLayers:{background:"./assets/Level1/lvl12_back.png",front:"./assets/Level1/lvl12_front.png"},items:function(){return{}},nextScreen:function(t,e,i,n){if(t.x+t.width/2>=e.width){if(!n)return t.x=e.width-t.width/2,t.velX=0,!1}else if(t.x+t.width/2<0)return t.x=0-t.width/2,!1}}}}}],(i=[{key:"loadImage",value:function(){var t=new Image;return t.src="./assets/tileGen.png",t}},{key:"loadImages",value:function(t){var e=new Image;e.src=t.background;var i=t.mid?new Image:null;i&&(i.src=t.mid);var n=t.front?new Image:null;return n&&(n.src=t.front),{background:e,mid:i,front:n}}},{key:"renderBackground",value:function(t,e){var i=this;if(parseInt(this.screen)===parseInt(this.lastScreen))if(this.enemies[1]&&this.enemies[1].dying)Object.values(this.enemies).forEach((function(t){t.health=0}));else if(!this.enemies[1]&&!this.lastScreenCleared){this.lastScreenCleared=!0,clearInterval(this.spawnInterval),Object.values(this.enemies).forEach((function(t){t.health=0}));var n=this.theme.music.muted;this.theme.pause(),this.theme=null,setTimeout((function(){i.theme=new a({src:"./assets/Sound/ff9_victory.mp3",name:"Victory Fanfare",artist:"Nobuo Uematsu",volume:.2,loop:!1}),i.theme.play(),i.theme.music.muted=n}),700)}t.drawImage(this.levelLayers.background,0,0,900,600,0,0,e.width,e.height)}},{key:"renderMid",value:function(t,e){this.levelLayers.mid&&t.drawImage(this.levelLayers.mid,0,0,900,600,0,0,e.width,e.height)}},{key:"renderFront",value:function(t,e){this.levelLayers.front&&t.drawImage(this.levelLayers.front,0,0,900,600,0,0,e.width,e.height)}},{key:"getTile",value:function(t,e){return this.renderMap[e*this.cols+t]}},{key:"getLeft",value:function(t,e){return Math.floor(t*this.tileSize)}},{key:"getRight",value:function(t,e){return Math.floor(t*this.tileSize+this.tileSize)}},{key:"getTop",value:function(t,e){return Math.floor(e*this.tileSize-this.tileSize)}},{key:"getBottom",value:function(t,e){return Math.floor(e*this.tileSize)}},{key:"enemiesInterval",value:function(){var t=this;parseInt(this.lastScreen)===this.screen&&(this.spawnInterval=setInterval((function(){t.enemies[1]||(clearInterval(t.spawnInterval),t.enemies={}),t.spawnEnemies(t.enemies[1])}),4e3))}},{key:"spawnEnemies",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!(Object.keys(this.enemies).length>=4)){this.enemyCount++;var e,i=this.enemyCount,n=600*Math.random(),r={1:new Z(Z.vine3([890,n],this.player,"left")),2:new Z(Z.vine1([890,n],this.player,"left")),3:new Z(Z.vine2([890,n],this.player,"left"))};e=t.health<280?3:t.health<1200?2:1,this.enemies[i]=r[e]}}},{key:"enemyRush",value:function(){if(!(Object.keys(this.enemies).length>=6)){this.enemyCount++;var t=this.enemyCount+Math.floor(100*Math.random()),e=600*Math.random(),i=Object.keys(this.enemies).length%2==0?10:890;this.enemies[t]=new Z(Z.vine2([i,e],this.player,"left"))}}},{key:"enemyRushSpawn",value:function(t){if(!(Object.keys(this.enemies).length>=t)){var e=this.enemyCount+Math.floor(100*Math.random()),i=Object.keys(this.spawnTier[this.spawnTierGroup]).length,n=Math.floor(Math.random()*i);this.enemies[e]=this.spawnTier[this.spawnTierGroup][n](),this.enemyCount++,this.spawnTierGroup=4===this.spawnTierGroup?1:this.spawnTierGroup+1}}},{key:"enemyRushInterval",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:12e3,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6;"survivalMode"===this.screen&&(clearInterval(this.rushInterval),this.rushInterval=setInterval((function(){t.enemyRushSpawn(i)}),e))}},{key:"loadLevel",value:function(t){if(this.screen=t,this.renderMap=this.mapKeys[this.screen].renderMap,this.physicalMap=this.mapKeys[this.screen].physicalMap,this.enemies=this.mapKeys[this.screen].enemies(),this.items=this.mapKeys[this.screen].items(),this.nextScreen=this.mapKeys[this.screen].nextScreen,this.mapKeys[this.screen].levelLayers&&(this.levelLayers=this.loadImages(this.mapKeys[this.screen].levelLayers)),this.mapKeys[this.screen].theme){var e=this.theme.music.muted;this.theme.pause(),this.theme=new a(this.mapKeys[this.screen].theme),this.theme.play(),this.theme.music.muted=e}this.enemiesInterval()}},{key:"drawLevel",value:function(t){for(var e=0;e<this.cols;e++)for(var i=0;i<this.rows;i++){var n=this.getTile(e,i),r=n%8==0?8:n%8;n>0&&t.drawImage(this.tileMap,(r-1)*(this.tileMap.width/8),Math.floor(n/8)*(this.tileMap.width/8),64,64,e*this.tileSize,i*this.tileSize,this.tileSize,this.tileSize)}}}])&&Wt(e.prototype,i),n&&Wt(e,n),t}();function Yt(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var Bt=function(){function t(e,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.player=e,this.game=i,this.keysPressed={},this.keydown=this.keydown.bind(this),this.keyup=this.keyup.bind(this),window.addEventListener("keydown",this.keydown),window.addEventListener("keyup",this.keyup)}var e,i,n;return e=t,(i=[{key:"keydown",value:function(e){switch(this.game.gameOver||e.preventDefault(),this.player.idle=!1,this.player.keydown=!0,t.KEYS[e.key]){case"left":this.keysPressed.left=!0,this.player.crouch=!1,this.player.direction="left",this.player.velX=-7;break;case"right":this.keysPressed.right=!0,this.player.crouch=!1,this.player.direction="right",this.player.velX=7;break;case"up":this.keysPressed.up=!0,this.player.upPressed=this.keysPressed.up,this.player.canClimb&&(this.player.crouch=!1,this.player.climbing=!0,this.player.velY=-7);break;case"down":if(this.keysPressed.down=!0,this.player.downKey=!0,this.player.canClimb)return this.player.climbing=!0,void(this.player.velY=7);this.player.velY>=0&&this.player.velY<1&&!this.player.crouch&&(this.player.crouch=!0);break;case"jump":this.keysPressed.jump=!0,this.player.crouch=!1,this.player.climbing=!1,this.player.jump();break;case"fire":this.keysPressed.fire=!0,this.keysPressed.up?this.player.shootFire("up"):this.keysPressed.down&&!this.player.onGround?this.player.shootFire("down"):this.player.shootFire();break;case"dash":this.keysPressed.dash=!0;break;case"space":this.game.pause=!this.game.pause,this.game.pause?(clearInterval(this.game.frameInterval),clearInterval(this.level.spawnInterval)):(this.game.startFrameCount(),this.game.level.enemiesInterval());break;case"HUD":this.game.showHUD=!this.game.showHUD;break;default:return}}},{key:"keyup",value:function(e){switch(e.preventDefault(),t.KEYS[e.key]){case"left":this.keysPressed.left=!1,this.player.runningKeyDown=!1,this.keysPressed.left||this.keysPressed.right||(this.player.velX=0);break;case"right":this.keysPressed.right=!1,this.keysPressed.left||this.keysPressed.right||(this.player.velX=0);break;case"up":this.keysPressed.up=!1,this.player.upPressed=this.keysPressed.up,this.player.climbing&&(this.player.velY=0);break;case"down":if(this.keysPressed.down=!1,this.player.climbing&&(this.player.velY=0),this.player.velY>=0&&this.player.velY<1&&this.player.crouch)return void(this.player.crouch=!1);break;case"jump":this.keysPressed.jump=!1,this.jumpKey=!1;break;case"fire":this.keysPressed.fire=!1;break;case"dash":this.keysPressed.dash=!1;break;default:return}this.player.idle=!0}}])&&Yt(e.prototype,i),n&&Yt(e,n),t}();Bt.KEYS={" ":"space",ArrowLeft:"left",ArrowUp:"up",ArrowRight:"right",ArrowDown:"down",a:"left",w:"up",d:"right",s:"down",Shift:"jump",z:"fire","/":"fire",Enter:"enter",h:"HUD"};var Ut=Bt;function Xt(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var Vt=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.fire=this.loadFire(),this.blueFire=this.loadBlueFire(),this.drawHealth=this.drawHealth.bind(this),this.drawDamageMeter=this.drawDamageMeter.bind(this),this.loadFire=this.loadFire.bind(this),this.loadBlueFire=this.loadBlueFire.bind(this),this.drawHUD=this.drawHUD.bind(this),this.drawAmmo=this.drawAmmo.bind(this),this.drawPoints=this.drawPoints.bind(this)}var e,i,n;return e=t,(i=[{key:"loadFire",value:function(){var t=new Image;return t.src="./assets/fireball.png",t}},{key:"loadBlueFire",value:function(){var t=new Image;return t.src="./assets/blue_fireball.png",t}},{key:"drawHUD",value:function(t,e,i,n,r){e.beginPath(),e.rect(0,t.height-55,t.width,55),e.fillStyle="rgba(0, 0, 0, 0.5)",e.fill(),e.closePath(),this.drawHealth(t,e,i),this.drawDamageMeter(t,e,i),this.drawPoints(e,t,r),this.drawAmmo(t,e,i,n)}},{key:"drawHealth",value:function(t,e,i){var n=t.width/2*(i.health/200);e.beginPath(),e.rect(150,t.height-40,t.width/2,20),e.fillStyle="rgba(255, 255, 255, .1)",e.fill(),e.closePath(),e.beginPath(),e.rect(150,t.height-40,n,20),e.fillStyle="red",e.fill(),e.closePath()}},{key:"drawDamageMeter",value:function(t,e,i){var n=t.width/2*(i.damageMeter/100);e.beginPath(),e.rect(150,t.height-15,t.width/2,7),e.fillStyle="rgba(255, 255, 255, .1)",e.fill(),e.closePath(),e.beginPath(),e.rect(150,t.height-15,n,7),e.fillStyle="rgb(0, 157, 255)",e.fill(),e.closePath()}},{key:"drawAmmo",value:function(t,e,i,n){if(i.damageBoost)e.drawImage(this.blueFire,n%8*43+21*(n%8+1),400,22,35,t.width-150,t.height-60,70,60);else{var r=t.width-50;switch(e.beginPath(),e.arc(r,t.height-24,5,0,2*Math.PI,!1),e.fillStyle="rgba(255, 255, 255, .1)",e.fill(),e.lineWidth=5,e.strokeStyle="rgba(255, 255, 255, .1)",e.stroke(),e.closePath(),e.beginPath(),e.arc(t.width-100,t.height-24,5,0,2*Math.PI,!1),e.fillStyle="rgba(255, 255, 255, .1)",e.fill(),e.lineWidth=5,e.strokeStyle="rgba(255, 255, 255, .1)",e.stroke(),e.closePath(),e.beginPath(),e.arc(t.width-150,t.height-24,5,0,2*Math.PI,!1),e.fillStyle="rgba(255, 255, 255, .1)",e.fill(),e.lineWidth=5,e.strokeStyle="rgba(255, 255, 255, .1)",e.stroke(),e.closePath(),Object.keys(i.fireballs).length){case 0:e.drawImage(this.fire,n%8*43+21*(n%8+1),400,22,35,t.width-170,t.height-50,40,40);case 1:e.drawImage(this.fire,n%8*43+21*(n%8+1),400,22,35,t.width-120,t.height-50,40,40);case 2:e.drawImage(this.fire,n%8*43+21*(n%8+1),400,22,35,t.width-70,t.height-50,40,40)}}}},{key:"drawPoints",value:function(t,e,i){t.font="20px Arial",t.fillStyle="white",t.textAlign="left",t.fillText("Score: ".concat(i),20,e.height-25)}}])&&Xt(e.prototype,i),n&&Xt(e,n),t}();function qt(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if(!(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)))return;var i=[],n=!0,r=!1,o=void 0;try{for(var s,a=t[Symbol.iterator]();!(n=(s=a.next()).done)&&(i.push(s.value),!e||i.length!==e);n=!0);}catch(t){r=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}return i}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function zt(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function Qt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Kt(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var Gt=function(){function t(e,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3?arguments[3]:void 0;Qt(this,t),this.canvas=e,this.ctx=i,this.lvl=n,this.levelCall={1:Ht.level1(),survivalMode:Ht.level2()},this.player=new g(this.ctx,this.canvas,[20,210]),this.controller=new Ut(this.player,this),this.tileSize=e.width/15,this.level=new Ht({ctx:i,mapKeys:this.levelCall[n],player:this.player,screen:r,tileSize:this.tileSize}),this.collider=new w(this.tileSize),this.HUD=new Vt,this.frameCount=0,this.enemies=zt({},this.level.screen,this.level.enemies),this.items=zt({},this.level.screen,this.level.items),this.showHUD=!0,this.gameOver=!1,this.embers=new Image,this.embers.src="./assets/embers.jpg",this.tipsScreen=new Image,this.tipsScreen.src="./assets/tipsScreen.png",this.highScore=0,this.killCount=0,this.trickShotCount=0,this.pause=!1,this.getTopLeftPos=this.getTopLeftPos.bind(this),this.getTopRightPos=this.getTopRightPos.bind(this),this.getBottomLeftPos=this.getBottomLeftPos.bind(this),this.getBottomRightPos=this.getBottomRightPos.bind(this),this.playerPlatformCheck=this.playerPlatformCheck.bind(this),this.playerUpdate=this.playerUpdate.bind(this),this.projectilePlatformCheck=this.projectilePlatformCheck.bind(this),this.renderItems=this.renderItems.bind(this),this.renderFireballs=this.renderFireballs.bind(this),this.renderEnemies=this.renderEnemies.bind(this),this.renderEnemyProjectiles=this.renderEnemyProjectiles.bind(this),this.startFrameCount=this.startFrameCount.bind(this),this.runGame=this.runGame.bind(this),this.isGameOver=this.isGameOver.bind(this),this.enemiesCleared=this.enemiesCleared.bind(this),this.loadLevel=this.loadLevel.bind(this),this.resizeGame=this.resizeGame.bind(this),this.newLevel=this.newLevel.bind(this),this.spawnItems=this.spawnItems.bind(this),this.renderPause=this.renderPause.bind(this),this.enemyCount=Object.keys(this.enemies).length,this.cleared=!1,this.survivalMode=this.survivalMode.bind(this),this.startFrameCount()}var e,i,n;return e=t,(i=[{key:"startFrameCount",value:function(){var t=this;this.frameInterval=setInterval((function(){t.frameCount++}),1e3/30)}},{key:"newLevel",value:function(){this.level=new Ht({ctx:this.ctx,mapKeys:Ht.level2(),player:this.player,tileSize:this.tileSize}),this.renderMap=this.level.mapKeys[this.level.screen].renderMap,this.physicalMap=this.level.mapKeys[this.level.screen].physicalMap,this.enemies=this.level.enemies(),this.level.enemiesInterval()}},{key:"resizeGame",value:function(t){this.tileSize=t.width/15,this.level.tileSize=this.tileSize}},{key:"getTopLeftPos",value:function(){return[Math.floor(this.player.leftSide()/this.tileSize),Math.floor(this.player.topSide()/this.tileSize)]}},{key:"getTopRightPos",value:function(){return[Math.floor(this.player.rightSide()/this.tileSize),Math.floor(this.player.topSide()/this.tileSize)]}},{key:"getBottomLeftPos",value:function(){return[Math.floor(this.player.leftSide()/this.tileSize),Math.floor(this.player.bottomSide()/this.tileSize)]}},{key:"getBottomRightPos",value:function(){return[Math.floor(this.player.rightSide()/this.tileSize),Math.floor(this.player.bottomSide()/this.tileSize)]}},{key:"enemiesCleared",value:function(){if("survivalMode"!==this.level.screen)return 0===Object.keys(this.enemies[this.level.screen]).length&&(this.cleared=!0,!0)}},{key:"playerPlatformCheck",value:function(){var t,e,i,n,r,o=0,s=0,a=this.level.physicalMap,h=qt(this.getTopLeftPos(),2);r=h[0],(58===(t=a[15*(e=h[1])+r])||59===t)&&s++,this.collider.collidePlatform(this.player,r*this.tileSize,e*this.tileSize,t,this.tileSize);var l=qt(this.getTopRightPos(),2);n=l[0],(58===(t=a[15*(e=l[1])+n])||59===t)&&s++,this.collider.collidePlatform(this.player,n*this.tileSize,e*this.tileSize,t,this.tileSize);var u=qt(this.getBottomLeftPos(),2);r=u[0],0===(t=a[15*(i=u[1])+r])&&o++,(58===t||59===t)&&s++,this.collider.collidePlatform(this.player,r*this.tileSize,i*this.tileSize,t,this.tileSize);var c=qt(this.getBottomRightPos(),2);n=c[0],0===(t=a[15*(i=c[1])+n])&&o++,(58===t||59===t)&&s++,this.player.canClimb&&0===s&&(this.player.climbing=!1,this.player.canClimb=!1),2===o&&(this.player.onGround=!1),this.collider.collidePlatform(this.player,n*this.tileSize,i*this.tileSize,t,this.tileSize)}},{key:"projectilePlatformCheck",value:function(t){var e,i,n,r,o,s=this.level.physicalMap;if("left"===t.dir){var a=qt(t.getTopLeftPos(),2);o=a[0],e=s[15*(i=a[1])+o],this.collider.collidePlatform(t,o*this.tileSize,i*this.tileSize,e,this.tileSize);var h=qt(t.getBottomLeftPos(),2);o=h[0],e=s[15*(n=h[1])+o],this.collider.collidePlatform(t,o*this.tileSize,n*this.tileSize,e,this.tileSize)}if("right"===t.dir){var l=qt(t.getTopRightPos(),2);r=l[0],e=s[15*(i=l[1])+r],this.collider.collidePlatform(t,r*this.tileSize,i*this.tileSize,e,this.tileSize);var u=qt(t.getBottomRightPos(),2);r=u[0],e=s[15*(n=u[1])+r],this.collider.collidePlatform(t,r*this.tileSize,n*this.tileSize,e,this.tileSize)}}},{key:"playerUpdate",value:function(){this.player.setRunning(),this.player.isIdle(),this.player.setOldPos(),this.player.idle||(this.player.x+=this.player.velX),this.player.climbing?this.player.isClimbing():this.player.inAir(),this.playerPlatformCheck()}},{key:"renderEnemies",value:function(){if(this.enemyCount=Object.keys(this.level.enemies).length,!this.cleared){for(var t in this.enemies[this.level.screen]){var e=this.enemies[this.level.screen][t];this.projectilePlatformCheck(e),e.dead?(this.player.setDamageMeter(e.points/2),this.highScore+=e.points,this.killCount++,e.trickShot&&(this.trickShotCount++,this.trickShotCount%6==0&&(this.items[this.level.screen][101]=new Rt(Rt.blueCrystal([e.x,e.y],!0)))),this.killCount%22==0&&this.spawnItems([e.x,e.y]),e instanceof jt&&(this.items[this.level.screen][9e3]=new Rt(Rt.hylianShield([e.x+e.width/2,e.y+e.height/2],!0))),delete this.enemies[this.level.screen][t],this.enemyCount-=1):(e.drawEnemy(this.ctx,this.frameCount),this.collider.collideEnemy(this.player,e),e.move(this.canvas,this.player,this.ctx))}this.enemiesCleared()}}},{key:"spawnItems",value:function(t){this.player.damageBoost?this.items[this.level.screen][100]=new Rt(Rt.blueHealth(t,!0)):this.items[this.level.screen][100]=new Rt(Rt.health(t,!0))}},{key:"renderItems",value:function(){if(this.items[this.level.screen]&&0!==Object.values(this.items[this.level.screen]).length){var t=this.items[this.level.screen];for(var e in t)t[e].checkCollected(this.player),t[e].collected?delete t[e]:t[e].drawItem(this.ctx,this.frameCount)}}},{key:"renderFireballs",value:function(){if(0!==Object.keys(this.player.fireballs).length)for(var t in this.player.fireballs){var e=this.player.fireballs[t];if(0!==this.enemyCount)for(var i in this.enemies[this.level.screen])this.collider.collideEnemy(e,this.enemies[this.level.screen][i]);this.projectilePlatformCheck(e),e.isHit?delete this.player.fireballs[t]:e.drawProjectile(this.ctx,this.frameCount)}}},{key:"renderEnemyProjectiles",value:function(){var t=this;Object.values(this.enemies[this.level.screen]).forEach((function(e){if(0!==Object.keys(e.projectiles).length)for(var i in e.projectiles)t.collider.collideProjectile(t.player,e.projectiles[i]),t.projectilePlatformCheck(e.projectiles[i]),e.projectiles[i].isHit?delete e.projectiles[i]:e.projectiles[i].drawProjectile(t.ctx,t.frameCount)}))}},{key:"renderPause",value:function(){this.ctx.drawImage(this.tipsScreen,0,0,830,554,0,0,this.canvas.width,this.canvas.height),this.ctx.font="1.8em Arial",this.ctx.fillStyle="pink",this.ctx.textAlign="center",this.ctx.fillText("Paused",this.canvas.width/2,40),this.ctx.font="1.3em Arial",this.ctx.fillStyle="pink",this.ctx.textAlign="center",this.ctx.fillText("Music: ".concat(this.level.theme.name," by ").concat(this.level.theme.artist),this.canvas.width/2,580)}},{key:"loadLevel",value:function(){this.player.x+this.player.width/2>=this.canvas.width&&this.level.screen===parseInt(this.level.lastScreen)?this.won=!0:this.level.nextScreen(this.player,this.canvas,this.level.loadLevel,this.cleared)&&(this.cleared=!1,this.enemies[this.level.screen]||(this.enemies[this.level.screen]=this.level.enemies),this.items[this.level.screen]||(this.items[this.level.screen]=this.level.items),this.enemyCount=Object.keys(this.enemies))}},{key:"survivalMode",value:function(){"survivalMode"===this.level.screen&&(0===this.level.rushLevel?(this.level.rushLevel++,this.level.enemyRushInterval(5e3,5)):this.highScore>25&&1===this.level.rushLevel?(this.level.rushLevel++,this.level.enemyRushInterval(4500,6)):this.highScore>50&&2===this.level.rushLevel?(this.level.rushLevel++,this.level.enemyRushInterval(4e3,6)):this.highScore>80&&3===this.level.rushLevel?(this.level.rushLevel++,this.level.enemyRushInterval(4e3,7)):this.highScore>120&&4===this.level.rushLevel?(this.level.rushLevel++,this.level.enemyRushInterval(3500,7)):this.highScore>160&&5===this.level.rushLevel?(this.level.rushLevel++,this.level.enemyRushInterval(3e3,7)):this.highScore>200&&6===this.level.rushLevel?(this.level.rushLevel++,this.level.enemyRushInterval(2500,8)):this.highScore>250&&7===this.level.rushLevel?(this.level.rushLevel++,this.level.enemyRushInterval(2e3,8)):this.highScore>300&&8===this.level.rushLevel?(this.level.rushLevel++,this.level.enemyRushInterval(1500,9)):this.highScore>350&&9===this.level.rushLevel&&(this.level.rushLevel++,this.level.enemyRushInterval(1e3,9)))}},{key:"isGameOver",value:function(){this.gameOver=!(!this.player.dead&&!this.won)}},{key:"runGame",value:function(){this.pause?this.renderPause():(this.loadLevel(),this.isGameOver(),this.gameOver?this.gameOver&&(this.controller=null,clearInterval(this.frameInterval),clearInterval(this.level.spawnInterval),Object.values(this.level.enemies).forEach((function(t){t.dead=!0})),this.won?this.won&&(this.ctx.drawImage(this.embers,0,0,852,400,0,0,900,600),this.ctx.font="80px Arial",this.ctx.fillStyle="pink",this.ctx.textAlign="center",this.ctx.fillText("YOU BEAT LEVEL 1!",this.canvas.width/2,160),this.ctx.font="60px Arial",this.ctx.fillStyle="pink",this.ctx.textAlign="center",this.ctx.fillText("THANK YOU FOR PLAYING!",this.canvas.width/2,this.canvas.height/2),this.ctx.font="80px Arial",this.ctx.fillStyle="pink",this.ctx.textAlign="center",this.ctx.fillText("YOUR SCORE IS ".concat(this.highScore),this.canvas.width/2,450),this.ctx.font="50px Arial",this.ctx.fillStyle="pink",this.ctx.textAlign="center",this.ctx.fillText("Press Enter to Play Again",this.canvas.width/2,550)):(this.level.theme.pause(),this.highScore=Math.floor(this.highScore+this.player.health),this.ctx.drawImage(this.embers,0,0,852,400,0,0,900,600),this.ctx.font="130px Arial",this.ctx.fillStyle="rgb(46, 2, 2)",this.ctx.textAlign="center",this.ctx.fillText("GAME OVER",this.canvas.width/2,this.canvas.height/2),this.ctx.font="80px Arial",this.ctx.fillStyle="pink",this.ctx.textAlign="center",this.ctx.fillText("YOUR SCORE IS ".concat(this.highScore),this.canvas.width/2,400),"survivalMode"!==this.level.screen&&(this.ctx.font="40px Arial",this.ctx.fillStyle="pink",this.ctx.textAlign="center",this.ctx.fillText("Press C to Continue",this.canvas.width/2,480)),this.ctx.font="40px Arial",this.ctx.fillStyle="pink",this.ctx.textAlign="center",this.ctx.fillText("Press Enter to Start Over",this.canvas.width/2,550))):(this.level.renderBackground(this.ctx,this.canvas),this.level.screen>5&&12!==this.level.screen&&this.level.drawLevel(this.ctx),this.player.drawSprite(this.frameCount),this.playerUpdate(),(this.level.screen<6||12==this.level.screen)&&this.level.renderMid(this.ctx,this.canvas),this.survivalMode(this.level,this.highScore),this.renderEnemies(),this.renderItems(),this.renderEnemyProjectiles(),this.renderFireballs(),6!==this.level.screen&&this.level.renderFront(this.ctx,this.canvas),this.showHUD&&this.HUD.drawHUD(this.canvas,this.ctx,this.player,this.frameCount,this.highScore)))}}])&&Kt(e.prototype,i),n&&Kt(e,n),t}();function $t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var Jt=function(){function t(e,i,n){var r=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.canvas=e,this.ctx=i,this.ref=n,this.game=null,this.splash=new Image,this.splash.src="./assets/firegirl.jpg",this.tipsScreen=new Image,this.tipsScreen.src="./assets/tipsScreen.png",this.logo=new Image,this.logo.src="./assets/firegirl_logo_dark.png",this.scoreFormOpen=!1,this.tips=!1,this.renderGame=this.renderGame.bind(this),this.newGame=this.newGame.bind(this),this.newEnemyRush=this.newEnemyRush.bind(this),this.renderScoreSubmission=this.renderScoreSubmission.bind(this),this.continueGame=this.continueGame.bind(this),window.addEventListener("keydown",(function(t){if(!r.scoreFormOpen)switch(t.key){case"Enter":r.game&&!r.game.gameOver||r.newGame();break;case"s":r.game&&!r.game.gameOver||r.newEnemyRush();break;case"t":r.tips=!r.tips;break;case"m":r.game.level.theme.mute();break;case"c":r.game.gameOver&&!r.game.won&&r.continueGame();break;default:return}}))}var e,i,n;return e=t,(i=[{key:"newGame",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.game&&(this.game.level.theme.pause(),this.game.level.theme=null),this.game&&!this.game.gameOver||(this.game=new Gt(this.canvas,this.ctx,1,t),this.game.HUD=new Vt,this.game.level.theme.play())}},{key:"continueGame",value:function(){if(this.game.gameOver){var t=this.game.level.screen;this.game=null,this.game=new Gt(this.canvas,this.ctx,1),this.game.level.loadLevel(t),this.game.enemies[t]=this.game.level.enemies,this.game.player.x=0,this.game.player.y=0,this.game.player.setHit(0),this.game.player.damageMeter=50,this.game.HUD=new Vt,this.game.level.theme.play()}}},{key:"newEnemyRush",value:function(){this.game&&(this.game.level.theme.pause(),this.game.level.theme=null),this.game&&!this.game.gameOver||(this.game=new Gt(this.canvas,this.ctx,"survivalMode"),this.game.HUD=new Vt,this.game.level.theme.play())}},{key:"renderScoreSubmission",value:function(){var t=this,e=document.getElementById("leaderboard");if(!(10===e.childElementCount&&this.game.highScore<e.lastChild.getAttribute("data-score"))){var i=document.getElementById("canvas-container"),n=document.createElement("form");n.className="highscore-form";var r=document.createElement("h3");r.innerText="New High Score!";var o=document.createElement("h4");o.innerText="-Enter your Name-";var s=document.createElement("input");s.setAttribute("type","text"),s.focus="true",s.placeholder="10 characters or less";var a=document.createElement("input");a.type="submit",a.className="score-submit",a.value="Submit to Leaderboard",n.appendChild(r),n.appendChild(o),n.appendChild(s),n.appendChild(a),i.appendChild(n),n.addEventListener("submit",(function(e){e.preventDefault();var i=document.createElement("div");i.innerHTML="Name must be 10 characters or less";var r=e.currentTarget.childNodes[2].value,o=t.game.highScore;r.length>10||0===r.length?e.currentTarget.insertBefore(i,e.currentTarget.childNodes[3]):(t.ref.push().set({name:r,score:o}),t.game=null,t.scoreFormOpen=!1,n.remove())}))}}},{key:"renderGame",value:function(){var t=this;this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.game||(this.tips?(this.ctx.drawImage(this.tipsScreen,0,0,830,554,0,0,this.canvas.width,this.canvas.height),this.ctx.font="1.8em Arial",this.ctx.fillStyle="pink",this.ctx.textAlign="center",this.ctx.fillText("Press T to Go Back",this.canvas.width/2,40)):(this.ctx.drawImage(this.splash,0,0,920,644,0,0,this.canvas.width,this.canvas.height),this.ctx.drawImage(this.logo,0,0,636,171,this.canvas.width/6,this.canvas.height/5,636,171),this.ctx.font="1.8em Arial",this.ctx.fillStyle="pink",this.ctx.textAlign="center",this.ctx.fillText("Press Enter to Play Level 1",this.canvas.width/2,this.canvas.height*(2/3)),this.ctx.font="1.8em Arial",this.ctx.fillStyle="pink",this.ctx.textAlign="center",this.ctx.fillText("Press S to Play Survival Mode",this.canvas.width/2,this.canvas.height*(7/9)),this.ctx.font="1.8em Arial",this.ctx.fillStyle="pink",this.ctx.textAlign="center",this.ctx.fillText("Press T for Tips",this.canvas.width/2,this.canvas.height*(8/9)))),this.game&&(this.game.runGame(),this.game.gameOver&&"survivalMode"===this.game.lvl&&!this.scoreFormOpen&&(this.scoreFormOpen=!0,setTimeout((function(){t.renderScoreSubmission()}),1e3))),window.requestAnimationFrame(this.renderGame)}}])&&$t(e.prototype,i),n&&$t(e,n),t}();window.addEventListener("DOMContentLoaded",(function(){o.a.initializeApp(n);for(var t=o.a.database().ref("leaderboard").orderByChild("score").limitToLast(10),e=document.getElementById("leaderboard");e.firstChild;)e.removeChild(e.firstChild);t.on("child_added",(function(t){var i=document.createElement("li");i.innerText="".concat(t.val().name,": ").concat(t.val().score),i.setAttribute("data-score",t.val().score),e.insertBefore(i,e.firstChild)}));var i=o.a.database().ref("leaderboard"),r=document.getElementById("gameCanvas"),s=r.getContext("2d");new Jt(r,s,i).renderGame()}))}]);
//# sourceMappingURL=main.js.map